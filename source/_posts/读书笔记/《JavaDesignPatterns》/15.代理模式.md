# 第十三章 代理模式



## 三、完整实现

```java
/**
 * 代理模式
 */
// 数据库验证类 - 业务类
class AccessValidator {
    public Boolean validate(String userId) {
        System.out.println("在数据库中验证用户:" + userId + "，是否是合法用户？");
        if (userId.contains("aa")) {
            System.out.println("验证通过！");
            return true;
        } else {
            System.out.println("验证失败！");
            return false;
        }
    }
}

// 日志记录类 - 业务类
class Logger {
    public void log(String userId) {
        System.out.println("记录用户 " + userId + " 登录日志");
    }
}

// 抽象查询类 - 抽象主题角色
interface Searcher {
    String doSearch(String userId, String keyword);
}

// 具体查询类 - 真实主题角色
class RealSearcher implements Searcher {
    @Override
    public String doSearch(String userId, String keyword) {
        System.out.println("用户 " + userId + " 使用关键词 " + keyword + " 进行查询");
        return "查询到的具体内容";
    }
}

// 代理查询类 - 代理主题角色，维持对业务类、真实主题角色对象的引用
class ProxySearcher implements Searcher {
    // 维持一个对真实主题的引用
    private RealSearcher searcher = new RealSearcher();

    // 业务类
    private AccessValidator validator = new AccessValidator();
    private Logger logger = new Logger();

    @Override
    public String doSearch(String userId, String keyword) {
        // 如果身份验证成功，则继续执行
        if (this.validate(userId)) {
            // 调用真实主题对象的查询方法
            final String result = searcher.doSearch(userId, keyword);
            // 记录查询日志
            this.logger(userId);
            // 返回查询结果
            return result;
        }
        return null;
    }

    public boolean validate(String userId) {
        return validator.validate(userId);
    }

    public void logger(String userId) {
        logger.log(userId);
    }
}

public class ProxyPattern {
    public static void main(String[] args) {
        final ProxySearcher searcher = new ProxySearcher();
        final String search = searcher.doSearch("aa张三", "男士内衣");
        System.out.println("查询结果："+search);
    }
}
```

执行结果如下：

![执行结果](https://i.loli.net/2019/07/12/5d284f8188eaa42868.png)