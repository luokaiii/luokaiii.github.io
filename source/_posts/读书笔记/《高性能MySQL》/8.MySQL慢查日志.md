---
title: 《高性能MySQL》第八章 MySQL 慢查询日志
date: 2019-06-21 21:46:00
tags: 
  - MySQL
  - 数据库
categories:
  - 高性能MySQL
---

# 第八章 MySQL 慢查询日志

在业务中，无法保证对程序中的每一条SQL 都进行优化，那么就需要对某一些指定条件的 sql 进行优化。

## 一、捕获有问题的SQL

### 启用 mysql 慢查询日志

1. set global show_query_log_file = /sql_log/slow_log.log
   1. 慢查询日志的log文件位置
2. set global log_queires_not_using_indexes = on;
   1. 是否对未使用索引的sql进行抓取
3. set global long_query_time = 0.001;
   1. 抓取执行超过多少时间的sql，与2不冲突
4. set global  low_query_log = on;
   1. 开启慢查询日志

### 如何分析慢查询日志

如果存在很多未使用索引的sql，或者存在很多慢执行的sql，那么会在短时间内产生大量的日志记录。

此时就需要 mysql 提供的 mysqldumpslow 来进行分析：

```sh
mysqldumpslow slow-mysql.log
```

mysqldupslow 会把相同的sql 汇总在一起，方便分析慢查询日志中的执行计划，有目的的进行优化。