---
title: Docker部署全栈：三、安装Redis
date: 2019-09-22 17:07:00
tags: 
  - Docker全栈部署
  - hide
categories:
  - 运维
  - Docker全栈部署
---

# Docker部署全栈项目：三、Redis 镜像

## 一、编写启动脚本

```sh
#!/bin/bash

curr=`PWD`

# 运行前先停止原有容器
docker stop luokaiii-redis
docker rm luokaiii-redis

# docker run 运行容器
docker run --name luokaiii-redis \ # 指定运行后的容器名称
        -p 7481:6379 \	# 将容器的6379端口映射到宿主机的7481端口
        -v /${curr}/data/:/data \ # 挂载redis持久化的目录到宿主机
        -d redis:4.0.14 \
        --requirepass "password" # 指定redis的连接密码
```

> 如果需要使用 conf 自定义配置，请参考 [官网提供的 redis.conf](http://download.redis.io/redis-stable/redis.conf) 。
>
> Redis 的执行速度特别快，能到做到 15W/s 的查询，因此推荐使用较为复杂的密码。

## 二、启动脚本

```sh
$ cd /home/luokaiii/images/redis   # 脚本和DB文件的存放位置

$ mkdir data   # 创建存储目录

$ ./start.sh   # 运行刚刚写的脚本
994e9e05bb42d1d.....  # 控制台打印这种的，即表示启动成功
```

## 三、日志解释

```tex
# Redis 启动、配置加载
1:C 23 Sep 08:55:24.988 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
1:C 23 Sep 08:55:24.988 # Redis version=4.0.14, bits=64, commit=00000000, modified=0, pid=1, just started
1:C 23 Sep 08:55:24.989 # Configuration loaded
1:M 23 Sep 08:55:24.992 * Running mode=standalone, port=6379.

# Redis 启动成功
1:M 23 Sep 08:55:24.993 * Ready to accept connections
```

## 四、测试

![图：连接测试](https://i.loli.net/2019/09/23/YH3OnIpa7G2vieK.png)

## 五、遇到的问题

### 1. 在 windows 下使用 redis.conf，失败

使用 redis.conf 的 Redis 启动脚本，配置来源于 [官网提供的 redis.conf](http://download.redis.io/redis-stable/redis.conf)，且未做任何修改。

```sh
docker run --name luokaiii-redis \ # 指定运行后的容器名称
        -p 7481:6379 \	# 将容器的6379端口映射到宿主机的7481端口
        -v /${PWD}/data/:/data \ # 挂载redis持久化的目录到宿主机
        -v /${PWD}/redis.conf:/usr/local/etc/redis/redis.conf \ # 挂载redis.conf
        -d redis:4.0.14 \ # 后台运行容器
        redis-server /usr/local/etc/redis/redis.conf
```

执行脚本参考自 [Docker Hub](https://hub.docker.com/_/redis?tab=description)。

![图：DockerHub提供的redis启动脚本](https://i.loli.net/2019/09/23/DvtaXPkubZUJL6A.png)

#### 错误提示

```sh
1:C 23 Sep 08:43:00.482 # Fatal error, can't open config file 'C:/Program Files/Git/usr/local/etc/redis/redis.conf'
```

#### 原因

未知。不明白为什么 Docker Container 会提示出 'C:/...' 路径。

#### 解决方案

Windows 环境不使用 redis.conf. 

> Ubuntu 下使用相同配置并无问题。以下是部署流程：

![Linux下配置](https://i.loli.net/2019/09/23/mXkanxRFu8HIYfi.png)

连接验证：

![连接Linux下的Redis](https://i.loli.net/2019/09/23/i7rZhyLgPHwbnDI.png)

## 项目地址

- [Github](https://github.com/luokaiii/luokaiii.docker-images)

- [Gitee](https://gitee.com/luokaiii/luokaiii.docker-images)