---
title: Docker部署全栈：一、安装Docker环境
date: 2019-09-23 10:49:00
tags: 
  - docker
  - java
categories:
  - Docker全栈部署
---

# Docker部署全栈项目：一、安装Docker 环境

## 一、Win 10 环境下安装

### 1. 安装前提

1. 需要 Windows 10 64位的系统
2. 在 Windows 功能 中开启 Hyper-V 功能
3. 下载 [Docker Desktop for windows](https://www.docker.com/products/docker-desktop)，双击运行安装即可

![图：开启Hyper-V功能](https://i.loli.net/2019/09/23/7LRW5fCIO316Z2v.png)

### 2. 国内镜像加速

右键任务栏中的鲸鱼图标，进入 Settings > Daemon，写入如下配置：

![图：配置镜像加速源](https://i.loli.net/2019/09/23/iX3yz6mGHOgK9Vn.png)

> 建议同时配置多个镜像，避免单个镜像服务宕机。

### 3. 共享磁盘

配置了磁盘共享后，Docker 才能够直接访问共享文件夹中的文件。

![图：配置共享磁盘](https://i.loli.net/2019/09/23/xyfsne7NE6pj2VZ.png)

### 4. 测试

打开 `Git Bash` 或 `CMD` 命令行，查看 docker 版本：

```sh
$ docker --version
Docker version 19.03.1
```

至此，Docker 安装成功。

拉取并运行一个 `hello-world` 镜像：

```sh
$ docker run hello-world
```

Docker 会依次进行：查找本地镜像 > 拉取远程镜像 > 运行container容器

> 如果运行镜像时失败，请先将 Docker 切换至 `Linux container 模式`

![图：切换Docker模式](https://i.loli.net/2019/09/23/TAfNrB3sb2O641W.png)

### 5. 可能存在的问题

如果您的 `Docker for Windows` 是从 `Docker Toolbox` 升级来的，那么可能会提示 `未找到CA` 。

#### 问题：

```sh
$ docker
could not read CA certificate "C:\\Users\\user\\.docker\\machine\\machines\\default\\ca.pem": open C:\Users\user\.docker\machine\machines\default\ca.pem: The system cannot find the path specified.
```

#### 原因：

在卸载之前的 `Docker Toolbox` 时，并不会删除用户的 env 变量。

#### 解决方法：

1. 卸载 Docker Toolbox
2. 卸载 VirtualBox
3. 删除 Toolbox env 变量
   1. 进入系统变量
   2. 从 /yoghurt 中删除所有 "DOCKER_*" 条目(如)

## 二、Ubuntu 16.4 环境

### 1. 安装

安装Docker 分为两种方式：

#### 使用 APT 安装

```sh
# 更新apt源
$ sudo apt-get update

# 添加HTTPS传输软件包和CA证书
$ sudo apt-get install \
	apt-transport-https \
	ca-certificates \
	curl \
	software-properties-common
	
# 使用国内源，添加 GPG 密钥(官方源：https://download.docker.com/linux/ubuntu/gpg)
$ curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg | sudo apt-key add -

# 更新 apt 缓存
$ sudo apt-get update

# 安装Docker CE
$ sudo apt-get install docker-ce
```

#### 使用 脚本 自动安装

Docker 官方为了简化安装流程，提供了一个便捷的安装脚本：

```sh
$ curl -fsSL get.docker.com -o get-docker.sh
$ sudo sh get-docker.sh -mirror Aliyun
```

#### 启动 Docker CE

```sh
$ sudo systemctl enable docker
$ sudo systemctl start docker
```

### 2. 国内镜像加速

在 `/etc/docker/daemon.json` 中(如果不存在，则新建)写入：

```json
{
    "registry-mirrors": [
        "http://hub-mirror.c.163.com",
        "https://reg-mirror.qiniu.com"
    ]
}
```

之后重启服务：

```sh
$ sudo systemctl daemon-reload
$ sudo systemctl restart docker
```

### 3. 卸载

```sh
$ sudo apt-get remove docker \
	docker-engine \
	docker.io
```

### 4. 测试

同 Windows 版测试一样，运行一个 `hello-world image`

```sh
$ docker run hello-world
```

## 三、常用命令

```sh
# Windows 下进入容器的命令
$ winpty docker exec -it luokaiii-mongo bash

# Linux 下进入容器的命令
$ docker exec -it luokaiii-mongo bash
```

参考资料：

1. [Docker Docs：https://docs.docker.com/docker-for-windows/](https://docs.docker.com/docker-for-windows/)
2. 《Docker 技术入门与实践》杨保华版
3. [《Docker 从入门到实践》https://yeasy.gitbooks.io/docker_practice/](https://yeasy.gitbooks.io/docker_practice/)

## 项目地址

- [Github](https://github.com/luokaiii/luokaiii.docker-images)

- [Gitee](https://gitee.com/luokaiii/luokaiii.docker-images)