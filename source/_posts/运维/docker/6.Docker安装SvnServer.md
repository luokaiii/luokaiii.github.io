---
title: Docker 搭建 SvnServer
date: 2020-12-01 09:00:00
categories:
  - docker
hide: true
tags: 
  - docker
---
使用 Docker 搭建 SvnServer

> 镜像为：elleflorio/svn-server

<!-- More -->

### 一、初始化项目

#### 创建目录

目录用于持久化 SvnServer 的数据。

- xx/svn
- xx/svn/repo
- xx/svn/config
- xx/svn/svnadmin_data

#### 获取初始配置

```sh
# 先运行一次svn-server，生成初始配置
$ docker run --name svn -v xx/svn:/temp/svn -d elleflorio/svn-server

# 进入 svn 容器
$ docker exec -it svn /bin/sh

# 查看SVN配置，从配置中可以看到认证方式、认证用户文件、认证组文件地址
$ cat /etc/apache2/conf.d/dav_svn.conf
LoadModule dav_svn_module /usr/lib/apache2/mod_dav_svn.so
LoadModule authz_svn_module /usr/lib/apache2/mod_authz_svn.so

<Location /svn>
     DAV svn
     SVNListParentPath On
     AuthType Basic
     AuthName "Subversion Repository"
     AuthUserFile /etc/subversion/passwd # 用户文件
     AuthzSVNAccessFile /etc/subversion/subversion-access-control # 访问控制文件
     Require valid-user

# 添加用户，设置用户的读写权限
## 这一步也可以在拷贝之后，修改/tmp/svn下的文件，或者直接修改挂载目录
$ vim /etc/subversion/subversion-access-control
[groups]

[/]
* = 
admin = rw
test = rw
$ htpasswd -b /etc/subversion/passwd admin 12345678
$ htpasswd -b /etc/subversion/passwd test 12345678

# 拷贝配置到挂在卷上
$ cp /etc/subversion/* /tmp/svn/config
$ cp /opt/svnadmin/data/* /tmp/svn/svnadmin_data
```

#### 删除容器

将刚刚运行的容器删除，重新创建容器，使用新的挂载配置。

```sh
$ docker stop svn
$ docker rm svn
```

### 二、运行容器

使用刚刚复制出来的配置，重新创建一个容器并运行

```sh
$ docker run --name luokaiii-svn \
	--restart always \
	--hostname localhost \
	-v D:\apache\docker\svn\svn\repo:/home/svn \
	-v D:\apache\docker\svn\svn\config:/etc/subversion \
	-v D:\apache\docker\svn\svn\svnadmin_data:/opt/svnadmin/data \
	-p 10081:80 \
	-p 13691:3690 \
	-p 10444:443 \
	-d elleflorio/svn-server
```

### 三、访问测试

请求 http://127.0.0.1，会出现 "It works!"

请求 http://127.0.0.1/svn，会弹出 Basic 认证

请求 http://127.0.0.1/svnadmin，会进入管理员界面

### 四、检出

使用工具检出，地址为：http://127.0.0.1:10081/svn/repository