# Spring Security 过滤链

HttpSecurity 有三个常用方法来配置过滤链：

* addFilterBefore(Filter filter,Class<? extends Filter> beforeFilter) 在beforeFilter 之前添加 filter
* addFilterAfter(Filter filter,Class<? extends Filter> afterFilter) 在afterFilter 之后添加 filter
* addFilterAt(Filter filter,Class<? extends Filter> atFilter) 在 atFilter 相同位置添加 filter，但不会覆盖它

```java
// todo 测试doFilter的执行顺序
```

例如：配置自定义 Filter 在 SpringSecurity 过滤链中的位置：
自定义 `Filter` 建议继承 `GenericFilterBean`

```java
// 自定义 Filter 过滤器
public class BeforeLoginFilter extends GenericFilterBean{

    @Override
    public void doFilter(ServletRequest servletRequest,ServletRespone servletRespone,FilterChain chain){
        System.out.println("This is a filter before UsernamePasswordAuthenticationFilter.");
        // 继续调用 Filter 链
        filterChain.doFilter(servletRequest, servletResponse);
    }
}

// 向 HttpSecurity 添加过滤器
protected void configure(HttpSecurity http) throws Exception{
    http
        .authorizeRequests()
        .antMatchers("/").permitAll()   // "/" 路径下都可以访问
        .antMatchers("/user/**").hasRole("USER")    // "user"路径下的文件需要 "user"权限
        .and()
            .formLogin()
            .loginPage("/login")    // 指定登录页面
            .defaultSuccessUrl("/user") // 登录成功后的默认页面
        .and()
            .logout()
            .logoutUrl("/logout")   // 指定退出路径
            .logoutSuccessUrl("/login");    // 退出成功后的默认页面

    // 在 UsernamePasswordAuthenticationFilter 前添加 BeforeLoginFilter
    http.addFilterBefore(new BeforeLoginFilter(),UsernamePasswordAuthenticationFilter.class);

    // 在 CrsfFilter 后添加 AfterCrsfFilter
    http.addFilterAfter(new AfterCsrfFilter(),CsrfFilter.class);
}
```

## Spring Security 默认的过滤链

别名 | 类名称 | Namespace Element or Attribute
---- | ---- | ----
CHANNEL_FILTER | ChannelProcessingFilter | http/intercept-url@requires-channel
SECURITY_CONTEXT_FILTER | SecurityContextPersistenceFilter | http
CONCURRENT_SESSION_FILTER | ConcurrentSessionFilter | session-management/concurrency-control
HEADERS_FILTER | HeaderWriterFilter | http/headers
CSRF_FILTER | CsrfFilter | http/csrf
LOGOUT_FILTER | LogoutFilter | http/logout
X509_FILTER | X509AuthenticationFilter | http/x509
PRE_AUTH_FILTER | AbstractPreAuthenticatedProcessingFilter( Subclasses) | N/A
CAS_FILTER | CasAuthenticationFilter | N/A
FORM_LOGIN_FILTER | UsernamePasswordAuthenticationFilter | http/form-login
BASIC_AUTH_FILTER | BasicAuthenticationFilter | http/http-basic
SERVLET_API_SUPPORT_FILTER|SecurityContextHolderAwareRequestFilter | http/@servlet-api-provision
JAAS_API_SUPPORT_FILTER | JaasApiIntegrationFilter | http/@jaas-api-provision
REMEMBER_ME_FILTER | RememberMeAuthenticationFilter | http/remember-me
ANONYMOUS_FILTER | AnonymousAuthenticationFilter | http/anonymous
SESSION_MANAGEMENT_FILTER | SessionManagementFilter | session-management
EXCEPTION_TRANSLATION_FILTER | ExceptionTranslationFilter|http
FILTER_SECURITY_INTERCEPTOR | FilterSecurityInterceptor | http
SWITCH_USER_FILTER | SwitchUserFilter | N/A

[文章来源：Spring4all 社区](http://www.spring4all.com/article/422)