# 密码加密

## 在 WebSecurityConfig 中的登录校验，添加密码加密

```java
/**
 * 添加 UserDetailsService ，实现自定义登录校验
 */
@Override
protected void configure(AuthenticationManagerBuilder builder) throws Exception{
    builder
        .userDetailsService(anyUserDetailsService)
        .passwordEncoder(passwordEncoder());
}

/**
 * 密码加密
 */
@Bean
public BCryptPasswordEncoder passwordEncoder(){
    return new BCryptPasswordEncoder();
}
```

在登录时用到了 `DaoAuthenticationProvider`,它有一个方法 `#additionalAuthenticationChecks(UserDetails userDetails,UsernamePasswordAuthenticationToken authentication)`，此方法用来校验从数据库取得的用户信息和用户输入的信息是否匹配.

在注册时，也需要对用户密码进行加密。即在 post:register() 方法中，将密码使用 BCrptPasswordEncoder进行加密。

```java
/**
 * 加密密码
 */
private void encryptPassword(UserEntity userEntity){
    String password = userEntity.getPassword();
    password = new BCryptPasswordEncoder().encode(password);
    userEntity.setPassword(password);
}
```