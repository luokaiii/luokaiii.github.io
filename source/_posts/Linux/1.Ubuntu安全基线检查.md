# Ubuntu安全基线检查

来自于阿里云云安全中心于 2019/07/22 发送的一条安全漏洞检查，其中关于账户、文件等方面的安全检查及修改建议。

## 一、设置密码失效时间

### 描述

设置密码失效时间，强制定期修改密码，减少密码被泄露和猜测风险，使用非密码登录(如密钥对)方式可以忽略。

### 加固建议

在 /etc/login.defs 中将 PASS_MAX_DAYS 参数设置为 60-180 之间，如：

```shell
PASS_MAX_DAYS 90
```

需同时执行命令设置 root 密码失效时间：

```shell
chage --maxdays 90 root
```

## 二、设置密码修改最小间隔时间

### 描述

设置密码修改最小间隔时间，限制密码更改过于频繁

### 加固建议

在 /etc/login.defs 中将 PASS_MIN_DAYS 参数设置为 7-14 之间，建议为7：

```shell
PASS_MIN_DAYS 7
```

需同时执行命令为 root 用户设置：

```shell
chage --mindays 7 root
```

## 三、密码复杂度检查

### 描述

检查密码长度和密码是否使用多种字符类型

### 加固建议

1. 安装 PAM 的 cracklib 模块，执行命令：

   1. > apt-get update && apt-get install libpam-cracklib

2. 编辑 `/etc/pam.d/common-password`，在 password requisite pam_cracklib.so 开头的这一行配置 minclass(至少包含小写字母、大写字母、数字、特殊字符等4类字符中的3类或4类) 设置为3或4，即在行末尾加上参数 minclass=3；在 password[success=1 default=ignore] pam_unix.so 开头的这一行增加配置 minlen（密码最小长度）设置为9-32位，建议为9,即在行末尾加上参数 minlen=9

## 四、检查密码重用是否受限制

### 描述

强制用户不重用最新使用的密码，降低密码猜测攻击风险

### 加固建议

编辑 `/etc/pam.d/common-password`，在 `password [success=1 default=ignore] pam_unix.so` 开头的这一行增加配置 remember 设置为 5-24 之间，如在行末尾加上 remember=5

## 五、设置用户权限配置文件的权限

### 描述

设置用户权限配置文件的权限

### 加固建议

执行如下5条命令

```shell
chown root:root /etc/passwd /etc/shadow /etc/group /etc/gshadow
chmod 0644 /etc/group
chmod 0644 /etc/passwd
chmod 0400 /etc/shadow
chmod 0400 /etc/gshadow
```

## 六、设置SSH空闲超时退出时间

### 描述

设置SSH空闲超时退出时间，可降低未授权用户访问其他用户 ssh 会话的风险

### 加固建议

编辑 `/etc/ssh/sshd_config`，将 ClientAliveInterval 设置为300到900，即5-15分钟，将ClientAliveCountMax 设置为0-3之间。

```shell
ClientAliveInterval 600
ClientAliveCountMax 2
```

### 七、检查系统空密码账户

### 描述

检查系统空密码账户

### 加固建议

为用户设置一个非空密码，或者执行 `passwd -l <username>` 锁定用户

## 八、禁止SSH空密码用户登录

### 描述

禁止SSH空密码用户登录

### 加固建议

编辑文件 `/etc/ssh/sshd_config`，将 PermitEmptyPasswords 配置为 no：

```shell
PermitEmptyPasswords no
```

## 九、确保密码到期警告天数为7或更多

### 描述

确保密码到期警告天数为7或更多

### 加固建议

在 /etc/login.defs 中将 PASS_WARN_AGE 参数设置为 7-14之间，建议为7：

```shell
PASS_WARN_AGE 7
```

同时执行命令使root用户设置生效：

```shell
chage --warndays 7 root
```

## 十、确保SSH MaxAuthTries设置为3到6之间

### 描述

设置较低的Max AuthTrimes参数将降低SSH服务器被暴力攻击成功的风险。

### 加固建议

在/etc/ssh/sshd_config中取消MaxAuthTries注释符号#，设置最大密码尝试失败次数3-6，建议为4：

```shell
MaxAuthTries 4
```

## 十一、SSHD强制使用V2安全协议

### 描述

SSHD强制使用V2安全协议

类型：SSH服务配置

### 加固建议

编辑 /etc/ssh/sshd_config 文件以按如下方式设置参数：

```shell
Protocol 2
```

## 十二、确保SSH LogLevel设置为INFO 

### 描述

确保SSH LogLevel设置为INFO,记录登录和注销活动

类型：服务配置

### 加固建议

编辑 /etc/ssh/sshd_config 文件以按如下方式设置参数(取消注释):

```shell
LogLevel INFO
```

## 十三、访问控制配置文件的权限设置

### 描述

访问控制配置文件的权限设置

类型：文件权限

### 加固建议

运行以下4条命令：

```shell
chown root:root /etc/hosts.allow 
chown root:root /etc/hosts.deny 
chmod 644 /etc/hosts.deny
chmod 644 /etc/hosts.allow
```

## 十四、开启地址空间布局随机化

### 描述

它将进程的内存空间地址随机化来增大入侵者预测目的地址难度，从而降低进程被成功入侵的风险

类型：入侵防范

### 加固建议

在/etc/sysctl.conf或/etc/sysctl.d/*文件中设置以下参数： `kernel.randomize_va_space = 2` 执行命令： `sysctl -w kernel.randomize_va_space=2`

## 十五、确保root是唯一的UID为0的帐户

### 描述

除root以外其他UID为0的用户都应该删除，或者为其分配新的UID

类型：身份鉴别

### 加固建议

除root以外其他UID为0的用户(查看命令`cat /etc/passwd | awk -F: '($3 == 0) { print $1 }'|grep -v '^root$'`)都应该删除，或者为其分配新的UID

## 十六、确保rsyslog服务已启用

### 描述

确保rsyslog服务已启用，记录日志用于审计

类型：安全审计

### 加固建议

运行以下命令启用rsyslog服务：

```shell
service rsyslog start
```