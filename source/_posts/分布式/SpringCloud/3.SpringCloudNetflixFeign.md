---
title: Spring Cloud OpenFeign
date: 2020-12-14 09:00:00
categories:
  - SpringCloud
top: true
tags: 
  - SpringCloud
  - SpringCloudOpenFeign
---
# Spring Cloud OpenFeign

Feign 是一种声明式、模板化的 HTTP 客户端。

<!-- More -->

> 假定在上一节 Spring Cloud Consul 中，已经注册了两个服务 server1 与 server2。

## 一 、引入依赖

```xml
 <dependency>
     <groupId>org.springframework.cloud</groupId>
     <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>
```

## 二、项目启动类

**@EnableDiscoveryClient** 表示该服务作为 consul client；**@EnableFeignClients** 表示启用 OpenFeign。

```java
@SpringBootApplication
@EnableDiscoveryClient
@EnableFeignClients
public class Server2Applicaton {
    @Bean
    @LoadBalanced
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
    
    public static void main(String[] args) {
        SpringApplication.run(Server2Application.class, args);
    }
}
```

> 注：如果该服务仅作为消费者，不对其它服务提供接口，则可以通过 `spring.cloud.consul.discovery.register=false` 不注册到 Consul 中。

## 三、用法

### 3.1 新建 OpenFeign 服务接口

```java
@FeignClient(value = "server1")
public interface ITestService {
    
    @RequestMapping("/test")
    String test();
    
    @RequestLine("GET /test/{name}")
    String test2(@Param("name") String name);
}
```

### 3.2 服务消费

```java
@Autowired
private ITestService testService;

@Autowired
private RestTemplate restTemplate;

// 1. 使用Feign服务，进行消费
public void test() {
    String result = testService.test();
    log.info(result);
}

// 2. 使用 RestTemplate + 服务名，进行消费
public void test2() {
    String result = restTemplate.getForObject("http://server1/test", String.class);
    log.info(result);
}
```

## 四、接口注解

| 注解         | 参数         | 用法     | 示例                                                      |
| ------------ | ------------ | -------- | --------------------------------------------------------- |
| @RequestLine | Method       | 定义 Uri | @RequestLine("GET /feign/user/{name}")                    |
| @Param       | Parameter    | 模板变量 | String method(@Param("name") String name)                 |
| @Headers     | Method, Type | 请求头   | @Headers({"Content-Type: application/xml"})               |
| @QueryMap    | Parameter    | 查询参数 | String method(@QueryMap Map params)                       |
| @HeaderMap   | Parameter    | 请求头   | String method(@HeaderMap Map headers)                     |
| @Body        | Method       | 请求体   | @Body("{name}") String method(@Param("name") String name) |

## 五、Feign与OpenFeign

[Feign 与 OpenFeign 的区别](https://www.baeldung.com/netflix-feign-vs-openfeign)：

| 名称      | 依赖                           | 最低版本              | 说明                                                         |
| --------- | ------------------------------ | --------------------- | ------------------------------------------------------------ |
| Feign     | spring-cloud-starter-feign     | Spring Boot 1.4.7之前 | Feign 是 SpringCloud 组件的一个轻量级 Restful 的 HTTP 客户端。 |
| OpenFeign | spring-cloud-starter-openfeign |                       | OpenFeign 在 Feign 的基础上支持了 SpringMVC 注解。通过 @FeignClient 解析 @RequestMapping 注解下的接口。 |

> 可以理解为，Feign 就是 OpenFeign 的前身。