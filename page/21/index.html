<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="回廊一寸相思地，落月成孤倚。背灯和月就花阴，已是十年踪迹十年心。"><meta name="keywords" content="1,2,3"><meta name="author" content="koral"><meta name="copyright" content="koral"><title>回廊一寸相思地，落月成孤倚。背灯和月就花阴，已是十年踪迹十年心。 | 凯</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">koral</div><div class="author-info__description text-center">回廊一寸相思地，落月成孤倚。背灯和月就花阴，已是十年踪迹十年心。</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">221</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">31</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">40</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/index.html">凯</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/about">关于我</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">凯</div><div id="site-sub-title">回廊一寸相思地，落月成孤倚。背灯和月就花阴，已是十年踪迹十年心。</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2018/09/01/后端/POI/POI生成原生Excel-簇状柱状图/">使用POI结合Excel的生成簇状柱状图</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/">后端</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/POI/">POI</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/POI/">POI</a></span><div class="content"><h1 id="使用POI结合Excel的行列生成原生散点图-XY图"><a href="#使用POI结合Excel的行列生成原生散点图-XY图" class="headerlink" title="使用POI结合Excel的行列生成原生散点图(XY图)"></a>使用POI结合Excel的行列生成原生散点图(XY图)</h1><h2 id="一、先放最后输出的结果图："><a href="#一、先放最后输出的结果图：" class="headerlink" title="一、先放最后输出的结果图："></a>一、先放最后输出的结果图：</h2><p><img src="https://koral-home.oss-cn-beijing.aliyuncs.com/blog/ScatterChart.png" alt="雷达图"></p>
<h2 id="二、代码"><a href="#二、代码" class="headerlink" title="二、代码"></a>二、代码</h2><pre><code class="java">@Test
public void createScatterChart() throws IOException {
    XSSFWorkbook wb = new XSSFWorkbook();
    XSSFSheet sheet = wb.createSheet(&quot;散点图&quot;);

    Row row;
    Cell cell;
    for (int r = 0; r &lt; 105; r++) {
        row = sheet.createRow(r);
        cell = row.createCell(0);
        cell.setCellValue(&quot;S&quot; + r);
        cell = row.createCell(1);
        cell.setCellValue(RandomUtils.nextInt(1,100));
    }

    XSSFDrawing drawing = sheet.createDrawingPatriarch();
    ClientAnchor anchor = drawing.createAnchor(0, 0, 0, 0, 0, 0, 21, 40);

    XSSFChart chart = drawing.createChart(anchor);

    chart.setTitleText(&quot;预选赛项目得分分布图&quot;);
    chart.setAutoTitleDeleted(false);

    CTChart ctChart = chart.getCTChart();
    ctChart.addNewPlotVisOnly().setVal(true);
    ctChart.addNewDispBlanksAs().setVal(STDispBlanksAs.Enum.forInt(2));
    ctChart.addNewShowDLblsOverMax().setVal(false);

    // 创建一个散点图
    CTPlotArea ctPlotArea = ctChart.getPlotArea();

    CTScatterChart scatterChart = ctPlotArea.addNewScatterChart();
    scatterChart.addNewScatterStyle().setVal(STScatterStyle.LINE_MARKER);
    scatterChart.addNewVaryColors().setVal(false); // 不允许自定义颜色
    scatterChart.addNewAxId().setVal(123456);
    scatterChart.addNewAxId().setVal(123457);

    CTCatAx ctCatAx = ctPlotArea.addNewCatAx();
    ctCatAx.addNewAxId().setVal(123456);
    CTScaling ctScaling = ctCatAx.addNewScaling();
    ctScaling.addNewOrientation().setVal(MIN_MAX);
    ctCatAx.addNewDelete().setVal(false);
    ctCatAx.addNewAxPos().setVal(STAxPos.B);
    ctCatAx.addNewCrossAx().setVal(123457);
    ctCatAx.addNewTickLblPos().setVal(NEXT_TO);

    // 设置Y坐标
    CTValAx ctValAx = ctPlotArea.addNewValAx();
    ctValAx.addNewAxId().setVal(123457);
    CTScaling ctScaling1 = ctValAx.addNewScaling();
    ctScaling1.addNewOrientation().setVal(MIN_MAX);
    ctValAx.addNewDelete().setVal(false);
    ctValAx.addNewAxPos().setVal(STAxPos.B);
    ctValAx.addNewCrossAx().setVal(123456);
    // Y轴的对比线
    CTShapeProperties ctShapeProperties = ctValAx.addNewMajorGridlines().addNewSpPr();
    CTLineProperties ctLineProperties = ctShapeProperties.addNewLn();
    ctLineProperties.setW(9525);
    ctLineProperties.setCap(STLineCap.Enum.forInt(3));
    ctLineProperties.setCmpd(STCompoundLine.Enum.forInt(1));
    ctLineProperties.setAlgn(STPenAlignment.Enum.forInt(1));
    // 不显示Y轴上的坐标刻度线
    ctValAx.addNewMajorTickMark().setVal(STTickMark.NONE);
    ctValAx.addNewMinorTickMark().setVal(STTickMark.NONE);
    ctValAx.addNewTickLblPos().setVal(NEXT_TO);

    // 设置散点图内的信息
    CTScatterSer ctScatterSer = scatterChart.addNewSer();
    ctScatterSer.addNewIdx().setVal(0);
    ctScatterSer.addNewOrder().setVal(0);
    // 去掉连接线
    ctPlotArea.getScatterChartArray(0).getSerArray(0).addNewSpPr().addNewLn().addNewNoFill();

    // 设置散点图各图例的显示
    CTDLbls ctdLbls = scatterChart.addNewDLbls();
    ctdLbls.addNewShowVal().setVal(true);
    ctdLbls.addNewShowLegendKey().setVal(false);
    ctdLbls.addNewShowSerName().setVal(false);
    ctdLbls.addNewShowCatName().setVal(false);
    ctdLbls.addNewShowPercent().setVal(false);
    ctdLbls.addNewShowBubbleSize().setVal(false);
    // 设置标记的样式
    CTMarker ctMarker = ctScatterSer.addNewMarker();
    ctMarker.addNewSymbol().setVal(STMarkerStyle.Enum.forInt(3));
    ctMarker.addNewSize().setVal((short) 5);
    CTShapeProperties ctShapeProperties1 = ctMarker.addNewSpPr();
    ctShapeProperties1.addNewSolidFill().addNewSchemeClr().setVal(STSchemeColorVal.Enum.forInt(5));
    CTLineProperties ctLineProperties1 = ctShapeProperties1.addNewLn();
    ctLineProperties1.setW(9525);
    ctLineProperties1.addNewSolidFill().addNewSchemeClr().setVal(STSchemeColorVal.Enum.forInt(5));

    CTAxDataSource ctAxDataSource = ctScatterSer.addNewXVal();
    CTStrRef ctStrRef = ctAxDataSource.addNewStrRef();
    ctStrRef.setF(&quot;散点图!$A$1:$A$100&quot;);
    CTNumDataSource ctNumDataSource = ctScatterSer.addNewYVal();
    CTNumRef ctNumRef = ctNumDataSource.addNewNumRef();
    ctNumRef.setF(&quot;散点图!$B$1:$B$100&quot;);

    System.out.println(ctChart);

    FileOutputStream fileOut = new FileOutputStream(&quot;C:\\Users\\user\\Desktop\\out.xlsx&quot;);
    wb.write(fileOut);
    fileOut.close();
}</code></pre>
<h2 id="三、XML结构"><a href="#三、XML结构" class="headerlink" title="三、XML结构"></a>三、XML结构</h2><p>以上生成的图表，归根结底是属于XML的一种，通过 <code>Chart</code> 的继承关系可以看到，它其实是 <code>XmlObject</code>的一种实现。</p>
<pre><code class="xml">&lt;xml-fragment xmlns:char=&quot;http://schemas.openxmlformats.org/drawingml/2006/chart&quot; xmlns:main=&quot;http://schemas.openxmlformats.org/drawingml/2006/main&quot;&gt;
  &lt;char:title&gt;
    &lt;char:tx&gt;
      &lt;char:rich&gt;
        &lt;main:bodyPr/&gt;
        &lt;main:p&gt;
          &lt;main:r&gt;
            &lt;main:t&gt;预选赛项目得分分布图&lt;/main:t&gt;
          &lt;/main:r&gt;
        &lt;/main:p&gt;
      &lt;/char:rich&gt;
    &lt;/char:tx&gt;
  &lt;/char:title&gt;
  &lt;char:autoTitleDeleted val=&quot;false&quot;/&gt;
  &lt;char:plotArea&gt;
    &lt;char:layout/&gt;
    &lt;char:scatterChart&gt;
      &lt;char:scatterStyle val=&quot;lineMarker&quot;/&gt;
      &lt;char:varyColors val=&quot;false&quot;/&gt;
      &lt;char:ser&gt;
        &lt;char:idx val=&quot;0&quot;/&gt;
        &lt;char:order val=&quot;0&quot;/&gt;
        &lt;char:spPr&gt;
          &lt;main:ln&gt;
            &lt;main:noFill/&gt;
          &lt;/main:ln&gt;
        &lt;/char:spPr&gt;
        &lt;char:marker&gt;
          &lt;char:symbol val=&quot;diamond&quot;/&gt;
          &lt;char:size val=&quot;5&quot;/&gt;
          &lt;char:spPr&gt;
            &lt;main:solidFill&gt;
              &lt;main:schemeClr val=&quot;accent1&quot;/&gt;
            &lt;/main:solidFill&gt;
            &lt;main:ln w=&quot;9525&quot;&gt;
              &lt;main:solidFill&gt;
                &lt;main:schemeClr val=&quot;accent1&quot;/&gt;
              &lt;/main:solidFill&gt;
            &lt;/main:ln&gt;
          &lt;/char:spPr&gt;
        &lt;/char:marker&gt;
        &lt;char:xVal&gt;
          &lt;char:strRef&gt;
            &lt;char:f&gt;散点图!$A$1:$A$100&lt;/char:f&gt;
          &lt;/char:strRef&gt;
        &lt;/char:xVal&gt;
        &lt;char:yVal&gt;
          &lt;char:numRef&gt;
            &lt;char:f&gt;散点图!$B$1:$B$100&lt;/char:f&gt;
          &lt;/char:numRef&gt;
        &lt;/char:yVal&gt;
      &lt;/char:ser&gt;
      &lt;char:dLbls&gt;
        &lt;char:showLegendKey val=&quot;false&quot;/&gt;
        &lt;char:showVal val=&quot;true&quot;/&gt;
        &lt;char:showCatName val=&quot;false&quot;/&gt;
        &lt;char:showSerName val=&quot;false&quot;/&gt;
        &lt;char:showPercent val=&quot;false&quot;/&gt;
        &lt;char:showBubbleSize val=&quot;false&quot;/&gt;
      &lt;/char:dLbls&gt;
      &lt;char:axId val=&quot;123456&quot;/&gt;
      &lt;char:axId val=&quot;123457&quot;/&gt;
    &lt;/char:scatterChart&gt;
    &lt;char:catAx&gt;
      &lt;char:axId val=&quot;123456&quot;/&gt;
      &lt;char:scaling&gt;
        &lt;char:orientation val=&quot;minMax&quot;/&gt;
      &lt;/char:scaling&gt;
      &lt;char:delete val=&quot;false&quot;/&gt;
      &lt;char:axPos val=&quot;b&quot;/&gt;
      &lt;char:tickLblPos val=&quot;nextTo&quot;/&gt;
      &lt;char:crossAx val=&quot;123457&quot;/&gt;
    &lt;/char:catAx&gt;
    &lt;char:valAx&gt;
      &lt;char:axId val=&quot;123457&quot;/&gt;
      &lt;char:scaling&gt;
        &lt;char:orientation val=&quot;minMax&quot;/&gt;
      &lt;/char:scaling&gt;
      &lt;char:delete val=&quot;false&quot;/&gt;
      &lt;char:axPos val=&quot;b&quot;/&gt;
      &lt;char:majorGridlines&gt;
        &lt;char:spPr&gt;
          &lt;main:ln w=&quot;9525&quot; cap=&quot;flat&quot; cmpd=&quot;sng&quot; algn=&quot;ctr&quot;/&gt;
        &lt;/char:spPr&gt;
      &lt;/char:majorGridlines&gt;
      &lt;char:majorTickMark val=&quot;none&quot;/&gt;
      &lt;char:minorTickMark val=&quot;none&quot;/&gt;
      &lt;char:tickLblPos val=&quot;nextTo&quot;/&gt;
      &lt;char:crossAx val=&quot;123456&quot;/&gt;
    &lt;/char:valAx&gt;
  &lt;/char:plotArea&gt;
  &lt;char:plotVisOnly val=&quot;true&quot;/&gt;
  &lt;char:plotVisOnly val=&quot;true&quot;/&gt;
  &lt;char:dispBlanksAs val=&quot;gap&quot;/&gt;
  &lt;char:showDLblsOverMax val=&quot;false&quot;/&gt;
&lt;/xml-fragment&gt;</code></pre>
<h2 id="四、工具类，我放在-POI生成原生图表-工具类-中"><a href="#四、工具类，我放在-POI生成原生图表-工具类-中" class="headerlink" title="四、工具类，我放在 POI生成原生图表-工具类 中"></a>四、工具类，我放在 <a href="www.baidu.com">POI生成原生图表-工具类</a> 中</h2></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/09/01/后端/POI/poi操作word生成textbox/">POI Word textbox</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/">后端</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/POI/">POI</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/POI/">POI</a></span><div class="content"><pre><code class="java">public static void main(String[] args) throws Exception {

?```
    XWPFDocument document = new XWPFDocument();

    XWPFParagraph paragraph = document.createParagraph();
    XWPFRun run =  paragraph.createRun();
    run.setText(&quot;Callout shape over text: Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor Lorem ipsum semit dolor.&quot;);

    appendCalloutShape(run, &quot;200pt&quot;, &quot;0&quot;, &quot;1in&quot;, &quot;1in&quot;, &quot;black&quot;, &quot;#00FF00&quot;, &quot;The callout\ntext...&quot;, false);

    paragraph = document.createParagraph();
    paragraph = document.createParagraph();
    paragraph = document.createParagraph();
    paragraph = document.createParagraph();
    run =  paragraph.createRun();
    run.setText(&quot;Callout shape:&quot;);

    appendCalloutShape(run, &quot;1in&quot;, &quot;-150px&quot;, &quot;100px&quot;, &quot;150px&quot;, &quot;#0000FF&quot;, &quot;yellow&quot;, &quot;The callout\ntext...&quot;, true);
?```

?```
    FileOutputStream out = new FileOutputStream(&quot;C:\\Users\\user\\Desktop\\converter\\����.docx&quot;);
    document.write(out);
    out.close();
    document.close();
}

public static void appendCalloutShape(XWPFRun run, String left, String top, String width, String height,
                                      String strokecolor, String fillcolor, String calloutext, boolean hashandles) throws Exception {
    CTGroup ctGroup = CTGroup.Factory.newInstance();

    CTShape ctShape = ctGroup.addNewShape();
    ctShape.setCoordsize(&quot;21600,21600&quot;);
    if (hashandles) { //is not Libreoffice Writer compatible
        ctShape.setAdj(&quot;&quot; + 21600*1/3 + &quot;,21600&quot;);
        CTFormulas cTFormulas = ctShape.addNewFormulas();
        cTFormulas.addNewF().setEqn(&quot;val #0&quot;);
        cTFormulas.addNewF().setEqn(&quot;val #1&quot;);
        ctShape.setPath2(&quot;m 1,1 l 1,&quot; + 21600*2/3 + &quot;, &quot; + 21600*1/3 + &quot;,&quot; + 21600*2/3 + &quot;, @0,@1, &quot; + 21600*2/3 + &quot;,&quot; + 21600*2/3 + &quot;, 21600,&quot; + 21600*2/3 + &quot;, 21600,1 x e&quot;);
        ctShape.addNewHandles().addNewH().setPosition(&quot;#0,#1&quot;);
    } else { // is Libreoffice Writer compatible
        ctShape.setPath2(&quot;m 1,1 l 1,&quot; + 21600*2/3 + &quot;, &quot; + 21600*1/3 + &quot;,&quot; + 21600*2/3 + &quot;, &quot; + 21600*1/3 + &quot;,21600, &quot; + 21600*2/3 + &quot;,&quot; + 21600*2/3 + &quot;, 21600,&quot; + 21600*2/3 + &quot;, 21600,1 x e&quot;);
    }

    ctShape.addNewPath().setTextboxrect(&quot;1,1,21600,&quot; + 21600*2/3);

    ctShape.setStyle(&quot;position:absolute;margin-left:&quot; + left + &quot;;margin-top:&quot; + top + &quot;;width:&quot; + width + &quot;;height:&quot; + height + &quot;;z-index:251659264;visibility:visible;rotation:0;&quot;);
    ctShape.setStrokecolor(strokecolor);
    ctShape.setFillcolor(fillcolor);

    CTTextbox cTTextbox = ctShape.addNewTextbox();

    CTTxbxContent ctTxbxContent = cTTextbox.addNewTxbxContent();
    XWPFParagraph textboxparagraph = new XWPFParagraph(ctTxbxContent.addNewP(), run.getDocument());
    XWPFRun textboxrun = null;
    String[] lines = calloutext.split(&quot;\n&quot;);
    for (int i = 0; i &lt; lines.length; i++) {
        textboxrun = textboxparagraph.createRun();
        textboxrun.setText(lines[i]);
        textboxrun.addBreak();
    }

    Node ctGroupNode = ctGroup.getDomNode();
    CTPicture ctPicture = CTPicture.Factory.parse(ctGroupNode);
    CTR cTR = run.getCTR();
    cTR.addNewPict();
    cTR.setPictArray(0, ctPicture);
}
?```

https://stackoverflow.com/questions/53834805/how-to-create-a-wedgerectcallout-shape-in-word-using-apache-poi</code></pre>
<pre><code class="java">
// �ı����еă��ݺ��韩
        XmlObject object = paragraph.getCTP().getRArray(1);
        XmlCursor cursor = object.newCursor();

        // ���Դ�ӡXmlObject�������鿴��ǰxml�ļ�����
        // Ҳ��ͨ��XmlCursor��getName��getTextValue�����鿴��ǰ����Node����ֵ
        // �ҵĵ�һ��Ҫ�޸ĵ���������nodeΪ:ע��index
        // &lt;xml-fragment&gt; -&gt; &lt;w:pict&gt; -&gt; &lt;v:shape&gt; -&gt; &lt;v:textbox&gt; -&gt;
        // &lt;w:txbxContent&gt; -&gt; &lt;w:p&gt; -&gt; &lt;w:r&gt; -&gt; &lt;w:t&gt;
        cursor.toChild(1);
        cursor.toChild(0);
        cursor.toChild(3);
        cursor.toChild(0);

        cursor.toChild(0);
        cursor.toChild(3);
        cursor.toChild(1);
        cursor.setTextValue(&quot;First&quot;);

        // �ҵĵڶ���Ҫ�޸ĵ���������nodeΪ��ע��index
        // &lt;w:txbxContent&gt; -&gt; &lt;w:p&gt; -&gt; &lt;w:r&gt; -&gt; &lt;w:t&gt;
        cursor.toParent();
        cursor.toParent();
        cursor.toParent();
        cursor.toChild(1);
        cursor.toChild(3);
        cursor.toChild(1);
        cursor.setTextValue(&quot;Second&quot;);</code></pre>
<p>ͨ�� freemarker + flying-saucer-pdf ����������Ⱦ�� html���ٽ�htmlת�� pdf���������ڣ�ֻ��֧�� ����ͺ��� ��������</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/09/01/后端/SpringBootWebsocket/SpringBootWebsocket/">《SpringBoot Websocket》</a><span class="article-meta"><i class="fa fa-thumb-tack article-meta__icon sticky"></i><span class="sticky">置顶</span><span class="article-meta__separator" style="margin-right: 0.3rem">|</span></span><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/">后端</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/java/">java</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/java/消息队列/">消息队列</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/消息机制/">消息机制</a></span><div class="content"><ul>
<li><a href="/2018/09/01/后端/SpringBootWebsocket/SpringBoot消息机制(一)-WebSocket介绍/index.html">SpringBoot 消息机制(一)-WebSocket 介绍</a></li>
<li><a href="/2018/09/01/后端/SpringBootWebsocket/SpringBoot消息机制(二)-Stomp协议/index.html">SpringBoot 消息机制(二)-Stomp 协议</a></li>
<li><a href="/2018/09/01/后端/SpringBootWebsocket/SpringBoot消息机制(三)-搭建Websocket+Stomp服务/index.html">SpringBoot 消息机制(三)-搭建 Websocket+Stomp 服务</a></li>
<li><a href="/2018/09/01/后端/SpringBootWebsocket/SpringBoot消息机制(四)-ActiveMQ介绍/index.html">SpringBoot 消息机制(四)-ActiveMQ 介绍</a></li>
<li><a href="/2018/09/01/后端/SpringBootWebsocket/SpringBoot消息机制(五)-SpringBoot整合ActiveMQ/index.html">SpringBoot 消息机制(五)-SpringBoot 整合 ActiveMQ</a></li>
<li><a href="/2018/09/01/后端/SpringBootWebsocket/SpringBoot消息机制(六)-Apollo介绍与整合/index.html">SpringBoot 消息机制(六)-Apollo 介绍与整合</a></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/09/01/后端/SpringBootWebsocket/SpringBoot消息机制(三)-搭建Websocket+Stomp服务/">SpringBoot消息机制(三)-搭建Websocket+Stomp服务</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/">后端</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/java/">java</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/java/消息队列/">消息队列</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/消息机制/">消息机制</a></span><div class="content"><p>#SpringBoot消息机制(三)-搭建Websocket+Stomp服务</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/09/01/后端/POI/POI生成Excel-图表生成/">POI+XChart图形报告</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/">后端</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/POI/">POI</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/POI/">POI</a></span><div class="content"><h1 id="POI-XChart-图形报告"><a href="#POI-XChart-图形报告" class="headerlink" title="POI+XChart 图形报告"></a>POI+XChart 图形报告</h1><h2 id="一、基础示例，写入-Excel"><a href="#一、基础示例，写入-Excel" class="headerlink" title="一、基础示例，写入 Excel"></a>一、基础示例，写入 Excel</h2><p>生成一个图形，并将其写入 Excel 中。</p>
<pre><code class="java">@Test
public void generate() throws IOException {
    String filePath = &quot;C:\\Users\\user\\Desktop\\first.xlsx&quot;;
    double[] xData = new double[]{0.0, 1.0, 2.0};
    double[] yData = new double[]{2.0, 1.0, 0.0};

    // Create Chart
    XYChart chart = QuickChart.getChart(&quot;Sample Chart&quot;, &quot;X&quot;, &quot;Y&quot;, &quot;y(x)&quot;, xData, yData);
    // 将图表转换为byte数组
    byte[] bytes = BitmapEncoder.getBitmapBytes(chart, BitmapEncoder.BitmapFormat.PNG);

    try (XSSFWorkbook workbook = new XSSFWorkbook();
         ByteArrayInputStream inputStream = new ByteArrayInputStream(bytes);
         FileOutputStream outputStream = new FileOutputStream(filePath)) {
        // 创建Excel
        XSSFSheet sheet = workbook.createSheet(&quot;图表&quot;);

        // 写入Excel的指定位置
        XSSFDrawing shapes = sheet.createDrawingPatriarch();
        XSSFClientAnchor anchor = new XSSFClientAnchor(0, 0, 0, 0, 0, 0, 6, 10);
        shapes.createPicture(anchor, sheet.getWorkbook().addPicture(inputStream, HSSFWorkbook.PICTURE_TYPE_PNG));

        // 将Excel写到文件中
        workbook.write(outputStream);
    }
}</code></pre>
<p><img src="https://images.gitee.com/uploads/images/2019/0121/180421_34b56169_1872936.png" alt="生成的基础图片"></p>
<blockquote>
<p>上面我们演示了如何<code>将 XChart生成的图片导入 Excel</code>，下面的部分，都会将生成的图形导出为图片，如果需要导入 Excel 的话，只需要将 chart 套入第一章即可。</p>
</blockquote>
<h2 id="二、将生成的图形导出成为图片"><a href="#二、将生成的图形导出成为图片" class="headerlink" title="二、将生成的图形导出成为图片"></a>二、将生成的图形导出成为图片</h2><p>获取随机数的方法也是通用的，这里先给出，具体的数据应该根据业务而定：</p>
<pre><code class="java">/**
     * 获取随机数
     * @param numPoints 随机的数量
     * @return 随机数组
     */
    private double[] getRandomWalk(int numPoints) {

        double[] y = new double[numPoints];
        y[0] = 0;
        for (int i = 1; i &lt; y.length; i++) {
            y[i] = y[i - 1] + Math.random() - .5;
        }
        return y;
    }</code></pre>
<h3 id="折线图"><a href="#折线图" class="headerlink" title="折线图"></a>折线图</h3><pre><code class="java">@Test
public void generate() throws IOException {
    String filePath = &quot;C:\\Users\\user\\Desktop\\first.png&quot;;

    XYChart chart = new XYChartBuilder().xAxisTitle(&quot;X&quot;).yAxisTitle(&quot;Y&quot;).width(600).height(400).build();
    chart.getStyler().setYAxisMin(-10.0);
    chart.getStyler().setYAxisMax(10.0);
    XYSeries series = chart.addSeries(&quot;新绿&quot;, null, getRandomWalk(200));
    series.setMarker(SeriesMarkers.NONE);

    BitmapEncoder.saveBitmap(chart, filePath, BitmapEncoder.BitmapFormat.PNG);
}</code></pre>
<p>效果如下：</p>
<p><img src="https://images.gitee.com/uploads/images/2019/0121/181356_e145341d_1872936.png" alt="输入图片说明" title="屏幕截图.png"></p>
<h2 id="面积图"><a href="#面积图" class="headerlink" title="面积图"></a>面积图</h2><pre><code class="java">@Test
public void generate() throws IOException {
    String filePath = &quot;C:\\Users\\user\\Desktop\\first.png&quot;;

    // Create Chart
    XYChart chart = new XYChartBuilder().width(800).height(600).title(getClass().getSimpleName()).xAxisTitle(&quot;X&quot;).yAxisTitle(&quot;Y&quot;).build();

    // Customize Chart
    chart.getStyler().setLegendPosition(Styler.LegendPosition.InsideNE);
    chart.getStyler().setAxisTitlesVisible(false);
    chart.getStyler().setDefaultSeriesRenderStyle(XYSeries.XYSeriesRenderStyle.Area);

    // Series
    chart.addSeries(&quot;a&quot;, new double[] { 0, 3, 5, 7, 9 }, new double[] { -3, 5, 9, 6, 5 });
    chart.addSeries(&quot;b&quot;, new double[] { 0, 2, 4, 6, 9 }, new double[] { -1, 6, 4, 0, 4 });
    chart.addSeries(&quot;c&quot;, new double[] { 0, 1, 3, 8, 9 }, new double[] { -2, -1, 1, 0, 1 });

    BitmapEncoder.saveBitmap(chart, filePath, BitmapEncoder.BitmapFormat.PNG);
}</code></pre>
<p><img src="https://images.gitee.com/uploads/images/2019/0121/182136_bba89ebf_1872936.png" alt="面积图" title="屏幕截图.png"></p>
<h2 id="饼状图"><a href="#饼状图" class="headerlink" title="饼状图"></a>饼状图</h2><pre><code class="java">@Test
public void generate() throws IOException {
    String filePath = &quot;C:\\Users\\user\\Desktop\\first.png&quot;;

    PieChart chart = new PieChartBuilder().width(800).height(600).title(getClass().getSimpleName()).build();

    // Customize Chart
    Color[] sliceColors = new Color[] { new Color(224, 68, 14), new Color(230, 105, 62), new Color(236, 143, 110), new Color(243, 180, 159), new Color(246, 199, 182) };
    chart.getStyler().setSeriesColors(sliceColors);

    // Series
    chart.addSeries(&quot;Gold&quot;, 24);
    chart.addSeries(&quot;Silver&quot;, 21);
    chart.addSeries(&quot;Platinum&quot;, 39);
    chart.addSeries(&quot;Copper&quot;, 17);
    chart.addSeries(&quot;Zinc&quot;, 40);

    BitmapEncoder.saveBitmap(chart, filePath, BitmapEncoder.BitmapFormat.PNG);
}</code></pre>
<p><img src="https://koral-home.oss-cn-beijing.aliyuncs.com/bignzhuang.png" alt="饼状图"></p>
<h2 id="散点图"><a href="#散点图" class="headerlink" title="散点图"></a>散点图</h2><pre><code class="java">@Test
public void generate() throws IOException {
    String filePath = &quot;C:\\Users\\user\\Desktop\\first.png&quot;;

    // Create Chart
    XYChart chart = new XYChartBuilder().width(800).height(600).build();

    // Customize Chart
    chart.getStyler().setDefaultSeriesRenderStyle(XYSeries.XYSeriesRenderStyle.Scatter);
    chart.getStyler().setChartTitleVisible(false);
    chart.getStyler().setLegendPosition(Styler.LegendPosition.InsideSW);
    chart.getStyler().setMarkerSize(16);

    // Series
    List&lt;Double&gt; xData = new LinkedList&lt;Double&gt;();
    List&lt;Double&gt; yData = new LinkedList&lt;Double&gt;();
    Random random = new Random();
    int size = 1000;
    for (int i = 0; i &lt; size; i++) {
        xData.add(random.nextGaussian() / 1000);
        yData.add(-1000000 + random.nextGaussian());
    }
    chart.addSeries(&quot;Gaussian Blob&quot;, xData, yData);


    BitmapEncoder.saveBitmap(chart, filePath, BitmapEncoder.BitmapFormat.PNG);
}</code></pre>
<p><img src="https://koral-home.oss-cn-beijing.aliyuncs.com/sandian.png" alt="散点图"></p>
<h2 id="柱状图"><a href="#柱状图" class="headerlink" title="柱状图"></a>柱状图</h2><pre><code class="java">@Test
public void generate() throws IOException {
    String filePath = &quot;C:\\Users\\user\\Desktop\\first.png&quot;;

    // Create Chart
    CategoryChart chart = new CategoryChartBuilder().width(800).height(600).title(&quot;Score Histogram&quot;).xAxisTitle(&quot;Score&quot;).yAxisTitle(&quot;Number&quot;).build();

    // Customize Chart
    chart.getStyler().setLegendPosition(Styler.LegendPosition.InsideNW);
    chart.getStyler().setHasAnnotations(true);

    // Series
    chart.addSeries(&quot;test 1&quot;, Arrays.asList(0, 1, 2, 3, 4), Arrays.asList(4, 5, 9, 6, 5));

    BitmapEncoder.saveBitmap(chart, filePath, BitmapEncoder.BitmapFormat.PNG);
}</code></pre>
<p><img src="https://koral-home.oss-cn-beijing.aliyuncs.com/zhuzhuang.png" alt="柱状图"></p>
<h2 id="堆叠图"><a href="#堆叠图" class="headerlink" title="堆叠图"></a>堆叠图</h2><pre><code class="java">@Test
public void generate() throws IOException {
    String filePath = &quot;C:\\Users\\user\\Desktop\\first.png&quot;;

    // Create Chart
    CategoryChart chart = new CategoryChartBuilder().width(800).height(600).title(&quot;Score Histogram&quot;).xAxisTitle(&quot;Mean&quot;).yAxisTitle(&quot;Count&quot;).build();

    // Customize Chart
    chart.getStyler().setLegendPosition(Styler.LegendPosition.InsideNW);
    chart.getStyler().setAvailableSpaceFill(.96);
    chart.getStyler().setOverlapped(true);

    // Series
    Histogram histogram1 = new Histogram(getGaussianData(10000), 20, -20, 20);
    Histogram histogram2 = new Histogram(getGaussianData(5000), 20, -20, 20);
    chart.addSeries(&quot;histogram 1&quot;, histogram1.getxAxisData(), histogram1.getyAxisData());
    chart.addSeries(&quot;histogram 2&quot;, histogram2.getxAxisData(), histogram2.getyAxisData());

    BitmapEncoder.saveBitmap(chart, filePath, BitmapEncoder.BitmapFormat.PNG);
}

private List&lt;Double&gt; getGaussianData(int count) {
    List&lt;Double&gt; data = new ArrayList&lt;Double&gt;(count);
    Random r = new Random();
    for (int i = 0; i &lt; count; i++) {
        data.add(r.nextGaussian() * 10);
    }
    return data;
}</code></pre>
<p><img src="https://koral-home.oss-cn-beijing.aliyuncs.com/duidie.png" alt="堆叠图"></p>
<h2 id="百分比堆叠柱状图"><a href="#百分比堆叠柱状图" class="headerlink" title="百分比堆叠柱状图"></a>百分比堆叠柱状图</h2><p>这个其实是堆叠图的变种。</p>
<pre><code class="java">@Test
public void generate() throws IOException {
    String filePath = &quot;C:\\Users\\user\\Desktop\\first.png&quot;;

    CategoryChart chart = new CategoryChartBuilder().width(800).height(600).build();
    chart.getStyler().setChartBackgroundColor(Color.WHITE);
    chart.getStyler().setLegendBorderColor(Color.WHITE);
    chart.getStyler().setLegendPosition(Styler.LegendPosition.InsideNW);
    chart.getStyler().setAvailableSpaceFill(0.7);
    chart.getStyler().setStacked(true);

    List&lt;String&gt; xData = Arrays.asList(&quot;学院A&quot;, &quot;学院B&quot;, &quot;学院C&quot;,&quot;学院D&quot;,&quot;学院E&quot;);

    chart.addSeries(&quot;得分A&quot;, xData, getGaussianData(5));
    chart.addSeries(&quot;得分B&quot;, xData, getGaussianData(5));
    chart.addSeries(&quot;得分C&quot;, xData, getGaussianData(5));
    chart.addSeries(&quot;得分D&quot;, xData, getGaussianData(5));

    BitmapEncoder.saveBitmap(chart, filePath, BitmapEncoder.BitmapFormat.PNG);
}

private List&lt;Double&gt; getGaussianData(int count) {
    List&lt;Double&gt; data = new ArrayList&lt;Double&gt;(count);
    for (int i = 0; i &lt; count; i++) {
        data.add(RandomUtils.nextDouble(0,1) * 10);
    }
    return data;
}</code></pre>
<p><img src="https://koral-home.oss-cn-beijing.aliyuncs.com/baifenbi.png" alt="百分比堆叠柱状图"></p>
<p>参考：</p>
<p>(1) <a href="https://knowm.org/open-source/xchart/xchart-example-code/index.html" target="_blank" rel="noopener">XChart Demo</a></p>
<p>(2) 自己</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/09/01/分布式/SpringCloud/微服务重构/">SpringCloud-微服务重构</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Java/">Java</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Spring-Cloud/">Spring Cloud</a></span><div class="content"><h1 id="微服务重构"><a href="#微服务重构" class="headerlink" title="微服务重构"></a>微服务重构</h1><p>在重构应用中，可以通过以下几个方法梳理：</p>
<ol>
<li>每个 Rest 服务都是一个潜在的微服务</li>
<li>每个 SOAP web 服务或 EJB 都是一个潜在的微服务</li>
<li>使用领域驱动设计(domain-driven design)发现企业资产，这些资产可能是微服务。</li>
</ol>
<p>在<strong>重构数据</strong>方面，需要考虑以下几个方面：(1)<strong>寻找与其他数据关联不大的数据孤岛</strong>，检查系统的实体-关系图；如果有与其他数据断开的数据，就是一个潜在的数据重构点；(2)<strong>数据表非规范化</strong>，对高规范化数据库中非规范化一些数据表以将数据重组为更大的逻辑块，其目的是增加数据冗余度使其更容易被打破；(3)<strong>反向批数据更新</strong>，对数据重构时需要考虑数据重构失败时可批量地将新数据反向导回旧的数据模式；(4)<strong>使用主数据管理</strong>，对被广泛使用的数据实体组成一个单一的一致性视图，并开发相应的微服务与主数据一起工作；(5)在 SQL 数据库中<strong>寻找存储在 BLOB(二进制大对象)字段</strong>类型中的代码，转而将这些对象存储在 NoSQL 数据库中，例如以键值(Key-value)存储方式存储；(6)寻找活跃的记录模式，与其他无关的 Flat 对象，使用文档模式数据库进行存储，例如 Cloudant 或 Mongo 等。</p>
<p>微服务重构后还需要<strong>重新打包应用</strong>，包括：(1)<strong>分割应用的 EAR 文件</strong>并打包成独立的 WAR 文件；(2)应用“<strong>一个容器一个服务</strong>”，分别部署每个 WAR 文件至其自有的 WebSphereLiberty 实例运行时或 Docker 容器中；(3)<strong>分别构建、部署和管理</strong>,为每个 WAR 文件使用独立的 DevOps 管线,每个 WAR 文件独立伸缩和管理。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/09/01/分布式/SpringCloud/全链路监控/">待学习</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Java/">Java</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a></span><div class="content"><h1 id="待学习博客"><a href="#待学习博客" class="headerlink" title="待学习博客"></a>待学习博客</h1><p><a href="https://juejin.im/post/5a7a9e0af265da4e914b46f1" target="_blank" rel="noopener">全链路监控</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/09/01/后端/POI/POI生成Excel-表格抽象工具类/">POI生成Excel工具类</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/">后端</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/POI/">POI</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/POI/">POI</a></span><div class="content"><p>该工具类中，包含：创建表格（带默认样式）、自定义样式（通过重写 setDefaultStyle 和 setFirstCellStyle）、合并单元格、宽度自适应等。</p>
<pre><code class="java">/**
 * Excel操作工具类
 */
public class ExcelTools {

    /**
     * 默认的样式， 垂直水平居中、默认换行
     */
    private XSSFCellStyle defaultStyle;

    /**
     * 默认的行首样式
     */
    private XSSFCellStyle firstCellStyle;

    private static SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy.MM.dd hh:mm&quot;);

    public XSSFWorkbook createWorkbook() {
        XSSFWorkbook workbook = new XSSFWorkbook();

        XSSFFont defaultFont = workbook.createFont();
        defaultFont.setColor(IndexedColors.BLACK.getIndex());
        defaultFont.setFontHeight(11);
        defaultFont.setFontName(&quot;微软雅黑 Light&quot;);

        XSSFCellStyle defaultStyle = workbook.createCellStyle();
        defaultStyle.setWrapText(true);
        defaultStyle.setAlignment(HorizontalAlignment.CENTER);
        defaultStyle.setVerticalAlignment(VerticalAlignment.CENTER);
        defaultStyle.setFont(defaultFont);

        XSSFFont font = workbook.createFont();
        font.setColor(IndexedColors.WHITE.getIndex());
        font.setFontHeight(11);
        font.setFontName(&quot;微软雅黑 Light&quot;);

        XSSFCellStyle firstCellStyle = workbook.createCellStyle();
        firstCellStyle.setAlignment(HorizontalAlignment.CENTER);
        firstCellStyle.setVerticalAlignment(VerticalAlignment.CENTER);
        firstCellStyle.setFillForegroundColor(IndexedColors.LIGHT_BLUE.getIndex());
        firstCellStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);
        firstCellStyle.setFont(font);
        firstCellStyle.setBorderBottom(BorderStyle.THIN);
        firstCellStyle.setBottomBorderColor(IndexedColors.LIGHT_BLUE.getIndex());
        firstCellStyle.setLeftBorderColor(IndexedColors.LIGHT_BLUE.getIndex());
        firstCellStyle.setRightBorderColor(IndexedColors.LIGHT_BLUE.getIndex());

        setDefaultStyle(defaultStyle);
        setFirstCellStyle(firstCellStyle);

        return workbook;
    }

    // 创建页
    public XSSFSheet createSheet(XSSFWorkbook workbook, String sheetName) {
        return workbook.createSheet(sheetName);
    }

    /**
     * 创建表格
     *
     * @param sheet           页 @NotNull
     * @param titles          首行标题 @NotNull
     * @param content         填充的内容 @NotNull
     * @param rowNumber       开始的行号 @NotNull
     * @param colNumber       开始的列号 @NotNull
     * @param customRowHeight 自定义行高
     * @param cellRangeList   需要合并的单元格
     * @param customRowStyle  自定义样式,key 对应行，value 对应样式
     * @param customColWidth  自定义宽度自适应
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public void createTable(XSSFSheet sheet, String[] titles, Object[][] content,
                            Integer rowNumber, Integer colNumber,
                            boolean customRowHeight,
                            List&lt;CellRange&gt; cellRangeList,
                            Map&lt;Integer, XSSFCellStyle&gt; customRowStyle,
                            Map&lt;Integer, Integer&gt; customColWidth) {
        // 首行填充
        setFirstRow(sheet, titles, getFirstCellStyle(), rowNumber, colNumber);
        rowNumber++;
        // 设置单元格宽度
        autoWidth(sheet, titles, colNumber, customColWidth);
        // 填充数据
        for (int i = 0; i &lt; content.length; i++) {
            Object[] rowContent = content[i];
            XSSFRow row = sheet.getRow(rowNumber + i) == null ? sheet.createRow(rowNumber + i) : sheet.getRow(rowNumber + i);
            row.setHeight(customRowHeight ? (short) 800 : -1);
            XSSFCellStyle cellStyle = customRowStyle == null || customRowStyle.get(rowNumber + i) == null ?
                    getDefaultStyle() : customRowStyle.get(rowNumber + i);
            for (int j = 0; j &lt; rowContent.length; j++) {
                Object colContent = rowContent[j];
                XSSFCell cell = row.createCell(colNumber + j);
                // 如果是基本数据类型，则转换为字符串填充; 日期转换输出; List转String输出
                if (colContent instanceof Integer || colContent instanceof Double
                        || colContent instanceof String || colContent instanceof Float
                        || colContent instanceof Character || colContent instanceof Byte
                        || colContent instanceof Short || colContent instanceof Boolean
                        || colContent instanceof Long)
                    cell.setCellValue(String.valueOf(colContent));
                else if (colContent instanceof Date)
                    cell.setCellValue(sdf.format(colContent));
                else if (colContent instanceof Iterable)
                    cell.setCellValue(new XSSFRichTextString(String.join(&quot; \n &quot;, (Iterable) colContent)));
                else
                    cell.setCellValue(&quot; - &quot;);
                // 单元格样式
                cell.setCellStyle(cellStyle);
            }
        }

        // 合并单元格
        mergeRegion(sheet, cellRangeList);
    }

    /**
     * 合并单元格
     */
    public static void mergeRegion(XSSFSheet sheet, List&lt;CellRange&gt; cellRangeList) {
        if (cellRangeList == null) return;
        for (CellRange cellRange : cellRangeList) {
            sheet.addMergedRegion(new CellRangeAddress(cellRange.getFirstRow(), cellRange.getLastRow(), cellRange.getFirstCol(), cellRange.getLastCol()));
        }
    }

    /**
     * 无需定制样式和宽度的表格
     */
    public void createTable(XSSFSheet sheet, String[] titles, Object[][] content,
                            Integer rowNumber, Integer colNumber) {
        createTable(sheet, titles, content, rowNumber, colNumber, true, null, null, null);
    }


    /**
     * 填充首行数据
     * 默认按照标题的长度设置单元格宽度
     *
     * @param sheet       页
     * @param cellTitles  标题
     * @param headerStyle 首行样式
     * @param rowNum      起始行
     * @param colNum      起始列
     */
    public static void setFirstRow(XSSFSheet sheet, String[] cellTitles, XSSFCellStyle headerStyle, int rowNum, int colNum) {
        final XSSFRow row = sheet.getRow(rowNum) == null ? sheet.createRow(rowNum) : sheet.getRow(rowNum);
        row.setHeight((short) 800);

        for (String cellName : cellTitles) {
            final Cell cell = row.createCell(colNum++);
            cell.setCellValue(cellName);
            cell.setCellStyle(headerStyle);
        }
    }

    /**
     * 宽度自适应
     *
     * @param sheet       页
     * @param strings     行首
     * @param colNumber   起始列
     * @param customWidth 自定义宽度
     */
    public static void autoWidth(Sheet sheet, String[] strings, Integer colNumber, Map&lt;Integer, Integer&gt; customWidth) {
        for (int s = 0; s &lt; strings.length; s++) {
            int col = colNumber + s;
            if (customWidth != null &amp;&amp; customWidth.keySet().contains(col)) {
                sheet.setColumnWidth(col, customWidth.get(col));
            } else {
                sheet.autoSizeColumn(col, true);
                sheet.setColumnWidth(col, sheet.getColumnWidth(col) * 17 / 10);
            }
        }
    }

    public XSSFCellStyle getDefaultStyle() {
        return defaultStyle;
    }

    public void setDefaultStyle(XSSFCellStyle defaultStyle) {
        this.defaultStyle = defaultStyle;
    }

    public XSSFCellStyle getFirstCellStyle() {
        return firstCellStyle;
    }

    public void setFirstCellStyle(XSSFCellStyle firstCellStyle) {
        this.firstCellStyle = firstCellStyle;
    }
}</code></pre>
<p>合并单元格的对象：</p>
<pre><code class="java">/**
 * 需要合并的单元格
 */
@Setter
@Getter
public class CellRange {
    private Integer firstRow;
    private Integer lastRow;
    private Integer firstCol;
    private Integer lastCol;

    private CellRange(Integer firstRow, Integer lastRow, Integer firstCol, Integer lastCol) {
        this.firstRow = firstRow;
        this.lastRow = lastRow;
        this.firstCol = firstCol;
        this.lastCol = lastCol;
    }

    public static CellRange build(Integer firstRow, Integer lastRow, Integer firstCol, Integer lastCol) {
        return new CellRange(firstRow, lastRow, firstCol, lastCol);
    }
}</code></pre>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/09/01/后端/POI/POI生成原生Excel-雷达图/">使用POI结合Excel的行列生成雷达图</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/">后端</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/后端/POI/">POI</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/POI/">POI</a></span><div class="content"><h2 id="一、先放最后输出的结果图："><a href="#一、先放最后输出的结果图：" class="headerlink" title="一、先放最后输出的结果图："></a>一、先放最后输出的结果图：</h2><p><img src="https://koral-home.oss-cn-beijing.aliyuncs.com/blog/RadarChart.png" alt="雷达图"></p>
<h2 id="二、代码"><a href="#二、代码" class="headerlink" title="二、代码"></a>二、代码</h2><pre><code class="java">    @Test
    public void createRadar() throws IOException {
        final String sheetName = &quot;RadarChart&quot;;
        try (XSSFWorkbook workbook = new XSSFWorkbook()) {
            XSSFSheet sheet = workbook.createSheet(sheetName);

            for (int i = 0; i &lt; 16; i++) {
                XSSFRow row = sheet.createRow(i);
                XSSFCell cell = row.createCell(0);
                cell.setCellValue(i + &quot;行&quot;);
                XSSFCell cell1 = row.createCell(1);
                cell1.setCellValue(RandomUtils.nextInt(0, 20));
            }

            XSSFDrawing drawing = sheet.createDrawingPatriarch();
            XSSFClientAnchor anchor = drawing.createAnchor(0, 0, 0, 0, 2, 0, 7, 16);
            XSSFChart chart = drawing.createChart(anchor);

            CTChart ctChart = chart.getCTChart();
            ctChart.addNewAutoTitleDeleted().setVal(false);
//            ctChart.addNewPlotVisOnly().setVal(true);
//            ctChart.addNewDispBlanksAs().setVal(STDispBlanksAs.GAP);
//            ctChart.addNewShowDLblsOverMax().setVal(false);

            CTPlotArea ctPlotArea = ctChart.addNewPlotArea();
            ctPlotArea.addNewLayout();
//            CTShapeProperties ctShapeProperties = ctPlotArea.addNewSpPr();
//            ctShapeProperties.addNewNoFill();
//            ctShapeProperties.addNewLn().addNewNoFill();
//            ctShapeProperties.addNewEffectLst();

            CTRadarChart ctRadarChart = ctPlotArea.addNewRadarChart();
            // 这两个值应该对应着catAx和valAx
            ctRadarChart.addNewAxId().setVal(123456);
            ctRadarChart.addNewAxId().setVal(123457);
            // 分类标签等是否显示
            CTDLbls ctdLbls = ctRadarChart.addNewDLbls();
            ctdLbls.addNewShowLegendKey().setVal(false);
            ctdLbls.addNewShowVal().setVal(false);
            ctdLbls.addNewShowCatName().setVal(false);
            ctdLbls.addNewShowSerName().setVal(false);
            ctdLbls.addNewShowPercent().setVal(false);
            ctdLbls.addNewShowBubbleSize().setVal(false);
            // 不允许自定义颜色、以及标记的形状
            ctRadarChart.addNewRadarStyle().setVal(STRadarStyle.MARKER);
            ctRadarChart.addNewVaryColors().setVal(false);

            CTRadarSer ctRadarSer = ctRadarChart.addNewSer();
            ctRadarSer.addNewIdx().setVal(0);
            ctRadarSer.addNewOrder().setVal(0);
            CTLineProperties ctLineProperties = ctRadarSer.addNewSpPr().addNewLn();
            ctLineProperties.addNewRound();
            ctLineProperties.addNewSolidFill().addNewSchemeClr().setVal(STSchemeColorVal.ACCENT_1);
            // 渲染数据
            ctRadarSer.addNewCat().addNewStrRef().setF(sheetName + &quot;!$A$1:$A$6&quot;);
            ctRadarSer.addNewVal().addNewNumRef().setF(sheetName + &quot;!$B$2:$B$6&quot;);

            CTCatAx ctCatAx = ctPlotArea.addNewCatAx();
            ctCatAx.addNewAxId().setVal(123456);
            ctCatAx.addNewScaling().addNewOrientation().setVal(MIN_MAX);
            ctCatAx.addNewDelete().setVal(false);
            ctCatAx.addNewAxPos().setVal(STAxPos.B);
            ctCatAx.addNewCrossAx().setVal(123457);
            ctCatAx.addNewMajorTickMark().setVal(STTickMark.NONE);
            ctCatAx.addNewMinorTickMark().setVal(STTickMark.NONE);
            ctCatAx.addNewTickLblPos().setVal(NEXT_TO);
//            ctCatAx.addNewCrosses().setVal(STCrosses.AUTO_ZERO);
//            ctCatAx.addNewAuto().setVal(true);
//            ctCatAx.addNewLblAlgn().setVal(STLblAlgn.CTR);
//            ctCatAx.addNewLblOffset().setVal(100);
//            ctCatAx.addNewNoMultiLvlLbl().setVal(false);
            // spPr
//            CTShapeProperties ctShapeProperties = ctCatAx.addNewSpPr();
//            ctShapeProperties.addNewNoFill();
//            ctShapeProperties.addNewEffectLst();
//            CTLineProperties ctLineProperties1 = ctShapeProperties.addNewLn();
//            ctLineProperties1.setW(9525);
//            ctLineProperties1.setCap(STLineCap.FLAT);
//            ctLineProperties1.setCmpd(STCompoundLine.SNG);
//            ctLineProperties1.setAlgn(STPenAlignment.CTR);
//            CTSchemeColor ctSchemeColor = ctLineProperties1.addNewSolidFill().addNewSchemeClr();
//            ctSchemeColor.setVal(STSchemeColorVal.TX_1);
//            ctSchemeColor.addNewLumMod().setVal(15000);
//            ctSchemeColor.addNewLumOff().setVal(85000);
            // txPr
//            CTTextBody ctTextBody = ctCatAx.addNewTxPr();
//            CTTextCharacterProperties ctTextCharacterProperties = ctTextBody.addNewP().addNewPPr().addNewDefRPr();
//            ctTextCharacterProperties.setU(STTextUnderlineType.NONE);
//            ctTextCharacterProperties.setStrike(STTextStrikeType.NO_STRIKE);
//            ctTextCharacterProperties.setSz(900);
//            ctTextCharacterProperties.setB(false);
//            ctTextCharacterProperties.setI(false);
//            ctTextCharacterProperties.setBaseline(0);
//            ctTextCharacterProperties.setKern(1200);
//            CTSchemeColor ctSchemeColor = ctTextCharacterProperties.addNewSolidFill().addNewSchemeClr();
//            ctSchemeColor.setVal(STSchemeColorVal.TX_1);
//            ctSchemeColor.addNewLumMod().setVal(65000);
//            ctSchemeColor.addNewLumOff().setVal(35000);


            CTValAx ctValAx = ctPlotArea.addNewValAx();
            ctValAx.addNewAxId().setVal(123457);
            ctValAx.addNewScaling().addNewOrientation().setVal(MIN_MAX);
            ctValAx.addNewDelete().setVal(false);
            ctValAx.addNewAxPos().setVal(STAxPos.L);
            ctValAx.addNewCrossAx().setVal(123456);
            ctValAx.addNewMajorTickMark().setVal(STTickMark.NONE);
            ctValAx.addNewMinorTickMark().setVal(STTickMark.NONE);
            ctValAx.addNewTickLblPos().setVal(NEXT_TO);
//            ctValAx.addNewCrosses().setVal(STCrosses.AUTO_ZERO);
//            ctValAx.addNewCrossBetween().setVal(STCrossBetween.BETWEEN);
            // 设置网格线
            CTShapeProperties ctShapeProperties = ctValAx.addNewMajorGridlines().addNewSpPr();
            CTLineProperties ctLineProperties1 = ctShapeProperties.addNewLn();
            ctLineProperties1.setW(9525);
            ctLineProperties1.setCap(STLineCap.FLAT);
            ctLineProperties1.setCmpd(STCompoundLine.SNG);
            ctLineProperties1.setAlgn(STPenAlignment.CTR);
            // 值的纵坐标线，不显示
            ctValAx.addNewSpPr().addNewLn().addNewNoFill();
            // 值的纵坐标值，不显示
            ctValAx.addNewTxPr().addNewP().addNewPPr().addNewDefRPr().addNewNoFill();

            System.out.println(ctChart);

            FileOutputStream outputStream =
                    new FileOutputStream(&quot;C:\\Users\\user\\Desktop\\out.xlsx&quot;);
            workbook.write(outputStream);
            outputStream.flush();
            outputStream.close();
        }
    }</code></pre>
<h2 id="三、XML-结构"><a href="#三、XML-结构" class="headerlink" title="三、XML 结构"></a>三、XML 结构</h2><p>以上生成的图表，归根结底是属于 XML 的一种，通过 <code>RadarChart</code> 的继承关系可以看到，它其实是 <code>XmlObject</code>的一种实现。</p>
<pre><code class="xml">&lt;xml-fragment xmlns:char=&quot;http://schemas.openxmlformats.org/drawingml/2006/chart&quot; xmlns:main=&quot;http://schemas.openxmlformats.org/drawingml/2006/main&quot;&gt;
  &lt;char:autoTitleDeleted val=&quot;false&quot;/&gt;
  &lt;char:plotArea&gt;
    &lt;char:layout/&gt;
  &lt;/char:plotArea&gt;
  &lt;char:plotArea&gt;
    &lt;char:layout/&gt;
    &lt;char:radarChart&gt;
      &lt;char:radarStyle val=&quot;marker&quot;/&gt;
      &lt;char:varyColors val=&quot;false&quot;/&gt;
      &lt;char:ser&gt;
        &lt;char:idx val=&quot;0&quot;/&gt;
        &lt;char:order val=&quot;0&quot;/&gt;
        &lt;char:spPr&gt;
          &lt;main:ln&gt;
            &lt;main:solidFill&gt;
              &lt;main:schemeClr val=&quot;accent1&quot;/&gt;
            &lt;/main:solidFill&gt;
            &lt;main:round/&gt;
          &lt;/main:ln&gt;
        &lt;/char:spPr&gt;
        &lt;char:cat&gt;
          &lt;char:strRef&gt;
            &lt;char:f&gt;RadarChart!$A$1:$A$6&lt;/char:f&gt;
          &lt;/char:strRef&gt;
        &lt;/char:cat&gt;
        &lt;char:val&gt;
          &lt;char:numRef&gt;
            &lt;char:f&gt;RadarChart!$B$2:$B$6&lt;/char:f&gt;
          &lt;/char:numRef&gt;
        &lt;/char:val&gt;
      &lt;/char:ser&gt;
      &lt;char:dLbls&gt;
        &lt;char:showLegendKey val=&quot;false&quot;/&gt;
        &lt;char:showVal val=&quot;false&quot;/&gt;
        &lt;char:showCatName val=&quot;false&quot;/&gt;
        &lt;char:showSerName val=&quot;false&quot;/&gt;
        &lt;char:showPercent val=&quot;false&quot;/&gt;
        &lt;char:showBubbleSize val=&quot;false&quot;/&gt;
      &lt;/char:dLbls&gt;
      &lt;char:axId val=&quot;123456&quot;/&gt;
      &lt;char:axId val=&quot;123457&quot;/&gt;
    &lt;/char:radarChart&gt;
    &lt;char:catAx&gt;
      &lt;char:axId val=&quot;123456&quot;/&gt;
      &lt;char:scaling&gt;
        &lt;char:orientation val=&quot;minMax&quot;/&gt;
      &lt;/char:scaling&gt;
      &lt;char:delete val=&quot;false&quot;/&gt;
      &lt;char:axPos val=&quot;b&quot;/&gt;
      &lt;char:majorTickMark val=&quot;none&quot;/&gt;
      &lt;char:minorTickMark val=&quot;none&quot;/&gt;
      &lt;char:tickLblPos val=&quot;nextTo&quot;/&gt;
      &lt;char:crossAx val=&quot;123457&quot;/&gt;
    &lt;/char:catAx&gt;
    &lt;char:valAx&gt;
      &lt;char:axId val=&quot;123457&quot;/&gt;
      &lt;char:scaling&gt;
        &lt;char:orientation val=&quot;minMax&quot;/&gt;
      &lt;/char:scaling&gt;
      &lt;char:delete val=&quot;false&quot;/&gt;
      &lt;char:axPos val=&quot;l&quot;/&gt;
      &lt;char:majorGridlines&gt;
        &lt;char:spPr&gt;
          &lt;main:ln w=&quot;9525&quot; cap=&quot;flat&quot; cmpd=&quot;sng&quot; algn=&quot;ctr&quot;/&gt;
        &lt;/char:spPr&gt;
      &lt;/char:majorGridlines&gt;
      &lt;char:majorTickMark val=&quot;none&quot;/&gt;
      &lt;char:minorTickMark val=&quot;none&quot;/&gt;
      &lt;char:tickLblPos val=&quot;nextTo&quot;/&gt;
      &lt;char:spPr&gt;
        &lt;main:ln&gt;
          &lt;main:noFill/&gt;
        &lt;/main:ln&gt;
      &lt;/char:spPr&gt;
      &lt;char:txPr&gt;
        &lt;main:p&gt;
          &lt;main:pPr&gt;
            &lt;main:defRPr&gt;
              &lt;main:noFill/&gt;
            &lt;/main:defRPr&gt;
          &lt;/main:pPr&gt;
        &lt;/main:p&gt;
      &lt;/char:txPr&gt;
      &lt;char:crossAx val=&quot;123456&quot;/&gt;
    &lt;/char:valAx&gt;
  &lt;/char:plotArea&gt;
  &lt;char:plotVisOnly val=&quot;true&quot;/&gt;
&lt;/xml-fragment&gt;</code></pre>
<h2 id="四、工具类，我放在-POI-生成原生图表-工具类-中"><a href="#四、工具类，我放在-POI-生成原生图表-工具类-中" class="headerlink" title="四、工具类，我放在 POI 生成原生图表-工具类 中"></a>四、工具类，我放在 <a href="www.baidu.com">POI 生成原生图表-工具类</a> 中</h2></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/09/01/读书笔记/《SpringData》/MongoDB/Spring-Data-MongoDB（2）/">SpringDataMongoDB(二)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/">读书笔记</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/Spring-Data-MongoDB/">Spring Data MongoDB</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Spring-Data-MongoDB/">Spring Data MongoDB</a></span><div class="content"><h1 id="Spring-Data-MongoDB-（二）-查询"><a href="#Spring-Data-MongoDB-（二）-查询" class="headerlink" title="Spring Data MongoDB （二） 查询"></a>Spring Data MongoDB （二） 查询</h1><h2 id="创建查询（去重、区间、忽略大小写等）"><a href="#创建查询（去重、区间、忽略大小写等）" class="headerlink" title="创建查询（去重、区间、忽略大小写等）"></a>创建查询（去重、区间、忽略大小写等）</h2><p>查询的构建机制，将截断前缀 find…By、 read…By、 query…By、 count…By、 get…By 等，从剩余部分开始解析，省略号中可以使用如：Distinct、Between、LessThan、GreaterThan、Like等表达式</p>
<pre><code class="java">interface PersonRepository extends Repository&lt;User, Long&gt; {

  List&lt;Person&gt; findByEmailAddressAndLastname(EmailAddress emailAddress, String lastname);

  // 使用 Distinct 去重
  List&lt;Person&gt; findDistinctPeopleByLastnameOrFirstname(String lastname, String firstname);
  List&lt;Person&gt; findPeopleDistinctByLastnameOrFirstname(String lastname, String firstname);

  // 使用 IgnoreCase 忽略大小写查询
  List&lt;Person&gt; findByLastnameIgnoreCase(String lastname);
  // 使用 AllIgnoreCase 全部忽略大小写
  List&lt;Person&gt; findByLastnameAndFirstnameAllIgnoreCase(String lastname, String firstname);

  // 使用 OrderBy (Field) ASC/DESC 进行排序
  List&lt;Person&gt; findByLastnameOrderByFirstnameAsc(String lastname);
  List&lt;Person&gt; findByLastnameOrderByFirstnameDesc(String lastname);
}</code></pre>
<h2 id="属性表达式（子属性查询）"><a href="#属性表达式（子属性查询）" class="headerlink" title="属性表达式（子属性查询）"></a>属性表达式（子属性查询）</h2><p>即一个被管理实体的属性，在查询时，会去查找该属性类的嵌套属性类。如：Person 有一个 Health 属性类，二Health 也有一个 HeartIm 属性类，则通过方法名查询为：</p>
<pre><code class="java">List&lt;Person&gt; findByHealthHeartIm(HeartIm heartIm);    // 相当于 {health.heart:?0}</code></pre>
<p>其查询顺序为，先匹配 healthheartIm 属性是否存在，若否，匹配 healthHeart.Im ，最后才是 health.Heart.Im。再没有则接着向下拆分。为了解决模糊不清的含义，我们可以在方法名中使用 “_” 手动创建分割点。</p>
<pre><code class="java">List&lt;Person&gt; findByHealth_HeartIm(HeartIm heartIm);</code></pre>
<h2 id="特殊参数（分页、排序）"><a href="#特殊参数（分页、排序）" class="headerlink" title="特殊参数（分页、排序）"></a>特殊参数（分页、排序）</h2><p>除了在查询中定义处理方法参数之外，还有一些特殊的类型，如：Pageable 和 Sort，用于分页和排序:</p>
<pre><code class="java">// Page 接口中返回了元素的总数、可分页数等，其实是通过底层触发 count 方法进行了总数查询
Page&lt;User&gt; findByLastname(String lastname, Pageable pageable);

// Slice 仅仅知道是否有下一个可用的 Slice，在遍历大结果集时非常有效
Slice&lt;User&gt; findByLastname(String lastname, Pageable pageable);

List&lt;User&gt; findByLastname(String lastname, Sort sort);

List&lt;User&gt; findByLastname(String lastname, Pageable pageable);</code></pre>
<h2 id="限制查询结果（Top、First等）"><a href="#限制查询结果（Top、First等）" class="headerlink" title="限制查询结果（Top、First等）"></a>限制查询结果（Top、First等）</h2><p>查询方法的结果可以通过关键字：first、top 来限制，紧跟随的数值会限定长度，默认为1</p>
<pre><code class="java">User findFirstByOrderByLastnameAsc();

User findTopByOrderByAgeDesc();

Page&lt;User&gt; queryFirst10ByLastname(String lastname, Pageable pageable);

Slice&lt;User&gt; findTop3ByLastname(String lastname, Pageable pageable);

List&lt;User&gt; findFirst10ByLastname(String lastname, Sort sort);

List&lt;User&gt; findTop10ByLastname(String lastname, Pageable pageable);</code></pre>
<h2 id="查询结果流（Stream）"><a href="#查询结果流（Stream）" class="headerlink" title="查询结果流（Stream）"></a>查询结果流（Stream）</h2><p>查询的结果可以使用 java8 的 Stream<t> 来处理，这样可以使用 stream 的良好性能。</t></p>
<pre><code class="java">@Query(&quot;select u from User u&quot;)
Stream&lt;User&gt; findAllByCustomQueryAndStream();

Stream&lt;User&gt; readAllByFirstnameNotNull();

@Query(&quot;select u from User u&quot;)
Stream&lt;User&gt; streamAllPaged(Pageable pageable);</code></pre>
<p>因为 Stream 使用了底层的资源，所以在使用之后必须关闭：</p>
<pre><code class="java">try (Stream&lt;User&gt; stream = repository.findAllByCustomQueryAndStream()) {  
    stream.forEach(…);
}</code></pre>
<p>而且，并不是所有的 Spring Data 模块都支持 Stream</p>
<h2 id="异步查询结果"><a href="#异步查询结果" class="headerlink" title="异步查询结果"></a>异步查询结果</h2><p>Repository 的查询方法可以异步执行，这意味着该方法在调用时会立即返回，但是 <code>实际的查询要提交给 Spring 的任务TaskExecutor</code></p>
<pre><code class="java">/** Future 的常用方法： 
isCancelled():boolean    
isDone():boolean    
get():V     
get(long timeout,@NotNull TimeUnit unit):V
*/
@Async
Future&lt;User&gt; findByFirstname(String firstname);     // java.util.concurrent.Future          

@Async
CompletableFuture&lt;User&gt; findOneByFirstname(String firstname);  // Java 8 的 java.util.concurrent.CompletableFuture

@Async
ListenableFuture&lt;User&gt; findOneByLastname(String lastname);  // org.springframework.util.concurrent.ListenableFuture</code></pre>
<h2 id="生成-Repository-实例"><a href="#生成-Repository-实例" class="headerlink" title="生成 Repository 实例"></a>生成 Repository 实例</h2><p>使用 xml 配置的方式 指定repositories 扫描的包路径：</p>
<pre><code class="java">&lt;repositories base-package=&quot;com.acme.repositories&quot; /&gt;</code></pre>
<p>使用注解的方式：</p>
<pre><code class="java">@Configuration
@EnableJpaRepositories(&quot;com.acme.repositories&quot;)
class ApplicationConfiguration {
    @Bean
    EntityManagerFactory entityManagerFactory() { // … }
}</code></pre>
<blockquote>
<p>以上是 Spring Data 的公共基础部分，再往下就是 MongoDBFactory 等的底层实现了。才疏学浅，看不下去啊。就到这里吧，第八章。</p>
</blockquote>
<p>文章总结于：<a href="https://docs.spring.io/spring-data/mongodb/docs/current/reference/html/#dependencies.spring-framework" target="_blank" rel="noopener">https://docs.spring.io/spring-data/mongodb/docs/current/reference/html/#dependencies.spring-framework</a></p>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/20/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/22/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By koral</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>