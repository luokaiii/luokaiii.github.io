<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="回廊一寸相思地，落月成孤倚。背灯和月就花阴，已是十年踪迹十年心。"><meta name="keywords" content="1,2,3"><meta name="author" content="koral"><meta name="copyright" content="koral"><title>回廊一寸相思地，落月成孤倚。背灯和月就花阴，已是十年踪迹十年心。 | 凯</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">koral</div><div class="author-info__description text-center">回廊一寸相思地，落月成孤倚。背灯和月就花阴，已是十年踪迹十年心。</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">266</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">34</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">44</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/index.html">凯</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/about">关于我</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">凯</div><div id="site-sub-title">回廊一寸相思地，落月成孤倚。背灯和月就花阴，已是十年踪迹十年心。</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/26/读书笔记/Spring技术内幕/3_IoC容器/">《Spring技术内幕》第二章 Spring Framework 的核心：IoC容器的实现</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-26</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/">读书笔记</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/Spring技术内幕/">Spring技术内幕</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Spring技术内幕/">Spring技术内幕</a></span><div class="content"><p>通过 Spring 的核心 IoC 容器和 AOP 的设计和实现可以了解 Spring 所倡导的开发思路，如 <strong>使用 POJO 开发企业应用</strong>、提供<strong>一致的编程模型</strong>、<strong>强调对接口编程</strong>等。</p>
<p>Spring 核心的模式实现，是为应用提供 IoC 容器和 AOP 框架：</p>
<p>IoC 容器很好地降低了框架的侵入性，在简化用户开发的同时，依然能够使用强大的服务；</p>
<p>AOP 技术决定了 Spring 作为一个平台的地位，使 Spring 成为一个兼容并包的开放体系，通过 AOP 技术，使第三方解决方案能够尽可能地结合到 Spring 平台上。</p></div><a class="more" href="/2019/09/26/读书笔记/Spring技术内幕/3_IoC容器/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/26/读书笔记/Spring技术内幕/2_Spring架构/">《Spring技术内幕》第一章 Spring 的设计理念和整体架构</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-26</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/">读书笔记</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/Spring技术内幕/">Spring技术内幕</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Spring技术内幕/">Spring技术内幕</a></span><div class="content"><p>Spring 为开发者提供一个一站式的轻量级应用开发框架(平台)。</p>
<p>在 Java EE 的应用开发中，支持 POJO 和使用 JavaBean 的开发方式，使应用面向接口开发，充分支持 OO(面向对象) 的设计方法。</p></div><a class="more" href="/2019/09/26/读书笔记/Spring技术内幕/2_Spring架构/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/26/读书笔记/Spring技术内幕/1_简介/">《Spring技术内幕》读书笔记</a><span class="article-meta"><i class="fa fa-thumb-tack article-meta__icon sticky"></i><span class="sticky">置顶</span><span class="article-meta__separator" style="margin-right: 0.3rem">|</span></span><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-26</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/">读书笔记</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/Spring技术内幕/">Spring技术内幕</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Spring技术内幕/">Spring技术内幕</a></span><div class="content"><p>随着 Spring 的不断成熟和完善，Spring 现已发展成为一个包含软件构建、开发、运行、部署整个软件生命周期的产品族群。</p></div><a class="more" href="/2019/09/26/读书笔记/Spring技术内幕/1_简介/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/26/读书笔记/《SpringSession》/0.目录/">《Spring Session》文档笔记</a><span class="article-meta"><i class="fa fa-thumb-tack article-meta__icon sticky"></i><span class="sticky">置顶</span><span class="article-meta__separator" style="margin-right: 0.3rem">|</span></span><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-26</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/">读书笔记</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/Spring-Session/">Spring Session</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Spring-Session/">Spring Session</a></span><div class="content"><p>Spring Session 的两种解决方案：redis 与 mongodb</p>
<ul>
<li><a href="/2019/09/26/读书笔记/《SpringSession》/1_RedisSession/index.html">Spring Session Redis</a></li>
<li><a href="/2019/09/26/读书笔记/《SpringSession》/2_MongoSession/index.html">Spring Session MongoDB</a></li>
</ul></div><a class="more" href="/2019/09/26/读书笔记/《SpringSession》/0.目录/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/26/读书笔记/《SpringSession》/2_MongoSession/">《Spring Session》二、Spring Session MongoDB</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-26</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/">读书笔记</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/Spring-Session/">Spring Session</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Spring-Session/">Spring Session</a></span><div class="content"><h1 id="Spring-Session-MongoDB"><a href="#Spring-Session-MongoDB" class="headerlink" title="Spring Session MongoDB"></a>Spring Session MongoDB</h1><p><code>Spring Session MongoDB</code> 提供了一个在 <code>MongoDB</code> 上存储 Session 的 API 和实现。</p>
<p>最低版本要求：</p>
<ol>
<li>JAVA 8</li>
<li>Servlet 2.5+</li>
<li>Spring 5.0</li>
</ol>
<h3 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h3><pre><code class="xml">&lt;dependencies&gt;
    ......
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;
        &lt;artifactId&gt;spring-session-data-mongodb&lt;/artifactId&gt;
        &lt;version&gt;${spring-session-data-mongodb.version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boo&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
<h3 id="2-Spring-Configuration"><a href="#2-Spring-Configuration" class="headerlink" title="2. Spring Configuration"></a>2. Spring Configuration</h3><p>增加一个配置类，用于声明 Spring Session 的实现替换 HttpSession 的实现。</p>
<pre><code class="java">/**
 * 创建一个名为 SpringSessionRepositoryFilter 的过滤器
 *  负责替换 SpringSession 支持的 HttpSession 实现。
 */
@EnableMongoHttpSession
public class HttpSessionConfig {
    @Bean
    public JdkMongoSessionConverter jdkMongoSessionConverter() {
        return new JdkMongoSessionConverter(Duration.ofMinutes(30));
    }
}</code></pre>
<p>为了能在 MongoDB 中持久化 Session 对象，需要提供 序列化与反序列化 机制。默认情况下，使用 <code>JdkMongoSessionConverter</code>。</p>
<p>您也可以替换使用 JacksonMongoSessionConverter，或者自定义其实现。</p>
<h3 id="3-连接-MongoDB"><a href="#3-连接-MongoDB" class="headerlink" title="3. 连接 MongoDB"></a>3. 连接 MongoDB</h3><pre><code class="properties">spring.data.mongodb.host=localhost
spring.data.mongodb.port=27017
spring.data.mongodb.database=test</code></pre>
<p>也可以使用 url 的方式直连:</p>
<pre><code class="properties">spring.data.mongodb.url=mongodb://localhost:27017/test</code></pre>
<h4 id="4-如何工作的"><a href="#4-如何工作的" class="headerlink" title="4. 如何工作的"></a>4. 如何工作的</h4><p>同 <code>Spring Session Redis</code> 一样，将原本在 Tomcat 中的 <code>HttpSession</code> 持久化到 SpringSession 的实现中。</p>
<p>在 <code>Spring Security</code> 中，<code>SecurityContextPersistenceFilter</code> 将 <code>SecurityContext</code> 保存到 HttpSession 时，他就会被持久化到 Mongo 中。</p>
<p>参考资料：</p>
<ol>
<li><a href="https://docs.spring.io/spring-session-data-mongodb/docs/2.2.0.BUILD-SNAPSHOT/reference/htmlsingle/boot-mongo.html" target="_blank" rel="noopener">Spring Data Session MongoDB - DOCS</a></li>
<li><a href="https://docs.spring.io/spring-session-data-mongodb/docs/2.2.0.BUILD-SNAPSHOT/reference/htmlsingle/index.html" target="_blank" rel="noopener">Spring Session MongoDB - DOCS</a></li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/26/读书笔记/《SpringSession》/1_RedisSession/">《Spring Session》一、Spring Session Redis</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-26</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/">读书笔记</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/Spring-Session/">Spring Session</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Spring-Session/">Spring Session</a></span><div class="content"><h1 id="Spring-Session-Redis"><a href="#Spring-Session-Redis" class="headerlink" title="Spring Session Redis"></a>Spring Session Redis</h1><p>在 SpringBoot web 应用程序中，使用 Spring Session 来支持 HttpSession。</p>
<h3 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h3><pre><code class="xml">&lt;dependencies&gt;
    ......
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;
        &lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
<p>Spring Boot 为 Spring Session 提供了依赖管理，所以不需要声明依赖的版本。</p>
<h3 id="2-修改配置"><a href="#2-修改配置" class="headerlink" title="2. 修改配置"></a>2. 修改配置</h3><pre><code class="properties"># Session 的存储方式
spring.session.store-type=redis

# Session 会话超时时间 / 秒
server.servlet.session.timeout=600
# Session 的刷新策略
spring.session.redis.flush-mode=on-save
# 用于存储会话的键名
spring.session.redis.namespace=spring:session

# 连接 Redis
spring.redis.host=localhost
spring.redis.port=6379
spring.redis.password=password</code></pre>
<blockquote>
<p><code>spring.session.store-type=redis</code> 相当于手动添加注解 <code>@EnableRedisHttpSession</code>。此操作将会创建一个名为 <code>SpringSessionRepositoryFilter</code> 的过滤器，拦截并替换 SpringSession 支持的 HttpSession 实现。</p>
</blockquote>
<p>至此，启动项目并访问项目地址后，用户的 Session 信息存储在 Redis 而不是 Tomcat 的 HttpSession 实现中。</p>
<h3 id="3-如何工作的"><a href="#3-如何工作的" class="headerlink" title="3. 如何工作的"></a>3. 如何工作的</h3><p>Spring Session 用 Redis 支持的实现来替换 HttpSession。当 Spring Security 的 SecurityContextPersistenceFilter 将 SecurityContext 保存到 HttpSession 时，它将被持久化到 Redis 中。</p>
<p>当一个新的 HttpSession 被创建时，Spring Session 会在你的浏览器中创建一个名为 Session 的 cookie，该 cookie 包含会话的 ID，可以查看 cookies。</p>
<p>参考资料：</p>
<ol>
<li><a href="https://docs.spring.io/spring-session/docs/current/reference/html5/guides/boot-redis.html" target="_blank" rel="noopener">Spring Session Redis - DOCS</a></li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/24/读书笔记/《Docker全栈项目部署》/1.Docker/">Docker部署全栈：一、安装Docker环境</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-24</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/">运维</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/Docker全栈部署/">Docker全栈部署</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Docker全栈部署/">Docker全栈部署</a></span><div class="content"><h1 id="Docker部署全栈项目：一、安装Docker-环境"><a href="#Docker部署全栈项目：一、安装Docker-环境" class="headerlink" title="Docker部署全栈项目：一、安装Docker 环境"></a>Docker部署全栈项目：一、安装Docker 环境</h1><h2 id="一、Win-10-环境下安装"><a href="#一、Win-10-环境下安装" class="headerlink" title="一、Win 10 环境下安装"></a>一、Win 10 环境下安装</h2><h3 id="1-安装前提"><a href="#1-安装前提" class="headerlink" title="1. 安装前提"></a>1. 安装前提</h3><ol>
<li>需要 Windows 10 64位的系统</li>
<li>在 Windows 功能 中开启 Hyper-V 功能</li>
<li>下载 <a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">Docker Desktop for windows</a>，双击运行安装即可</li>
</ol>
<p><img src="https://i.loli.net/2019/09/23/7LRW5fCIO316Z2v.png" alt="图：开启Hyper-V功能"></p>
<h3 id="2-国内镜像加速"><a href="#2-国内镜像加速" class="headerlink" title="2. 国内镜像加速"></a>2. 国内镜像加速</h3><p>右键任务栏中的鲸鱼图标，进入 Settings &gt; Daemon，写入如下配置：</p>
<p><img src="https://i.loli.net/2019/09/23/iX3yz6mGHOgK9Vn.png" alt="图：配置镜像加速源"></p>
<blockquote>
<p>建议同时配置多个镜像，避免单个镜像服务宕机。</p>
</blockquote>
<h3 id="3-共享磁盘"><a href="#3-共享磁盘" class="headerlink" title="3. 共享磁盘"></a>3. 共享磁盘</h3><p>配置了磁盘共享后，Docker 才能够直接访问共享文件夹中的文件。</p>
<p><img src="https://i.loli.net/2019/09/23/xyfsne7NE6pj2VZ.png" alt="图：配置共享磁盘"></p>
<h3 id="4-测试"><a href="#4-测试" class="headerlink" title="4. 测试"></a>4. 测试</h3><p>打开 <code>Git Bash</code> 或 <code>CMD</code> 命令行，查看 docker 版本：</p>
<pre><code class="sh">$ docker --version
Docker version 19.03.1</code></pre>
<p>至此，Docker 安装成功。</p>
<p>拉取并运行一个 <code>hello-world</code> 镜像：</p>
<pre><code class="sh">$ docker run hello-world</code></pre>
<p>Docker 会依次进行：查找本地镜像 &gt; 拉取远程镜像 &gt; 运行container容器</p>
<blockquote>
<p>如果运行镜像时失败，请先将 Docker 切换至 <code>Linux container 模式</code></p>
</blockquote>
<p><img src="https://i.loli.net/2019/09/23/TAfNrB3sb2O641W.png" alt="图：切换Docker模式"></p>
<h3 id="5-可能存在的问题"><a href="#5-可能存在的问题" class="headerlink" title="5. 可能存在的问题"></a>5. 可能存在的问题</h3><p>如果您的 <code>Docker for Windows</code> 是从 <code>Docker Toolbox</code> 升级来的，那么可能会提示 <code>未找到CA</code> 。</p>
<h4 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h4><pre><code class="sh">$ docker
could not read CA certificate &quot;C:\\Users\\user\\.docker\\machine\\machines\\default\\ca.pem&quot;: open C:\Users\user\.docker\machine\machines\default\ca.pem: The system cannot find the path specified.</code></pre>
<h4 id="原因："><a href="#原因：" class="headerlink" title="原因："></a>原因：</h4><p>在卸载之前的 <code>Docker Toolbox</code> 时，并不会删除用户的 env 变量。</p>
<h4 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h4><ol>
<li>卸载 Docker Toolbox</li>
<li>卸载 VirtualBox</li>
<li>删除 Toolbox env 变量<ol>
<li>进入系统变量</li>
<li>从 /yoghurt 中删除所有 “DOCKER_*” 条目(如)</li>
</ol>
</li>
</ol>
<h2 id="二、Ubuntu-16-4-环境"><a href="#二、Ubuntu-16-4-环境" class="headerlink" title="二、Ubuntu 16.4 环境"></a>二、Ubuntu 16.4 环境</h2><h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h3><p>安装Docker 分为两种方式：</p>
<h4 id="使用-APT-安装"><a href="#使用-APT-安装" class="headerlink" title="使用 APT 安装"></a>使用 APT 安装</h4><pre><code class="sh"># 更新apt源
$ sudo apt-get update

# 添加HTTPS传输软件包和CA证书
$ sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    software-properties-common

# 使用国内源，添加 GPG 密钥(官方源：https://download.docker.com/linux/ubuntu/gpg)
$ curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg | sudo apt-key add -

# 更新 apt 缓存
$ sudo apt-get update

# 安装Docker CE
$ sudo apt-get install docker-ce</code></pre>
<h4 id="使用-脚本-自动安装"><a href="#使用-脚本-自动安装" class="headerlink" title="使用 脚本 自动安装"></a>使用 脚本 自动安装</h4><p>Docker 官方为了简化安装流程，提供了一个便捷的安装脚本：</p>
<pre><code class="sh">$ curl -fsSL get.docker.com -o get-docker.sh
$ sudo sh get-docker.sh -mirror Aliyun</code></pre>
<h4 id="启动-Docker-CE"><a href="#启动-Docker-CE" class="headerlink" title="启动 Docker CE"></a>启动 Docker CE</h4><pre><code class="sh">$ sudo systemctl enable docker
$ sudo systemctl start docker</code></pre>
<h3 id="2-国内镜像加速-1"><a href="#2-国内镜像加速-1" class="headerlink" title="2. 国内镜像加速"></a>2. 国内镜像加速</h3><p>在 <code>/etc/docker/daemon.json</code> 中(如果不存在，则新建)写入：</p>
<pre><code class="json">{
    &quot;registry-mirrors&quot;: [
        &quot;http://hub-mirror.c.163.com&quot;,
        &quot;https://reg-mirror.qiniu.com&quot;
    ]
}</code></pre>
<p>之后重启服务：</p>
<pre><code class="sh">$ sudo systemctl daemon-reload
$ sudo systemctl restart docker</code></pre>
<h3 id="3-卸载"><a href="#3-卸载" class="headerlink" title="3. 卸载"></a>3. 卸载</h3><pre><code class="sh">$ sudo apt-get remove docker \
    docker-engine \
    docker.io</code></pre>
<h3 id="4-测试-1"><a href="#4-测试-1" class="headerlink" title="4. 测试"></a>4. 测试</h3><p>同 Windows 版测试一样，运行一个 <code>hello-world image</code></p>
<pre><code class="sh">$ docker run hello-world</code></pre>
<h2 id="三、常用命令"><a href="#三、常用命令" class="headerlink" title="三、常用命令"></a>三、常用命令</h2><pre><code class="sh"># Windows 下进入容器的命令
$ winpty docker exec -it luokaiii-mongo bash

# Linux 下进入容器的命令
$ docker exec -it luokaiii-mongo bash</code></pre>
<p>参考资料：</p>
<ol>
<li><a href="https://docs.docker.com/docker-for-windows/index.html" target="_blank" rel="noopener">Docker Docs：https://docs.docker.com/docker-for-windows/</a></li>
<li>《Docker 技术入门与实践》杨保华版</li>
<li><a href="https://yeasy.gitbooks.io/docker_practice/index.html" target="_blank" rel="noopener">《Docker 从入门到实践》https://yeasy.gitbooks.io/docker_practice/</a></li>
</ol>
<h2 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h2><ul>
<li><p><a href="https://github.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Github</a></p>
</li>
<li><p><a href="https://gitee.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Gitee</a></p>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/23/读书笔记/《Docker全栈项目部署》/2.MongoDB/">Docker部署全栈：二、安装MongoDB</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-23</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/">运维</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/Docker全栈部署/">Docker全栈部署</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Docker全栈部署/">Docker全栈部署</a></span><div class="content"><h1 id="Docker部署全栈项目：二、MongoDB-镜像"><a href="#Docker部署全栈项目：二、MongoDB-镜像" class="headerlink" title="Docker部署全栈项目：二、MongoDB 镜像"></a>Docker部署全栈项目：二、MongoDB 镜像</h1><h2 id="一、编写启动脚本"><a href="#一、编写启动脚本" class="headerlink" title="一、编写启动脚本"></a>一、编写启动脚本</h2><pre><code class="sh">#!/bin/bash

cur_dir=`pwd`

# 停止并删除原有容器
docker stop luokaiii-mongo
docker rm luokaiii-mongo

# docker run 运行镜像
docker run --name luokaiii-mongo \ # --name 指定运行后的容器名称
        -v /${cur_dir}/data:/data/db \ # -v 挂载本地目录到容器中(也就是将容器中的数据保存到宿主机)
        -p 27016:27017 \ # 将容器的27017端口映射到宿主机的27016端口
        -e MONGO_INITDB_ROOT_USERNAME=mongoadmin \ # 指定mongo初始账户名称(可以在运行第一次之后，将账号密码这两条删除，以免密码泄露)
        -e MONGO_INITDB_ROOT_PASSWORD=password \ # 指定mongo初始账户密码
        -d mongo:4.0.12 # -d 后台运行；mongo:xx 运行的mongo版本(如果不加版本则默认为lastest)</code></pre>
<h2 id="二、运行脚本"><a href="#二、运行脚本" class="headerlink" title="二、运行脚本"></a>二、运行脚本</h2><p>在运行脚本前，需要先将存放数据的目录创建出来：</p>
<pre><code class="sh">$ cd /home/luokaiii/images/mongo   # 脚本和DB文件的存放位置

$ mkdir data   # 创建存储目录

$ ./start.sh   # 运行刚刚写的脚本
994e9e05bb42d1d.....  # 控制台打印这种的，即表示启动成功</code></pre>
<blockquote>
<p>上述写法，不限于 Windows 还是 Linux。</p>
<p>但是如果 Windows 无法执行 sh 文件，请将 CMD 命令行换成 Git Bash 命令行。</p>
</blockquote>
<h2 id="三、测试"><a href="#三、测试" class="headerlink" title="三、测试"></a>三、测试</h2><h3 id="1-浏览器访问27016端口"><a href="#1-浏览器访问27016端口" class="headerlink" title="1. 浏览器访问27016端口"></a>1. 浏览器访问27016端口</h3><p><img src="https://i.loli.net/2019/09/23/CImfovdxUe8MTlF.png" alt="浏览器访问27016端口"></p>
<h3 id="2-使用-Client-工具连接"><a href="#2-使用-Client-工具连接" class="headerlink" title="2. 使用 Client 工具连接"></a>2. 使用 Client 工具连接</h3><p><img src="https://i.loli.net/2019/09/23/C7erc6XbknyL4PO.png" alt="NoSQL工具连接"></p>
<h2 id="四、日志解释"><a href="#四、日志解释" class="headerlink" title="四、日志解释"></a>四、日志解释</h2><pre><code class="tex"># MongoDB 启动进程，端口、数据目录、版本
2019-09-23T07:19:56.012+0000 I CONTROL  [initandlisten] MongoDB starting : pid=25 port=27017 dbpath=/data/db 64-bit host=abeb2ca8fece
2019-09-23T07:19:56.012+0000 I CONTROL  [initandlisten] db version v4.0.12

# 插入用户成功
Successfully added user: {
        &quot;user&quot; : &quot;mongoadmin&quot;,
        &quot;roles&quot; : [
                {
                        &quot;role&quot; : &quot;root&quot;,
                        &quot;db&quot; : &quot;admin&quot;
                }
        ]
}

# MongoDB 显式地留给用户的身份验证
/usr/local/bin/docker-entrypoint.sh: ignoring /docker-entrypoint-initdb.d/*

# MongoDB 启动成功
MongoDB init process complete; ready for start up.</code></pre>
<blockquote>
<p>关于Linux版本如何运行，将放在Docker-Compose集中部署时一起写。</p>
</blockquote>
<p>参考资料：</p>
<ol>
<li><a href="https://hub.docker.com/_/mongo" target="_blank" rel="noopener">Docker Hub</a></li>
</ol>
<h2 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h2><ul>
<li><p><a href="https://github.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Github</a></p>
</li>
<li><p><a href="https://gitee.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Gitee</a></p>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/23/读书笔记/《Docker全栈项目部署》/0.全栈部署流程/">《Docker部署全栈》实战</a><span class="article-meta"><i class="fa fa-thumb-tack article-meta__icon sticky"></i><span class="sticky">置顶</span><span class="article-meta__separator" style="margin-right: 0.3rem">|</span></span><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-23</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/">运维</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/Docker全栈部署/">Docker全栈部署</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Docker全栈部署/">Docker全栈部署</a></span><div class="content"><ul>
<li><a href="/2019/09/24/读书笔记/《Docker全栈项目部署》/1.Docker/index.html">第一章 安装 Docker 环境</a></li>
<li><a href="/2019/09/23/读书笔记/《Docker全栈项目部署》/2.MongoDB/index.html">第二章 构建 MongoDB 容器</a></li>
<li><a href="/2019/09/22/读书笔记/《Docker全栈项目部署》/3.Redis/index.html">第三章 构建 Redis 容器</a></li>
<li><a href="/2019/09/21/读书笔记/《Docker全栈项目部署》/4.MariaDB/index.html">第四章 构建 MariaDB 容器</a></li>
<li><a href="/2019/09/20/读书笔记/《Docker全栈项目部署》/5.SpringBoot/index.html">第五章 部署 SpringBoot Jar 镜像</a></li>
<li><a href="/2019/09/19/读书笔记/《Docker全栈项目部署》/6.Nginx/index.html">第六章 构建 React 并部署至 Nginx 中</a></li>
<li><a href="/2019/09/18/读书笔记/《Docker全栈项目部署》/7.Docker-Compose/index.html">第七章 Docker-Compose 编排所有服务</a></li>
<li><a href="/2019/09/17/读书笔记/《Docker全栈项目部署》/8.DC命令/index.html">第八章 Docker-Compose 命令</a></li>
<li><a href="/2019/09/16/读书笔记/《Docker全栈项目部署》/9.Docker版本升级/index.html">第九章 Docker 版本升级</a></li>
</ul></div><a class="more" href="/2019/09/23/读书笔记/《Docker全栈项目部署》/0.全栈部署流程/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/22/读书笔记/《Docker全栈项目部署》/3.Redis/">Docker部署全栈：三、安装Redis</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/">运维</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/Docker全栈部署/">Docker全栈部署</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Docker全栈部署/">Docker全栈部署</a></span><div class="content"><h1 id="Docker部署全栈项目：三、Redis-镜像"><a href="#Docker部署全栈项目：三、Redis-镜像" class="headerlink" title="Docker部署全栈项目：三、Redis 镜像"></a>Docker部署全栈项目：三、Redis 镜像</h1><h2 id="一、编写启动脚本"><a href="#一、编写启动脚本" class="headerlink" title="一、编写启动脚本"></a>一、编写启动脚本</h2><pre><code class="sh">#!/bin/bash

curr=`PWD`

# 运行前先停止原有容器
docker stop luokaiii-redis
docker rm luokaiii-redis

# docker run 运行容器
docker run --name luokaiii-redis \ # 指定运行后的容器名称
        -p 7481:6379 \    # 将容器的6379端口映射到宿主机的7481端口
        -v /${curr}/data/:/data \ # 挂载redis持久化的目录到宿主机
        -d redis:4.0.14 \
        --requirepass &quot;password&quot; # 指定redis的连接密码</code></pre>
<blockquote>
<p>如果需要使用 conf 自定义配置，请参考 <a href="http://download.redis.io/redis-stable/redis.conf" target="_blank" rel="noopener">官网提供的 redis.conf</a> 。</p>
<p>Redis 的执行速度特别快，能到做到 15W/s 的查询，因此推荐使用较为复杂的密码。</p>
</blockquote>
<h2 id="二、启动脚本"><a href="#二、启动脚本" class="headerlink" title="二、启动脚本"></a>二、启动脚本</h2><pre><code class="sh">$ cd /home/luokaiii/images/redis   # 脚本和DB文件的存放位置

$ mkdir data   # 创建存储目录

$ ./start.sh   # 运行刚刚写的脚本
994e9e05bb42d1d.....  # 控制台打印这种的，即表示启动成功</code></pre>
<h2 id="三、日志解释"><a href="#三、日志解释" class="headerlink" title="三、日志解释"></a>三、日志解释</h2><pre><code class="tex"># Redis 启动、配置加载
1:C 23 Sep 08:55:24.988 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
1:C 23 Sep 08:55:24.988 # Redis version=4.0.14, bits=64, commit=00000000, modified=0, pid=1, just started
1:C 23 Sep 08:55:24.989 # Configuration loaded
1:M 23 Sep 08:55:24.992 * Running mode=standalone, port=6379.

# Redis 启动成功
1:M 23 Sep 08:55:24.993 * Ready to accept connections</code></pre>
<h2 id="四、测试"><a href="#四、测试" class="headerlink" title="四、测试"></a>四、测试</h2><p><img src="https://i.loli.net/2019/09/23/YH3OnIpa7G2vieK.png" alt="图：连接测试"></p>
<h2 id="五、遇到的问题"><a href="#五、遇到的问题" class="headerlink" title="五、遇到的问题"></a>五、遇到的问题</h2><h3 id="1-在-windows-下使用-redis-conf，失败"><a href="#1-在-windows-下使用-redis-conf，失败" class="headerlink" title="1. 在 windows 下使用 redis.conf，失败"></a>1. 在 windows 下使用 redis.conf，失败</h3><p>使用 redis.conf 的 Redis 启动脚本，配置来源于 <a href="http://download.redis.io/redis-stable/redis.conf" target="_blank" rel="noopener">官网提供的 redis.conf</a>，且未做任何修改。</p>
<pre><code class="sh">docker run --name luokaiii-redis \ # 指定运行后的容器名称
        -p 7481:6379 \    # 将容器的6379端口映射到宿主机的7481端口
        -v /${PWD}/data/:/data \ # 挂载redis持久化的目录到宿主机
        -v /${PWD}/redis.conf:/usr/local/etc/redis/redis.conf \ # 挂载redis.conf
        -d redis:4.0.14 \ # 后台运行容器
        redis-server /usr/local/etc/redis/redis.conf</code></pre>
<p>执行脚本参考自 <a href="https://hub.docker.com/_/redis?tab=description" target="_blank" rel="noopener">Docker Hub</a>。</p>
<p><img src="https://i.loli.net/2019/09/23/DvtaXPkubZUJL6A.png" alt="图：DockerHub提供的redis启动脚本"></p>
<h4 id="错误提示"><a href="#错误提示" class="headerlink" title="错误提示"></a>错误提示</h4><pre><code class="sh">1:C 23 Sep 08:43:00.482 # Fatal error, can&#39;t open config file &#39;C:/Program Files/Git/usr/local/etc/redis/redis.conf&#39;</code></pre>
<h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>未知。不明白为什么 Docker Container 会提示出 ‘C:/…’ 路径。</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>Windows 环境不使用 redis.conf. </p>
<blockquote>
<p>Ubuntu 下使用相同配置并无问题。以下是部署流程：</p>
</blockquote>
<p><img src="https://i.loli.net/2019/09/23/mXkanxRFu8HIYfi.png" alt="Linux下配置"></p>
<p>连接验证：</p>
<p><img src="https://i.loli.net/2019/09/23/i7rZhyLgPHwbnDI.png" alt="连接Linux下的Redis"></p>
<h2 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h2><ul>
<li><p><a href="https://github.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Github</a></p>
</li>
<li><p><a href="https://gitee.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Gitee</a></p>
</li>
</ul>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/10/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" href="/page/12/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By koral</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>