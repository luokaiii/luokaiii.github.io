<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="描述"><meta name="keywords" content="1,2,3"><meta name="author" content="koral"><meta name="copyright" content="koral"><title>凯 | 凯</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">koral</div><div class="author-info__description text-center">描述</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">241</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">22</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">19</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">凯</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">凯</div><div id="site-sub-title">凯</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2019/06/20/读书笔记/《高性能MySQL》/3.数据库SQL开发规范/">《高性能MySQL》第一章 数据库设计规范</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-06-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/高性能MySQL/">高性能MySQL</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/MySQL/">MySQL</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/数据库/">数据库</a></span><div class="content"><h1 id="第三章-数据库-SQL-开发规范"><a href="#第三章-数据库-SQL-开发规范" class="headerlink" title="第三章 数据库 SQL 开发规范"></a>第三章 数据库 SQL 开发规范</h1><ol>
<li>建议使用预编译语句进行数据库操作<ol>
<li>预编译语句可以重复使用执行计划</li>
<li>可以有效避免动态 SQL 带来的 SQL 注入问题</li>
<li>只传参数，比传递 SQL 语句更高效</li>
<li>相同语句可以一次解析，多次使用，提高处理效率</li>
</ol>
</li>
<li>避免数据类型的隐式转换<ol>
<li>隐式转换会导致索引失效</li>
<li>eg: select name,phone from customer where id = ‘111’</li>
</ol>
</li>
<li>充分利用表上已经存在的索引<ol>
<li>避免使用 双% 的查询条件。如 a like ‘%123%’</li>
<li>一个 SQL 只能利用到复合索引中的一列进行范围查询</li>
<li>使用 left join 或 not exists 来优化 not in 操作<ol>
<li>not in 会使索引失效</li>
</ol>
</li>
</ol>
</li>
<li>程序连接不同的数据库使用不同的账号，禁止夸库查询<ol>
<li>为数据库迁移和分库分表留出余地</li>
<li>降低业务耦合度</li>
<li>避免权限过大而产生的安全风险</li>
</ol>
</li>
<li>禁止使用 SELECT * ，必须使用 SELECT &lt;字段列表&gt; 查询<ol>
<li>消耗更多的CPU和IO，以及网络带宽资源</li>
<li>无法使用覆盖索引</li>
<li>可减少表结构变更带来的影响</li>
</ol>
</li>
<li>禁止使用不含字段列表的 INSERT 语句<ol>
<li>eg：insert into tb_xx values(a,b,c) 错误</li>
<li>eg：insert into t(c1,c2,c3) values(a,b,c) 正确</li>
<li>避免因为字段变更，导致的插入失败</li>
</ol>
</li>
<li>避免使用子查询，可以把子查询优化为 join 操作<ol>
<li>子查询的结果集无法使用索引</li>
<li>子查询会产生临时表操作，如果子查询数据量大则严重影响效率</li>
<li>消耗过多的 CPU 及 IO 操作</li>
<li>包含 GROUP BY、ORDER BY 等操作的子查询，无法转换为 JOIN 操作</li>
</ol>
</li>
<li>避免使用 JOIN 关联<code>太多</code>的表<ol>
<li>每 JOIN 一个表会多占用一部分内存</li>
<li>会产生临时表操作，影响查询操作</li>
<li>MySQl 最多允许关联 61 个表，建议不超过 5 个</li>
</ol>
</li>
<li>减少同数据库的交互次数<ol>
<li>数据库更适合处理批量操作</li>
<li>合并多个相同的操作到一起，可以提高处理效率</li>
<li>eg：alter table t1 add column c1 int, change column c2 c2 int</li>
</ol>
</li>
<li>使用 in 代替 or<ol>
<li>in 的值不要超过 500个</li>
<li>in 操作可以有效的利用索引</li>
</ol>
</li>
<li>禁止使用 order by rand() 进行随机排序<ol>
<li>会把表中所有符合条件的数据装载到内存中进行排序</li>
<li>会消耗大量的 CPU 和 IO 及内存资源</li>
<li>推荐在程序中获取一个随机值，然后从数据库中获取数据的方式</li>
</ol>
</li>
<li>where 从句中禁止对列进行函数转换和计算<ol>
<li>对列进行函数转换或计算会导致无法使用索引</li>
<li>eg：where date(createtime) = ‘20160901’<ol>
<li>这样的话，无法使用到 createtime 列上的索引</li>
<li>可以修改为：where createtime &gt;= ‘20160901’ and createtime &lt; ‘20160902’</li>
</ol>
</li>
</ol>
</li>
<li>在明显不会有重复值时使用 UNION ALL 而不是 UNION<ol>
<li>UNION 会把所有数据放到临时表中后再进行去重操作</li>
<li>UNION ALL 不会再对结果集进行去重操作</li>
</ol>
</li>
<li>拆分复杂的大 SQL 为多个小 SQL<ol>
<li>MySQL 一个 SQL 只能使用一个 CPU 进行计算</li>
<li>SQL 拆分后可以通过并行执行来提高处理效率<ol>
<li>拆分 SQL 之后，多个小 SQL 能够更好的利用 CPU 资源</li>
</ol>
</li>
<li>需要拆分的 SQL 为书写复杂，且执行时间长的。避免因 SQL 执行过长导致处理效率缓慢。</li>
</ol>
</li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/06/20/读书笔记/《高性能MySQL》/2.数据库字段设计规范/">《高性能MySQL》第一章 数据库设计规范</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-06-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/高性能MySQL/">高性能MySQL</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/MySQL/">MySQL</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/数据库/">数据库</a></span><div class="content"><h1 id="第二张-数据库字段设计规范"><a href="#第二张-数据库字段设计规范" class="headerlink" title="第二张 数据库字段设计规范"></a>第二张 数据库字段设计规范</h1><p>字段类型的选择，会直接影响数据库的性能。</p>
<ol>
<li>优先选择符合存储需要的最小的数据类型<ol>
<li>字段的长度越长，导致索引的长度也会越长</li>
<li>将字符串转换为数字类型存储<ol>
<li>INET_ATON(‘255.255.255.255’) = 4294967295</li>
<li>INET_NTOA(4294967295) = ‘255.255.255.255’</li>
</ol>
</li>
<li>对于非负整数的数据，优先使用无符号整型存储<ol>
<li>无符号比有符号的数据多出一倍的存储空间</li>
<li>eg：SIGNED INT -2147483648 ~ 2147483647 ; UNSIGNED INT = 4294967295</li>
</ol>
</li>
<li>VARCHAR(N) 中的N代表的是字符数，而不是字节数</li>
<li>使用 UTF8 存储汉字 Varchar(255) = 765个字节</li>
<li>过大的长度会消耗更多的内存</li>
</ol>
</li>
<li>避免使用 TEXT、BLOB 数据类型<ol>
<li>建议把 BLOB 或是 TEXT 列分离到单独的扩展表中，且不要使用 SELECT * 这样的查询</li>
<li>TEXT 或 BLOB 类型只能使用前缀索引</li>
</ol>
</li>
<li>避免使用 ENUM 数据类型<ol>
<li>修改 ENUM 值需要使用 ALTER 语句</li>
<li>ENUM类型的 ORDER BY 操作效率低，需要额外操作<ol>
<li>ENUM 在进行 ORDER BY 操作时，会将枚举转换为整型进行排序，排序效率低</li>
</ol>
</li>
<li>禁止使用数值作为 ENUM 数据类型</li>
</ol>
</li>
<li>尽可能把所有列定义为 NOT NULL<ol>
<li>索引 NULL 列需要额外的空间来保存<ol>
<li>为 NULL 的列索引，会多出一部分存储空间，用来标识该列是否为空</li>
<li>索引空间占用越少越好</li>
</ol>
</li>
<li>进行比较和计算时对 NULL 值做特别的处理</li>
</ol>
</li>
<li>不建议使用，字符串存储日期型的数据<ol>
<li>缺点一：无法使用日期函数进行计算和比较</li>
<li>缺点二：用字符串存储日期需要占用更多的空间<ol>
<li>使用字符串存储需要占用 16 个字节</li>
<li>而使用日期类型只需要 8 个字节</li>
</ol>
</li>
</ol>
</li>
<li>使用 TIMESTAMP 或 DATETIME 类型存储时间<ol>
<li>TIMESTAMP 1970-01-01 ~ 2038-01-19</li>
<li>TIMESTAMP 占用 4 字节，底层以 INT 存储，但是可读性比 INT 高</li>
</ol>
</li>
<li>同财务相关的金额类数据，必须使用 decimal 类型<ol>
<li>Decimal 类型为精准浮点数，在计算时不会丢失精度</li>
<li>占用空间由定义的宽度决定</li>
<li>可用于存储比 bigint 更大的整型数据</li>
</ol>
</li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/06/20/读书笔记/《高性能MySQL》/1.数据库设计规范/">《高性能MySQL》第一章 数据库设计规范</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-06-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/高性能MySQL/">高性能MySQL</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/MySQL/">MySQL</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/数据库/">数据库</a></span><div class="content"><h1 id="第一章-数据库设计规范"><a href="#第一章-数据库设计规范" class="headerlink" title="第一章 数据库设计规范"></a>第一章 数据库设计规范</h1><h2 id="1-数据库-命名规范"><a href="#1-数据库-命名规范" class="headerlink" title="1. 数据库 - 命名规范"></a>1. 数据库 - 命名规范</h2><ol>
<li>所有数据库对象名称必须使用小写字母并用下划线分割<ol>
<li>eg：DbName != dbname</li>
<li>eg: Table != table != tabLe</li>
</ol>
</li>
<li>所有数据库对象名称禁止使用 MySQL 保留关键字<ol>
<li>保留关键字：<a href="https://dev.mysql.com/doc/refman/8.0/en/keywords.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/8.0/en/keywords.html</a></li>
</ol>
</li>
<li>数据库对象的命名要做到见名识义，并且最好不要超过 32 字符<ol>
<li>数据库名过长，会增加网络开销</li>
</ol>
</li>
<li>临时库必须以 tmp 为前缀，并以日期为后缀</li>
<li>备份库、备份表必须以 bak 为前缀，并以日期为后缀</li>
<li>所有存储相同数据的列名和列类型必须一致<ol>
<li>即表A与表B的某个属性相同，则列名与类型必须一致</li>
<li>如 A.cid与 B.cid，都必须是 <code>cid int unsigned not null</code></li>
<li>这种属性一般用于关联列上，当保持一致时，对数据库查询效率有一定帮助</li>
</ol>
</li>
</ol>
<h2 id="2-数据库-基本设计规范"><a href="#2-数据库-基本设计规范" class="headerlink" title="2. 数据库 - 基本设计规范"></a>2. 数据库 - 基本设计规范</h2><ol>
<li>所有表必须使用 Innodb 存储引擎<ol>
<li>在 MySQL 5.5 之前，MylSAM 是默认的存储引擎，MylSAM 是表级锁，在高并发场景下，锁表会有很严重的性能问题</li>
<li>InnoDB 是 5.6 以后的默认存储引擎</li>
<li>InnoDB 支持事务，行级锁，拥有更好的恢复性，高并发场景下性能更好</li>
</ol>
</li>
<li>数据库和表的字符集统一使用 UTF8<ol>
<li>统一字符集可以避免由于字符集转换产生的乱码</li>
<li>MySQL 中 UTF8 字符集汉字占 3 个字节，ASCII 码占一个字符</li>
</ol>
</li>
<li>所有表和字段都需要添加注释<ol>
<li>使用 comment 从句添加表和列的备注</li>
<li>从一开始就进行数据字典的维护</li>
</ol>
</li>
<li>尽量控制单表数据量的大小，建议控制在 500W 以内<ol>
<li>500 W 并不是 MySQL 数据库的限制</li>
<li>可以使用历史数据归档，分库分表等手段限制单表的数据量大小</li>
</ol>
</li>
<li>谨慎使用 MySQL 分区表<ol>
<li>分区表在物理上表现为多个文件，在逻辑上表现为一个表</li>
<li>谨慎选择分区键，跨分区查询效率可能更低</li>
<li>建议采用物理分表的方式管理大数据</li>
</ol>
</li>
<li>尽量做到冷热数据分离，减小表的宽度<ol>
<li>减少磁盘IO，保证热数据的内存缓存命中率</li>
<li>更有效的利用缓存，避免读入无用的冷数据</li>
<li>经常一起使用的列放在一个表中</li>
</ol>
</li>
<li>禁止在表中建立预留字段<ol>
<li>预留字段的命名很难做到见名识义</li>
<li>预留字段无法确认存储的数据类型，所以无法选择合适的类型</li>
<li>对预留字段类型的修改，会对表进行锁定<ol>
<li>在 MySQL 中，对表类型修改的成本远远大于增加一个数据类型的成本</li>
</ol>
</li>
</ol>
</li>
<li>禁止在数据库中存储图片，文件等二进制数据<ol>
<li>blob、text 等类型</li>
</ol>
</li>
<li>禁止在线上做数据库压力测试</li>
<li>禁止从开发环境、测试环境直连生产环境数据库</li>
</ol>
<h2 id="3-数据库-索引设计规范"><a href="#3-数据库-索引设计规范" class="headerlink" title="3. 数据库 - 索引设计规范"></a>3. 数据库 - 索引设计规范</h2><ol>
<li>限制每张表的索引数量，建议单张表索引不超过 5 个<ol>
<li>索引并不是越多越好，过多的索引可能会降低效率</li>
<li>禁止给表中的每一列都建立单独的索引</li>
</ol>
</li>
<li>每个 InnoDB 表必须有一个主键<ol>
<li>Innodb 是按照主键索引的顺序来组织表的，因此每个表必须有一个主键</li>
<li>如果表中未设置主键，MySQL 会自动选择第一个非空唯一性的属性作为主键；如果没有非空唯一约束的属性，MySQL 会自动生成一个 6 字节的主键，但是效率不高</li>
<li>不使用更新频繁的列作为主键，不使用多列主键</li>
<li>不使用 UUID、MD5、HASH、字符串列作为主键</li>
<li>主键建议选择使用主键自增ID</li>
</ol>
</li>
<li>常见索引建议<ol>
<li>SELECT、UPDATE、DELETE 语句的 WHERE 从句中的列</li>
<li>包含在 ORDER BY、GROUP BY、DISTINCT 中的字段</li>
<li>多表 JOIN 的字段</li>
</ol>
</li>
<li>如何选择索引列的顺序<ol>
<li>区分度最高的列放在联合索引的最左侧</li>
<li>尽量把字段长度小的列放在联合索引的最左侧</li>
<li>使用最频繁的列放在联合索引的最左侧</li>
</ol>
</li>
<li>避免建议冗余索引和重复索引<ol>
<li>eg: primary key(id) 、index(id)、unique index(id)</li>
<li>eg: index(a,b,c)，index(a,b)，index(a)<ol>
<li>对于冗余索引，MySQL 执行优化器会对查询到的索引进行选择，降低了索引使用的效率</li>
</ol>
</li>
</ol>
</li>
<li>对于频繁的查询优先考虑使用覆盖索引<ol>
<li>避免 Innodb 表进行索引的二次查找</li>
<li>可以把随机 IO 变为顺序 IO，提高查询效率</li>
</ol>
</li>
<li>尽量避免使用外键<ol>
<li>不建议使用外键约束，但一定在表与表之间的关联键上建立索引</li>
<li>外键可用于保证数据的参照完整性，但建议在业务端实现</li>
<li>外键会影响父表和子表的写操作从而降低性能<ol>
<li>存在外键约束的表在进行写操作时，会检查外键约束的完整性，降低写操作的性能</li>
</ol>
</li>
</ol>
</li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/06/14/读书笔记/《Java并发编程的艺术》/0.0_目录/">《Java并发编程的艺术》读书笔记 - 目录</a><span class="article-meta"><i class="fa fa-thumb-tack article-meta__icon sticky"></i><span class="sticky">置顶</span><span class="article-meta__separator" style="margin-right: 0.3rem">|</span></span><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-06-14</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Java并发编程的艺术/">Java并发编程的艺术</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/读书笔记/">读书笔记</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/并发编程/">并发编程</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/高并发/">高并发</a></span><div class="content"><p><img src="https://images.gitbook.cn/FqT6_h3A4raxz0Sw6-cR9o8TdQIo?imageView2/2/h/500" alt="Java并发编程的艺术"></p></div><a class="more" href="/2019/06/14/读书笔记/《Java并发编程的艺术》/0.0_目录/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/06/14/读书笔记/《Java并发编程的艺术》/11.Java并发编程实践/">《Java并发编程的艺术》Java并发编程实践</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-06-14</time><div class="content"></div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/34/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/34/">34</a><span class="page-number current">35</span><a class="page-number" href="/page/36/">36</a><span class="space">&hellip;</span><a class="page-number" href="/page/49/">49</a><a class="extend next" rel="next" href="/page/36/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By koral</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>