<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="描述"><meta name="keywords" content="1,2,3"><meta name="author" content="koral"><meta name="copyright" content="koral"><title>凯 | 凯</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">koral</div><div class="author-info__description text-center">描述</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives/index.html"><span class="pull-left">文章</span><span class="pull-right">213</span></a><a class="author-info-articles__tags article-meta" href="/tags/index.html"><span class="pull-left">标签</span><span class="pull-right">33</span></a><a class="author-info-articles__categories article-meta" href="/categories/index.html"><span class="pull-left">分类</span><span class="pull-right">45</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/index.html">凯</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives/index.html">归档</a><a class="site-page" href="/tags/index.html">标签</a><a class="site-page" href="/categories/index.html">分类</a><a class="site-page" href="/about/index.html">关于我</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">凯</div><div id="site-sub-title">凯</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/26/读书笔记/Spring技术内幕/1_简介/index.html">《Spring技术内幕》读书笔记</a><span class="article-meta"><i class="fa fa-thumb-tack article-meta__icon sticky"></i><span class="sticky">置顶</span><span class="article-meta__separator" style="margin-right: 0.3rem">|</span></span><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-26</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/index.html">读书笔记</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/Spring技术内幕/index.html">Spring技术内幕</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Spring技术内幕/index.html">Spring技术内幕</a></span><div class="content"><p>随着 Spring 的不断成熟和完善，Spring 现已发展成为一个包含软件构建、开发、运行、部署整个软件生命周期的产品族群。</p></div><a class="more" href="/2019/09/26/读书笔记/Spring技术内幕/1_简介/index.html#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/26/读书笔记/《SpringSession》/2_MongoSession/index.html">《Spring Session》二、Spring Session MongoDB</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-26</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/index.html">读书笔记</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/Spring-Session/index.html">Spring Session</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/index.html">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Spring-Session/index.html">Spring Session</a></span><div class="content"><h1 id="Spring-Session-MongoDB"><a href="#Spring-Session-MongoDB" class="headerlink" title="Spring Session MongoDB"></a>Spring Session MongoDB</h1><p><code>Spring Session MongoDB</code> 提供了一个在 <code>MongoDB</code> 上存储 Session 的 API 和实现。</p>
<p>最低版本要求：</p>
<ol>
<li>JAVA 8</li>
<li>Servlet 2.5+</li>
<li>Spring 5.0</li>
</ol>
<h3 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h3><pre><code class="xml">&lt;dependencies&gt;
    ......
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;
        &lt;artifactId&gt;spring-session-data-mongodb&lt;/artifactId&gt;
        &lt;version&gt;${spring-session-data-mongodb.version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boo&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
<h3 id="2-Spring-Configuration"><a href="#2-Spring-Configuration" class="headerlink" title="2. Spring Configuration"></a>2. Spring Configuration</h3><p>增加一个配置类，用于声明 Spring Session 的实现替换 HttpSession 的实现。</p>
<pre><code class="java">/**
 * 创建一个名为 SpringSessionRepositoryFilter 的过滤器
 *  负责替换 SpringSession 支持的 HttpSession 实现。
 */
@EnableMongoHttpSession
public class HttpSessionConfig {
    @Bean
    public JdkMongoSessionConverter jdkMongoSessionConverter() {
        return new JdkMongoSessionConverter(Duration.ofMinutes(30));
    }
}</code></pre>
<p>为了能在 MongoDB 中持久化 Session 对象，需要提供 序列化与反序列化 机制。默认情况下，使用 <code>JdkMongoSessionConverter</code>。</p>
<p>您也可以替换使用 JacksonMongoSessionConverter，或者自定义其实现。</p>
<h3 id="3-连接-MongoDB"><a href="#3-连接-MongoDB" class="headerlink" title="3. 连接 MongoDB"></a>3. 连接 MongoDB</h3><pre><code class="properties">spring.data.mongodb.host=localhost
spring.data.mongodb.port=27017
spring.data.mongodb.database=test</code></pre>
<p>也可以使用 url 的方式直连:</p>
<pre><code class="properties">spring.data.mongodb.url=mongodb://localhost:27017/test</code></pre>
<h4 id="4-如何工作的"><a href="#4-如何工作的" class="headerlink" title="4. 如何工作的"></a>4. 如何工作的</h4><p>同 <code>Spring Session Redis</code> 一样，将原本在 Tomcat 中的 <code>HttpSession</code> 持久化到 SpringSession 的实现中。</p>
<p>在 <code>Spring Security</code> 中，<code>SecurityContextPersistenceFilter</code> 将 <code>SecurityContext</code> 保存到 HttpSession 时，他就会被持久化到 Mongo 中。</p>
<p>参考资料：</p>
<ol>
<li><a href="https://docs.spring.io/spring-session-data-mongodb/docs/2.2.0.BUILD-SNAPSHOT/reference/htmlsingle/boot-mongo.html" target="_blank" rel="noopener">Spring Data Session MongoDB - DOCS</a></li>
<li><a href="https://docs.spring.io/spring-session-data-mongodb/docs/2.2.0.BUILD-SNAPSHOT/reference/htmlsingle/index.html" target="_blank" rel="noopener">Spring Session MongoDB - DOCS</a></li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/26/读书笔记/《SpringSession》/1_RedisSession/index.html">《Spring Session》一、Spring Session Redis</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-26</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/index.html">读书笔记</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/读书笔记/Spring-Session/index.html">Spring Session</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/index.html">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Spring-Session/index.html">Spring Session</a></span><div class="content"><h1 id="Spring-Session-Redis"><a href="#Spring-Session-Redis" class="headerlink" title="Spring Session Redis"></a>Spring Session Redis</h1><p>在 SpringBoot web 应用程序中，使用 Spring Session 来支持 HttpSession。</p>
<h3 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h3><pre><code class="xml">&lt;dependencies&gt;
    ......
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;
        &lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
<p>Spring Boot 为 Spring Session 提供了依赖管理，所以不需要声明依赖的版本。</p>
<h3 id="2-修改配置"><a href="#2-修改配置" class="headerlink" title="2. 修改配置"></a>2. 修改配置</h3><pre><code class="properties"># Session 的存储方式
spring.session.store-type=redis

# Session 会话超时时间 / 秒
server.servlet.session.timeout=600
# Session 的刷新策略
spring.session.redis.flush-mode=on-save
# 用于存储会话的键名
spring.session.redis.namespace=spring:session

# 连接 Redis
spring.redis.host=localhost
spring.redis.port=6379
spring.redis.password=password</code></pre>
<blockquote>
<p><code>spring.session.store-type=redis</code> 相当于手动添加注解 <code>@EnableRedisHttpSession</code>。此操作将会创建一个名为 <code>SpringSessionRepositoryFilter</code> 的过滤器，拦截并替换 SpringSession 支持的 HttpSession 实现。</p>
</blockquote>
<p>至此，启动项目并访问项目地址后，用户的 Session 信息存储在 Redis 而不是 Tomcat 的 HttpSession 实现中。</p>
<h3 id="3-如何工作的"><a href="#3-如何工作的" class="headerlink" title="3. 如何工作的"></a>3. 如何工作的</h3><p>Spring Session 用 Redis 支持的实现来替换 HttpSession。当 Spring Security 的 SecurityContextPersistenceFilter 将 SecurityContext 保存到 HttpSession 时，它将被持久化到 Redis 中。</p>
<p>当一个新的 HttpSession 被创建时，Spring Session 会在你的浏览器中创建一个名为 Session 的 cookie，该 cookie 包含会话的 ID，可以查看 cookies。</p>
<p>参考资料：</p>
<ol>
<li><a href="https://docs.spring.io/spring-session/docs/current/reference/html5/guides/boot-redis.html" target="_blank" rel="noopener">Spring Session Redis - DOCS</a></li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/24/读书笔记/《Docker全栈项目部署》/1.Docker/index.html">Docker部署全栈：一、安装Docker环境</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-24</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/index.html">运维</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/Docker全栈部署/index.html">Docker全栈部署</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/index.html">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Docker全栈部署/index.html">Docker全栈部署</a></span><div class="content"><h1 id="Docker部署全栈项目：一、安装Docker-环境"><a href="#Docker部署全栈项目：一、安装Docker-环境" class="headerlink" title="Docker部署全栈项目：一、安装Docker 环境"></a>Docker部署全栈项目：一、安装Docker 环境</h1><h2 id="一、Win-10-环境下安装"><a href="#一、Win-10-环境下安装" class="headerlink" title="一、Win 10 环境下安装"></a>一、Win 10 环境下安装</h2><h3 id="1-安装前提"><a href="#1-安装前提" class="headerlink" title="1. 安装前提"></a>1. 安装前提</h3><ol>
<li>需要 Windows 10 64位的系统</li>
<li>在 Windows 功能 中开启 Hyper-V 功能</li>
<li>下载 <a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">Docker Desktop for windows</a>，双击运行安装即可</li>
</ol>
<p><img src="https://i.loli.net/2019/09/23/7LRW5fCIO316Z2v.png" alt="图：开启Hyper-V功能"></p>
<h3 id="2-国内镜像加速"><a href="#2-国内镜像加速" class="headerlink" title="2. 国内镜像加速"></a>2. 国内镜像加速</h3><p>右键任务栏中的鲸鱼图标，进入 Settings &gt; Daemon，写入如下配置：</p>
<p><img src="https://i.loli.net/2019/09/23/iX3yz6mGHOgK9Vn.png" alt="图：配置镜像加速源"></p>
<blockquote>
<p>建议同时配置多个镜像，避免单个镜像服务宕机。</p>
</blockquote>
<h3 id="3-共享磁盘"><a href="#3-共享磁盘" class="headerlink" title="3. 共享磁盘"></a>3. 共享磁盘</h3><p>配置了磁盘共享后，Docker 才能够直接访问共享文件夹中的文件。</p>
<p><img src="https://i.loli.net/2019/09/23/xyfsne7NE6pj2VZ.png" alt="图：配置共享磁盘"></p>
<h3 id="4-测试"><a href="#4-测试" class="headerlink" title="4. 测试"></a>4. 测试</h3><p>打开 <code>Git Bash</code> 或 <code>CMD</code> 命令行，查看 docker 版本：</p>
<pre><code class="sh">$ docker --version
Docker version 19.03.1</code></pre>
<p>至此，Docker 安装成功。</p>
<p>拉取并运行一个 <code>hello-world</code> 镜像：</p>
<pre><code class="sh">$ docker run hello-world</code></pre>
<p>Docker 会依次进行：查找本地镜像 &gt; 拉取远程镜像 &gt; 运行container容器</p>
<blockquote>
<p>如果运行镜像时失败，请先将 Docker 切换至 <code>Linux container 模式</code></p>
</blockquote>
<p><img src="https://i.loli.net/2019/09/23/TAfNrB3sb2O641W.png" alt="图：切换Docker模式"></p>
<h3 id="5-可能存在的问题"><a href="#5-可能存在的问题" class="headerlink" title="5. 可能存在的问题"></a>5. 可能存在的问题</h3><p>如果您的 <code>Docker for Windows</code> 是从 <code>Docker Toolbox</code> 升级来的，那么可能会提示 <code>未找到CA</code> 。</p>
<h4 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h4><pre><code class="sh">$ docker
could not read CA certificate &quot;C:\\Users\\user\\.docker\\machine\\machines\\default\\ca.pem&quot;: open C:\Users\user\.docker\machine\machines\default\ca.pem: The system cannot find the path specified.</code></pre>
<h4 id="原因："><a href="#原因：" class="headerlink" title="原因："></a>原因：</h4><p>在卸载之前的 <code>Docker Toolbox</code> 时，并不会删除用户的 env 变量。</p>
<h4 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h4><ol>
<li>卸载 Docker Toolbox</li>
<li>卸载 VirtualBox</li>
<li>删除 Toolbox env 变量<ol>
<li>进入系统变量</li>
<li>从 /yoghurt 中删除所有 “DOCKER_*” 条目(如)</li>
</ol>
</li>
</ol>
<h2 id="二、Ubuntu-16-4-环境"><a href="#二、Ubuntu-16-4-环境" class="headerlink" title="二、Ubuntu 16.4 环境"></a>二、Ubuntu 16.4 环境</h2><h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h3><p>安装Docker 分为两种方式：</p>
<h4 id="使用-APT-安装"><a href="#使用-APT-安装" class="headerlink" title="使用 APT 安装"></a>使用 APT 安装</h4><pre><code class="sh"># 更新apt源
$ sudo apt-get update

# 添加HTTPS传输软件包和CA证书
$ sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    software-properties-common

# 使用国内源，添加 GPG 密钥(官方源：https://download.docker.com/linux/ubuntu/gpg)
$ curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg | sudo apt-key add -

# 更新 apt 缓存
$ sudo apt-get update

# 安装Docker CE
$ sudo apt-get install docker-ce</code></pre>
<h4 id="使用-脚本-自动安装"><a href="#使用-脚本-自动安装" class="headerlink" title="使用 脚本 自动安装"></a>使用 脚本 自动安装</h4><p>Docker 官方为了简化安装流程，提供了一个便捷的安装脚本：</p>
<pre><code class="sh">$ curl -fsSL get.docker.com -o get-docker.sh
$ sudo sh get-docker.sh -mirror Aliyun</code></pre>
<h4 id="启动-Docker-CE"><a href="#启动-Docker-CE" class="headerlink" title="启动 Docker CE"></a>启动 Docker CE</h4><pre><code class="sh">$ sudo systemctl enable docker
$ sudo systemctl start docker</code></pre>
<h3 id="2-国内镜像加速-1"><a href="#2-国内镜像加速-1" class="headerlink" title="2. 国内镜像加速"></a>2. 国内镜像加速</h3><p>在 <code>/etc/docker/daemon.json</code> 中(如果不存在，则新建)写入：</p>
<pre><code class="json">{
    &quot;registry-mirrors&quot;: [
        &quot;http://hub-mirror.c.163.com&quot;,
        &quot;https://reg-mirror.qiniu.com&quot;
    ]
}</code></pre>
<p>之后重启服务：</p>
<pre><code class="sh">$ sudo systemctl daemon-reload
$ sudo systemctl restart docker</code></pre>
<h3 id="3-卸载"><a href="#3-卸载" class="headerlink" title="3. 卸载"></a>3. 卸载</h3><pre><code class="sh">$ sudo apt-get remove docker \
    docker-engine \
    docker.io</code></pre>
<h3 id="4-测试-1"><a href="#4-测试-1" class="headerlink" title="4. 测试"></a>4. 测试</h3><p>同 Windows 版测试一样，运行一个 <code>hello-world image</code></p>
<pre><code class="sh">$ docker run hello-world</code></pre>
<h2 id="三、常用命令"><a href="#三、常用命令" class="headerlink" title="三、常用命令"></a>三、常用命令</h2><pre><code class="sh"># Windows 下进入容器的命令
$ winpty docker exec -it luokaiii-mongo bash

# Linux 下进入容器的命令
$ docker exec -it luokaiii-mongo bash</code></pre>
<p>参考资料：</p>
<ol>
<li><a href="https://docs.docker.com/docker-for-windows/index.html" target="_blank" rel="noopener">Docker Docs：https://docs.docker.com/docker-for-windows/</a></li>
<li>《Docker 技术入门与实践》杨保华版</li>
<li><a href="https://yeasy.gitbooks.io/docker_practice/index.html" target="_blank" rel="noopener">《Docker 从入门到实践》https://yeasy.gitbooks.io/docker_practice/</a></li>
</ol>
<h2 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h2><ul>
<li><p><a href="https://github.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Github</a></p>
</li>
<li><p><a href="https://gitee.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Gitee</a></p>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/23/读书笔记/《Docker全栈项目部署》/2.MongoDB/index.html">Docker部署全栈：二、安装MongoDB</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-23</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/index.html">运维</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/Docker全栈部署/index.html">Docker全栈部署</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/index.html">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Docker全栈部署/index.html">Docker全栈部署</a></span><div class="content"><h1 id="Docker部署全栈项目：二、MongoDB-镜像"><a href="#Docker部署全栈项目：二、MongoDB-镜像" class="headerlink" title="Docker部署全栈项目：二、MongoDB 镜像"></a>Docker部署全栈项目：二、MongoDB 镜像</h1><h2 id="一、编写启动脚本"><a href="#一、编写启动脚本" class="headerlink" title="一、编写启动脚本"></a>一、编写启动脚本</h2><pre><code class="sh">#!/bin/bash

cur_dir=`pwd`

# 停止并删除原有容器
docker stop luokaiii-mongo
docker rm luokaiii-mongo

# docker run 运行镜像
docker run --name luokaiii-mongo \ # --name 指定运行后的容器名称
        -v /${cur_dir}/data:/data/db \ # -v 挂载本地目录到容器中(也就是将容器中的数据保存到宿主机)
        -p 27016:27017 \ # 将容器的27017端口映射到宿主机的27016端口
        -e MONGO_INITDB_ROOT_USERNAME=mongoadmin \ # 指定mongo初始账户名称(可以在运行第一次之后，将账号密码这两条删除，以免密码泄露)
        -e MONGO_INITDB_ROOT_PASSWORD=password \ # 指定mongo初始账户密码
        -d mongo:4.0.12 # -d 后台运行；mongo:xx 运行的mongo版本(如果不加版本则默认为lastest)</code></pre>
<h2 id="二、运行脚本"><a href="#二、运行脚本" class="headerlink" title="二、运行脚本"></a>二、运行脚本</h2><p>在运行脚本前，需要先将存放数据的目录创建出来：</p>
<pre><code class="sh">$ cd /home/luokaiii/images/mongo   # 脚本和DB文件的存放位置

$ mkdir data   # 创建存储目录

$ ./start.sh   # 运行刚刚写的脚本
994e9e05bb42d1d.....  # 控制台打印这种的，即表示启动成功</code></pre>
<blockquote>
<p>上述写法，不限于 Windows 还是 Linux。</p>
<p>但是如果 Windows 无法执行 sh 文件，请将 CMD 命令行换成 Git Bash 命令行。</p>
</blockquote>
<h2 id="三、测试"><a href="#三、测试" class="headerlink" title="三、测试"></a>三、测试</h2><h3 id="1-浏览器访问27016端口"><a href="#1-浏览器访问27016端口" class="headerlink" title="1. 浏览器访问27016端口"></a>1. 浏览器访问27016端口</h3><p><img src="https://i.loli.net/2019/09/23/CImfovdxUe8MTlF.png" alt="浏览器访问27016端口"></p>
<h3 id="2-使用-Client-工具连接"><a href="#2-使用-Client-工具连接" class="headerlink" title="2. 使用 Client 工具连接"></a>2. 使用 Client 工具连接</h3><p><img src="https://i.loli.net/2019/09/23/C7erc6XbknyL4PO.png" alt="NoSQL工具连接"></p>
<h2 id="四、日志解释"><a href="#四、日志解释" class="headerlink" title="四、日志解释"></a>四、日志解释</h2><pre><code class="tex"># MongoDB 启动进程，端口、数据目录、版本
2019-09-23T07:19:56.012+0000 I CONTROL  [initandlisten] MongoDB starting : pid=25 port=27017 dbpath=/data/db 64-bit host=abeb2ca8fece
2019-09-23T07:19:56.012+0000 I CONTROL  [initandlisten] db version v4.0.12

# 插入用户成功
Successfully added user: {
        &quot;user&quot; : &quot;mongoadmin&quot;,
        &quot;roles&quot; : [
                {
                        &quot;role&quot; : &quot;root&quot;,
                        &quot;db&quot; : &quot;admin&quot;
                }
        ]
}

# MongoDB 显式地留给用户的身份验证
/usr/local/bin/docker-entrypoint.sh: ignoring /docker-entrypoint-initdb.d/*

# MongoDB 启动成功
MongoDB init process complete; ready for start up.</code></pre>
<blockquote>
<p>关于Linux版本如何运行，将放在Docker-Compose集中部署时一起写。</p>
</blockquote>
<p>参考资料：</p>
<ol>
<li><a href="https://hub.docker.com/_/mongo" target="_blank" rel="noopener">Docker Hub</a></li>
</ol>
<h2 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h2><ul>
<li><p><a href="https://github.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Github</a></p>
</li>
<li><p><a href="https://gitee.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Gitee</a></p>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/23/读书笔记/《Docker全栈项目部署》/0.全栈部署流程/index.html">《Docker部署全栈》实战</a><span class="article-meta"><i class="fa fa-thumb-tack article-meta__icon sticky"></i><span class="sticky">置顶</span><span class="article-meta__separator" style="margin-right: 0.3rem">|</span></span><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-23</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/index.html">运维</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/Docker全栈部署/index.html">Docker全栈部署</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Docker全栈部署/index.html">Docker全栈部署</a></span><div class="content"><ul>
<li><a href="/2019/09/24/读书笔记/《Docker全栈项目部署》/1.Docker/index.html">第一章 安装 Docker 环境</a></li>
<li><a href="/2019/09/23/读书笔记/《Docker全栈项目部署》/2.MongoDB/index.html">第二章 构建 MongoDB 容器</a></li>
<li><a href="/2019/09/22/读书笔记/《Docker全栈项目部署》/3.Redis/index.html">第三章 构建 Redis 容器</a></li>
<li><a href="/2019/09/21/读书笔记/《Docker全栈项目部署》/4.MariaDB/index.html">第四章 构建 MariaDB 容器</a></li>
<li><a href="/2019/09/20/读书笔记/《Docker全栈项目部署》/5.SpringBoot/index.html">第五章 部署 SpringBoot Jar 镜像</a></li>
<li><a href="/2019/09/19/读书笔记/《Docker全栈项目部署》/6.Nginx/index.html">第六章 构建 React 并部署至 Nginx 中</a></li>
<li><a href="/2019/09/18/读书笔记/《Docker全栈项目部署》/7.Docker-Compose/index.html">第七章 Docker-Compose 编排所有服务</a></li>
<li><a href="/2019/09/17/读书笔记/《Docker全栈项目部署》/8.DC命令/index.html">第八章 Docker-Compose 命令</a></li>
<li><a href="/2019/09/16/读书笔记/《Docker全栈项目部署》/9.Docker版本升级/index.html">第九章 Docker 版本升级</a></li>
</ul></div><a class="more" href="/2019/09/23/读书笔记/《Docker全栈项目部署》/0.全栈部署流程/index.html#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/22/读书笔记/《Docker全栈项目部署》/3.Redis/index.html">Docker部署全栈：三、安装Redis</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/index.html">运维</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/Docker全栈部署/index.html">Docker全栈部署</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/index.html">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Docker全栈部署/index.html">Docker全栈部署</a></span><div class="content"><h1 id="Docker部署全栈项目：三、Redis-镜像"><a href="#Docker部署全栈项目：三、Redis-镜像" class="headerlink" title="Docker部署全栈项目：三、Redis 镜像"></a>Docker部署全栈项目：三、Redis 镜像</h1><h2 id="一、编写启动脚本"><a href="#一、编写启动脚本" class="headerlink" title="一、编写启动脚本"></a>一、编写启动脚本</h2><pre><code class="sh">#!/bin/bash

curr=`PWD`

# 运行前先停止原有容器
docker stop luokaiii-redis
docker rm luokaiii-redis

# docker run 运行容器
docker run --name luokaiii-redis \ # 指定运行后的容器名称
        -p 7481:6379 \    # 将容器的6379端口映射到宿主机的7481端口
        -v /${curr}/data/:/data \ # 挂载redis持久化的目录到宿主机
        -d redis:4.0.14 \
        --requirepass &quot;password&quot; # 指定redis的连接密码</code></pre>
<blockquote>
<p>如果需要使用 conf 自定义配置，请参考 <a href="http://download.redis.io/redis-stable/redis.conf" target="_blank" rel="noopener">官网提供的 redis.conf</a> 。</p>
<p>Redis 的执行速度特别快，能到做到 15W/s 的查询，因此推荐使用较为复杂的密码。</p>
</blockquote>
<h2 id="二、启动脚本"><a href="#二、启动脚本" class="headerlink" title="二、启动脚本"></a>二、启动脚本</h2><pre><code class="sh">$ cd /home/luokaiii/images/redis   # 脚本和DB文件的存放位置

$ mkdir data   # 创建存储目录

$ ./start.sh   # 运行刚刚写的脚本
994e9e05bb42d1d.....  # 控制台打印这种的，即表示启动成功</code></pre>
<h2 id="三、日志解释"><a href="#三、日志解释" class="headerlink" title="三、日志解释"></a>三、日志解释</h2><pre><code class="tex"># Redis 启动、配置加载
1:C 23 Sep 08:55:24.988 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
1:C 23 Sep 08:55:24.988 # Redis version=4.0.14, bits=64, commit=00000000, modified=0, pid=1, just started
1:C 23 Sep 08:55:24.989 # Configuration loaded
1:M 23 Sep 08:55:24.992 * Running mode=standalone, port=6379.

# Redis 启动成功
1:M 23 Sep 08:55:24.993 * Ready to accept connections</code></pre>
<h2 id="四、测试"><a href="#四、测试" class="headerlink" title="四、测试"></a>四、测试</h2><p><img src="https://i.loli.net/2019/09/23/YH3OnIpa7G2vieK.png" alt="图：连接测试"></p>
<h2 id="五、遇到的问题"><a href="#五、遇到的问题" class="headerlink" title="五、遇到的问题"></a>五、遇到的问题</h2><h3 id="1-在-windows-下使用-redis-conf，失败"><a href="#1-在-windows-下使用-redis-conf，失败" class="headerlink" title="1. 在 windows 下使用 redis.conf，失败"></a>1. 在 windows 下使用 redis.conf，失败</h3><p>使用 redis.conf 的 Redis 启动脚本，配置来源于 <a href="http://download.redis.io/redis-stable/redis.conf" target="_blank" rel="noopener">官网提供的 redis.conf</a>，且未做任何修改。</p>
<pre><code class="sh">docker run --name luokaiii-redis \ # 指定运行后的容器名称
        -p 7481:6379 \    # 将容器的6379端口映射到宿主机的7481端口
        -v /${PWD}/data/:/data \ # 挂载redis持久化的目录到宿主机
        -v /${PWD}/redis.conf:/usr/local/etc/redis/redis.conf \ # 挂载redis.conf
        -d redis:4.0.14 \ # 后台运行容器
        redis-server /usr/local/etc/redis/redis.conf</code></pre>
<p>执行脚本参考自 <a href="https://hub.docker.com/_/redis?tab=description" target="_blank" rel="noopener">Docker Hub</a>。</p>
<p><img src="https://i.loli.net/2019/09/23/DvtaXPkubZUJL6A.png" alt="图：DockerHub提供的redis启动脚本"></p>
<h4 id="错误提示"><a href="#错误提示" class="headerlink" title="错误提示"></a>错误提示</h4><pre><code class="sh">1:C 23 Sep 08:43:00.482 # Fatal error, can&#39;t open config file &#39;C:/Program Files/Git/usr/local/etc/redis/redis.conf&#39;</code></pre>
<h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>未知。不明白为什么 Docker Container 会提示出 ‘C:/…’ 路径。</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>Windows 环境不使用 redis.conf. </p>
<blockquote>
<p>Ubuntu 下使用相同配置并无问题。以下是部署流程：</p>
</blockquote>
<p><img src="https://i.loli.net/2019/09/23/mXkanxRFu8HIYfi.png" alt="Linux下配置"></p>
<p>连接验证：</p>
<p><img src="https://i.loli.net/2019/09/23/i7rZhyLgPHwbnDI.png" alt="连接Linux下的Redis"></p>
<h2 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h2><ul>
<li><p><a href="https://github.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Github</a></p>
</li>
<li><p><a href="https://gitee.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Gitee</a></p>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/21/读书笔记/《Docker全栈项目部署》/4.MariaDB/index.html">Docker部署全栈：四、安装MySQL</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/index.html">运维</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/Docker全栈部署/index.html">Docker全栈部署</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/index.html">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Docker全栈部署/index.html">Docker全栈部署</a></span><div class="content"><h1 id="Docker部署全栈项目：四、MySQL-镜像"><a href="#Docker部署全栈项目：四、MySQL-镜像" class="headerlink" title="Docker部署全栈项目：四、MySQL 镜像"></a>Docker部署全栈项目：四、MySQL 镜像</h1><p>这里使用的是 MariaDB 镜像，与 MySQL 一样。</p>
<h2 id="一、编写启动脚本"><a href="#一、编写启动脚本" class="headerlink" title="一、编写启动脚本"></a>一、编写启动脚本</h2><h2 id="1-start-sh"><a href="#1-start-sh" class="headerlink" title="1. start.sh"></a>1. start.sh</h2><pre><code class="sh">#!/bin/bash

# 启动前先尝试停止该服务
docker stop luokaiii-mysql
docker rm luokaiii-mysql

# 运行服务
docker run --name luokaiii-mysql \ # 指定容器服务名称
        -p 3307:3306 \ # 将容器的3306端口映射到宿主机的3307端口
        -v /${PWD}/conf/local.cnf:/etc/mysql/conf.d/local.cnf \ # 使用自定义的配置文件(Windows环境下必不可少！)
        -v /${PWD}/data:/var/lib/mysql \ # 挂载数据目录
        -e MYSQL_ROOT_PASSWORD=password \ # MySQL初始密码
        -d mariadb:10.4.8 \ # 后台运行指定版本
        --character-set-server=utf8mb4 \ # 指定字符集
        --collation-server=utf8mb4_unicode_ci</code></pre>
<h3 id="2-conf-local-cnf"><a href="#2-conf-local-cnf" class="headerlink" title="2. conf/local.cnf"></a>2. conf/local.cnf</h3><p>指定 InnoDB 的刷新方法，否则会出现数据目录无法挂载的异常。当出现该异常后，请先清空 <code>./data</code> 目录。</p>
<pre><code class="cnf">[mysqld]
innodb_flush_method=O_DSYNC</code></pre>
<p><img src="https://i.loli.net/2019/09/23/6EcOuQZePBIXRvq.png" alt="数据无法挂载，data目录未清空"></p>
<h2 id="二、执行启动脚本"><a href="#二、执行启动脚本" class="headerlink" title="二、执行启动脚本"></a>二、执行启动脚本</h2><pre><code class="sh">$ cd /home/luokaiii/images/mysql   # 脚本和DB文件的存放位置

$ mkdir data   # 创建存储目录
$ vim conf/local.cnf  # 编写配置文件，填入innodb_flush_method=O_DSYNC

$ ./start.sh   # 运行刚刚写的脚本
994e9e05bb42d1d.....  # 控制台打印这种的，即表示启动成功</code></pre>
<h2 id="三、测试连接"><a href="#三、测试连接" class="headerlink" title="三、测试连接"></a>三、测试连接</h2><p><img src="https://i.loli.net/2019/09/23/EUrI5Cu6HRN2gSK.png" alt="连接MySQL"></p>
<h2 id="四、遇到的问题"><a href="#四、遇到的问题" class="headerlink" title="四、遇到的问题"></a>四、遇到的问题</h2><h3 id="1-问题：在-Windows-环境下，无法挂载-数据目录-至容器中。"><a href="#1-问题：在-Windows-环境下，无法挂载-数据目录-至容器中。" class="headerlink" title="1. 问题：在 Windows 环境下，无法挂载 数据目录 至容器中。"></a>1. 问题：在 Windows 环境下，无法挂载 数据目录 至容器中。</h3><p><img src="https://i.loli.net/2019/09/24/dWpOrvMy5eXznNg.png" alt="图：启动失败，无法挂载数据目录"></p>
<h3 id="原因："><a href="#原因：" class="headerlink" title="原因："></a>原因：</h3><p>未指定 <code>innodb_flush_method=O_DSYNC</code>。</p>
<blockquote>
<p>Linux 环境下不需要</p>
</blockquote>
<h3 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h3><ol>
<li>编写 <code>/conf/local.cnf</code> 并挂载到 <code>mariadb 容器</code> 中</li>
<li>删除之前 ./data 下的所有数据</li>
<li>并重新执行启动脚本</li>
</ol>
<p>参考资料：</p>
<ol>
<li><a href="https://hub.docker.com/_/mariadb" target="_blank" rel="noopener">Docker Hub</a></li>
<li><a href="https://github.com/docker-library/mariadb/issues/38" target="_blank" rel="noopener">Github Issue</a></li>
</ol>
<h2 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h2><ul>
<li><p><a href="https://github.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Github</a></p>
</li>
<li><p><a href="https://gitee.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Gitee</a></p>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/20/读书笔记/《Docker全栈项目部署》/5.SpringBoot/index.html">Docker部署全栈：五、Docker-Compose部署SpringBoot</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/index.html">运维</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/Docker全栈部署/index.html">Docker全栈部署</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/index.html">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Docker全栈部署/index.html">Docker全栈部署</a></span><div class="content"><h1 id="Docker部署全栈项目：五、SpringBoot-Jar"><a href="#Docker部署全栈项目：五、SpringBoot-Jar" class="headerlink" title="Docker部署全栈项目：五、SpringBoot Jar"></a>Docker部署全栈项目：五、SpringBoot Jar</h1><h2 id="一、创建-SpringBoot-项目"><a href="#一、创建-SpringBoot-项目" class="headerlink" title="一、创建 SpringBoot 项目"></a>一、创建 SpringBoot 项目</h2><h3 id="1-创建接口"><a href="#1-创建接口" class="headerlink" title="1. 创建接口"></a>1. 创建接口</h3><pre><code class="java">@EntityScan(&quot;cn.luokaiii.api.entity&quot;)
@RestController
@SpringBootApplication
public class ApiApplication {

    private final UserMongoService mongoService;

    private final UserMySQLService mySQLService;

    private final StringRedisTemplate stringRedisTemplate;

    @Autowired
    public ApiApplication(UserMongoService mongoService,
                          UserMySQLService mySQLService,
                          StringRedisTemplate stringRedisTemplate) {
        this.mongoService = mongoService;
        this.mySQLService = mySQLService;
        this.stringRedisTemplate = stringRedisTemplate;
    }

    public static void main(String[] args) {
        SpringApplication.run(ApiApplication.class, args);
    }

    @PostMapping
    public ResponseEntity createByMySql(@RequestBody Person person) {
        final Person save = mySQLService.save(person);
        final User user = mongoService.save(new User(person.getId().toString(), person.getName(), 22));
        stringRedisTemplate.opsForValue().set(person.getName(), person.getSex().toString());
        return ResponseEntity.ok(new UPDTO(save, user, null));
    }

    @GetMapping
    public ResponseEntity getByMySql(@RequestParam String username) {
        final Person person = mySQLService.findFirstByName(username);
        final User user = mongoService.findFirstByName(username);
        final String redis = stringRedisTemplate.opsForValue().get(username);
        return ResponseEntity.ok(new UPDTO(person, user, redis));
    }
}</code></pre>
<h3 id="2-配置参数"><a href="#2-配置参数" class="headerlink" title="2. 配置参数"></a>2. 配置参数</h3><p>连上我们之前配置的MongoDB、MySQL、Redis容器。</p>
<blockquote>
<p>这里使用配置的 docker-compose 中的服务名称。这样服务会自动连接，而 <code>localhost</code> 或者 <code>127.0.0.1</code> 则表示 <code>luokaiii-api</code> 当前容器内部的端口号，肯定会连接失败的。</p>
</blockquote>
<pre><code class="properties"># MongoDB 连接
spring.data.mongodb.uri=mongodb://mongoadmin:password@mongo:27017/demo?authSource=admin

# MySQL 连接
spring.datasource.username=root
spring.datasource.password=password
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://mariadb:3306/db_user?useUnicode=true&amp;characterEncoding=GBK&amp;useSSL=false

# Redis 连接
spring.redis.host=redis
spring.redis.port=6379
spring.redis.password=password</code></pre>
<h3 id="3-测试"><a href="#3-测试" class="headerlink" title="3. 测试"></a>3. 测试</h3><p>执行如下 Post 命令：</p>
<pre><code class="sh"># Post 请求
$ curl -i -X POST  -H &quot;Content-Type:application/json&quot; -d &#39;{ &quot;id&quot;:2, &quot;name&quot;:&quot;zhangsan&quot;, &quot;sex&quot;:1 }&#39; &#39;http://localhost:8080/&#39;

# 返回结果
{&quot;mysql&quot;:{&quot;id&quot;:2,&quot;name&quot;:&quot;zhangsan&quot;,&quot;sex&quot;:1},&quot;mongo&quot;:{&quot;id&quot;:&quot;2&quot;,&quot;name&quot;:&quot;zhangsan&quot;,&quot;age&quot;:22},&quot;redis&quot;:null}</code></pre>
<p>执行如下 Get 命令：</p>
<pre><code class="sh"># Get 请求
$ curl -i -X GET &#39;http://localhost:8080?username=zhangsan&#39;

# 返回结果
{&quot;mysql&quot;:{&quot;id&quot;:2,&quot;name&quot;:&quot;zhangsan&quot;,&quot;sex&quot;:1},&quot;mongo&quot;:{&quot;id&quot;:&quot;2&quot;,&quot;name&quot;:&quot;zhangsan&quot;,&quot;age&quot;:22},&quot;redis&quot;:&quot;1&quot;}</code></pre>
<h2 id="二、构建-Docker-镜像"><a href="#二、构建-Docker-镜像" class="headerlink" title="二、构建 Docker 镜像"></a>二、构建 Docker 镜像</h2><h3 id="1-pom-xml-中增加-docker-插件"><a href="#1-pom-xml-中增加-docker-插件" class="headerlink" title="1. pom.xml 中增加 docker 插件"></a>1. pom.xml 中增加 docker 插件</h3><p>完整的 <code>pom.xml</code> 如下：</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.1.8.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;!-- 当前项目的版本、名称等信息 --&gt;
    &lt;groupId&gt;cn.luokaiii&lt;/groupId&gt;
    &lt;artifactId&gt;api&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;api&lt;/name&gt;
    &lt;description&gt;java api&lt;/description&gt;

    &lt;!-- JDK版本 --&gt;
    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;!-- Spring Data JPA --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Data MongoDB --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Data Redis --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Web 服务器 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- MySQL驱动连接 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- 测试 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;!-- Maven 插件 --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
            &lt;!-- Docker Maven 插件 --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;com.spotify&lt;/groupId&gt;
                &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;1.2.0&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;!-- 构建出的镜像名 --&gt;
                    &lt;imageName&gt;luokaiii-api&lt;/imageName&gt;
                    &lt;!-- 基础依赖的镜像 --&gt;
                    &lt;baseImage&gt;openjdk:8-slim&lt;/baseImage&gt;

                    &lt;entryPoint&gt;[&quot;java&quot;, &quot;-jar&quot;, &quot;/${project.build.finalName}.jar&quot;]&lt;/entryPoint&gt;
                    &lt;resources&gt;
                        &lt;resource&gt;
                            &lt;targetPath&gt;/&lt;/targetPath&gt;
                            &lt;directory&gt;${project.build.directory}&lt;/directory&gt;
                            &lt;include&gt;${project.build.finalName}.jar&lt;/include&gt;
                        &lt;/resource&gt;
                    &lt;/resources&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;</code></pre>
<h3 id="2-构建镜像"><a href="#2-构建镜像" class="headerlink" title="2. 构建镜像"></a>2. 构建镜像</h3><pre><code class="sh"># mvn clean package 重新打包， -Dmaven.test.skip 跳过测试，docker:build 构建镜像
$ mvn clean package -Dmaven.test.skip=true docker:build</code></pre>
<blockquote>
<p>正常的生产环境，应该有严格的单元测试。</p>
</blockquote>
<p>查看 Docker Images (<code>$ docker images</code>)，应该有如下几个镜像了：</p>
<p><img src="https://i.loli.net/2019/09/24/XfK9C25qhBNSERr.png" alt="图：Docker Images"></p>
<p>带上之前的镜像，一共有如下几个：<code>luokaiii-api</code> ，<code>mongo:4.0.12</code> ，<code>mariadb:10.4.8</code> ，<code>openjdk:8-slim</code>， <code>redis:4.0.14</code></p>
<h3 id="3-测试-1"><a href="#3-测试-1" class="headerlink" title="3. 测试"></a>3. 测试</h3><h4 id="a-启动-luokaiii-api-镜像"><a href="#a-启动-luokaiii-api-镜像" class="headerlink" title="a) 启动 luokaiii-api 镜像"></a>a) 启动 <code>luokaiii-api</code> 镜像</h4><p>这里我们直接使用了 Docker-Compose 来启动该镜像，因为 <code>luokaiii-api</code> 依赖了如 <code>mongodb</code>，<code>mariadb</code>，<code>redis</code> 等其他镜像容器。</p>
<h4 id="a-1-在父级目录下创建-docker-compose-yml-文件"><a href="#a-1-在父级目录下创建-docker-compose-yml-文件" class="headerlink" title="a.1 在父级目录下创建 docker-compose.yml 文件"></a>a.1 在父级目录下创建 docker-compose.yml 文件</h4><blockquote>
<p> 不再开放mongo、mysql、redis的外部连接，统一改为容器内部通信，只对外提供一个 8080 端口用于访问。</p>
</blockquote>
<p><code>docker-compose.yml</code> 文件如下：</p>
<pre><code class="yml"># Docker-Compose 的版本
version: &#39;3&#39;

# 服务声明
services:
  # MongoDB 服务
  mongo:
    container_name: &#39;luokaiii-mongo&#39;
    image: &#39;mongo:4.0.12&#39;
    volumes:
      - mongodata:/data/db
    environment:
      MONGO_INITDB_ROOT_USERNAME: mongoadmin
      MONGO_INITDB_ROOT_PASSWORD: password
    restart: always
    expose:    # 暴露端口，但不映射到宿主机
      - &#39;27017&#39;
  # MariaDB 服务
  mariadb:
    container_name: &#39;luokaiii-mysql&#39;
    image: &#39;mariadb:10.4.8&#39;
    volumes:
      - &#39;./mysql/data/:/var/lib/mysql&#39;
      - &#39;./mysql/conf/local.cnf:/etc/mysql/conf.d/local.cnf&#39;
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: db_user
    command: [&#39;mysqld&#39;, &#39;--character-set-server=utf8mb4&#39;, &#39;--collation-server=utf8mb4_unicode_ci&#39;]
    restart: always
    expose:
      - &#39;3306&#39;
  # Redis 服务
  redis:
    container_name: &#39;luokaiii-redis&#39;
    image: &#39;redis:4.0.14&#39;
    volumes:
      - &#39;./redis/data:/data&#39;
    command: redis-server --requirepass password
    restart: always
    expose:
      - &#39;6379&#39;
  # Java API 服务
  api:
    container_name: &#39;luokaiii-api&#39;
    depends_on: # 依赖其他容器(如DB连接等)
      - mongo
      - redis
      - mariadb
    image: &#39;luokaiii-api:latest&#39;
    ports:    # 对外暴露 8080 端口
      - &#39;8080:8080&#39;
    restart: always

# 容器能够使用的数据卷
volumes:
  mongodata:</code></pre>
<h4 id="a-2-修改之前的-application-properties"><a href="#a-2-修改之前的-application-properties" class="headerlink" title="a.2 修改之前的 application.properties"></a>a.2 修改之前的 application.properties</h4><p>将 <code>localhost</code> 全部改为对应 <code>Compose</code> 的服务名称，这样 容器在运行时会动态加载对应的服务及端口。</p>
<pre><code class="properties"># MongoDB 连接
spring.data.mongodb.uri=mongodb://mongoadmin:password@mongo:27017/demo?authSource=admin

# MySQL 连接
spring.datasource.username=root
spring.datasource.password=password
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://mariadb:3306/db_user?useUnicode=true&amp;characterEncoding=GBK&amp;useSSL=false

# Redis 连接
spring.redis.host=redis
spring.redis.port=6379
spring.redis.password=password</code></pre>
<h4 id="a-3-运行-docker-compose"><a href="#a-3-运行-docker-compose" class="headerlink" title="a.3 运行 docker-compose"></a>a.3 运行 docker-compose</h4><pre><code class="sh"># 后台运行所有容器
$ docker-compose -d up

# 停止所有容器
# docker-compose down

# 停止单个容器
# docker-compose stop luokaiii-api

# 运行单个容器(停止状态)
# docker-compose start luokaiii-api

# 运行单个容器(被删除后)
# docker-compose run --name luokaiii-api luokaiii-api</code></pre>
<h4 id="a-4-依次查看容器的日志"><a href="#a-4-依次查看容器的日志" class="headerlink" title="a.4 依次查看容器的日志"></a>a.4 依次查看容器的日志</h4><p>控制台打印的日志太过混乱，这里我们一个一个的查看：</p>
<pre><code class="sh"># 查看 MongoDB 运行情况
$ docker logs luokaiii-mongo</code></pre>
<p><img src="https://i.loli.net/2019/09/24/VDTEhsdHlyFC1Zi.png" alt="MongoDB运行情况"></p>
<pre><code class="sh"># 查看 MariaDB 运行情况
$ docker logs luokaiii-mysql</code></pre>
<p><img src="https://i.loli.net/2019/09/24/POFBid9THoQbWNg.png" alt="MariaDB运行情况"></p>
<pre><code class="sh"># 查看 Redis 运行情况
$ docker logs luokaiii-redis</code></pre>
<p><img src="C:%5CUsers%5Cuser%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1569306056942.png" alt="Redis 运行情况"></p>
<pre><code class="sh"># 查看 JAVA Server 运行情况
$ docker logs luokaiii-api</code></pre>
<p><img src="https://i.loli.net/2019/09/24/tUzEfZaIGOLouvP.png" alt="Java运行状况"></p>
<h3 id="b-生成数据表"><a href="#b-生成数据表" class="headerlink" title="b. 生成数据表"></a>b. 生成数据表</h3><p>进入 <code>luokaiii-mysql</code> 容器，进入 MySQL，生成 person 表。 发送请求即可。</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><h3 id="1-MongoDB无法挂载data目录"><a href="#1-MongoDB无法挂载data目录" class="headerlink" title="1. MongoDB无法挂载data目录"></a>1. MongoDB无法挂载data目录</h3><p>按照正常来说，<code>mongo</code> 服务的编排应该如下所示：</p>
<pre><code class="yml">services:
  mongo:
    container_name: &#39;luokaiii-mongo&#39;
    image: &#39;mongo:4.0.12&#39;
    volumes:
      - ./mongo/db:/data/db
    environment:
      MONGO_INITDB_ROOT_USERNAME: mongoadmin
      MONGO_INITDB_ROOT_PASSWORD: password
    restart: always
    expose:
      - &#39;27017&#39;
......</code></pre>
<h4 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h4><p>这样的挂载，却会抛出文件无法打开、无法读取、无法写入的问题。详见 <a href="https://github.com/docker-library/mongo/issues/74" target="_blank" rel="noopener">Github Issue</a>。</p>
<h4 id="原因："><a href="#原因：" class="headerlink" title="原因："></a>原因：</h4><p>Docker 中的 Mongo 容器无法使用部分文件。</p>
<h4 id="解决方案："><a href="#解决方案：" class="headerlink" title="解决方案："></a>解决方案：</h4><p>手动创建一个共享卷，即如下改动：</p>
<pre><code class="yml">services:
  mongo:
    container_name: &#39;luokaiii-mongo&#39;
    image: &#39;mongo:4.0.12&#39;
    volumes:
      - mongodata:/data/db   # 这里改为下面声明的卷
    environment:
      MONGO_INITDB_ROOT_USERNAME: mongoadmin
      MONGO_INITDB_ROOT_PASSWORD: password
    restart: always
    expose:
      - &#39;27017&#39;
......
volumes:
  mongodata:</code></pre>
<blockquote>
<p><code>$ docker volume list</code> 能够查看所有共享的卷</p>
<p><code>$ docker volume inspect &lt;name&gt;</code> 能够查看具体的卷信息(如实际地址等)</p>
</blockquote>
<h3 id="2-MySQL-初始密码未生效"><a href="#2-MySQL-初始密码未生效" class="headerlink" title="2. MySQL 初始密码未生效"></a>2. MySQL 初始密码未生效</h3><h4 id="问题：-1"><a href="#问题：-1" class="headerlink" title="问题："></a>问题：</h4><p>在使用 <code>docker-compose up</code> 启动完所有程序后，<code>luokaiii-api</code> 项目抛出 “无法连接 MySQL 数据库的异常”。</p>
<p>而我们在 <code>docker-compose.yml</code> 中已经指定了具体的初始密码:</p>
<pre><code class="yml">MYSQL_ROOT_PASSWORD: password</code></pre>
<h4 id="原因：-1"><a href="#原因：-1" class="headerlink" title="原因："></a>原因：</h4><p>经排查发现，是 <code>luokaiii-mysql</code> 容器的密码未初始化。</p>
<h4 id="解决方案：-1"><a href="#解决方案：-1" class="headerlink" title="解决方案："></a>解决方案：</h4><p>依次运行以下代码：</p>
<pre><code class="sh"># 进入 MySQL 容器(Windows需要加上 `winpty`)
$ docker exec -it luokaiii-mysql bash

# 匹配环境变量
root@xx/# env | grep -i password
MYSQL_ROOT_PASSWORD=password

# 尝试无密码登录 - 失败
root@xx/# mysql -Uroot
ERROR 1045 (28000): Access denied for user &#39;root&#39;@&#39;localhost&#39; (using password: NO)

# 尝试使用密码登录，成功？？？？为什么？？？
root@xx/# mysql -Uroot -ppassword</code></pre>
<p>详见 <a href="https://github.com/docker-library/mysql/issues/557" target="_blank" rel="noopener">Github Issue</a>。</p>
<blockquote>
<p>首次操作即可，往后未出现该bug。</p>
</blockquote>
<p>参考资料：</p>
<ol>
<li><a href="https://github.com/spotify/docker-maven-plugin" target="_blank" rel="noopener">Docker-maven-plugin</a></li>
<li><a href="https://hub.docker.com/_/openjdk" target="_blank" rel="noopener">Docker Hub OpenJDK</a></li>
<li><a href="https://stackoverflow.com/questions/45729326/how-to-change-the-default-character-set-of-mysql-using-docker-compose" target="_blank" rel="noopener">https://stackoverflow.com/questions/45729326/how-to-change-the-default-character-set-of-mysql-using-docker-compose</a></li>
<li><a href="https://www.hi-linux.com/posts/12554.html" target="_blank" rel="noopener">运维之美</a></li>
<li><a href="https://github.com/docker-library/mysql/issues/557" target="_blank" rel="noopener">https://github.com/docker-library/mysql/issues/557</a></li>
</ol>
<h2 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h2><ul>
<li><p><a href="https://github.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Github</a></p>
</li>
<li><p><a href="https://gitee.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Gitee</a></p>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/09/19/读书笔记/《Docker全栈项目部署》/6.Nginx/index.html">Docker部署全栈：六、部署Nginx和React</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-09-19</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/index.html">运维</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/运维/Docker全栈部署/index.html">Docker全栈部署</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hide/index.html">hide</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Docker全栈部署/index.html">Docker全栈部署</a></span><div class="content"><h1 id="Docker部署全栈项目：六、部署Nginx和React"><a href="#Docker部署全栈项目：六、部署Nginx和React" class="headerlink" title="Docker部署全栈项目：六、部署Nginx和React"></a>Docker部署全栈项目：六、部署Nginx和React</h1><p>前端项目不论是 vue 还是 react，编译之后都是 html + css +js 的模板。</p>
<p>因此这里使用 <code>React Demo</code> 来演示如何部署前端项目至，Nginx的代理中。</p>
<h2 id="一、创建React项目"><a href="#一、创建React项目" class="headerlink" title="一、创建React项目"></a>一、创建React项目</h2><p>如果你使用的是其它前端语言，或者直接是纯JS写法，都是大同小异。</p>
<pre><code class="sh"># 创建React项目
$ create-react-app web

# 进入前端项目
$ cd web

# 构建项目(或者使用 npm run build)
$ yarn build 

# 构建完成后，会出现 build/ 目录，存放所有的静态资源文件</code></pre>
<p>将构建后的数据，放到 nginx/html 目录下。</p>
<blockquote>
<p>如果是远程服务器，可以使用 scp、pscp 等命令发送文件。</p>
</blockquote>
<h2 id="二、启动Nginx"><a href="#二、启动Nginx" class="headerlink" title="二、启动Nginx"></a>二、启动Nginx</h2><h3 id="1-编写-start-sh"><a href="#1-编写-start-sh" class="headerlink" title="1. 编写 start.sh"></a>1. 编写 start.sh</h3><pre><code class="sh">#!/bin/bash

# 启动前停止容器
docker stop luokaiii-nginx
docker rm luokaiii-nginx

# 运行容器
docker run --name luokaiii-nginx \ # 指定容器名
        -p 80:80 \    # 暴露80端口至宿主机
        -v /${PWD}/conf:/etc/nginx/conf.d \    # 挂载额外的配置文件
        -v /${PWD}/html:/usr/www/luokaiii/cn/html \    # 挂载静态资源
        -d nginx:alpine     # 后台运行nginx</code></pre>
<h3 id="2-编写-conf-nginx-conf"><a href="#2-编写-conf-nginx-conf" class="headerlink" title="2. 编写 conf/nginx.conf"></a>2. 编写 conf/nginx.conf</h3><pre><code class="sh">server {
        listen 80;

        root /usr/www/luokaiii/cn/html;

        location / {
                try_files $uri $uri/ /index.html;
        }
}</code></pre>
<h3 id="3-运行脚本"><a href="#3-运行脚本" class="headerlink" title="3. 运行脚本"></a>3. 运行脚本</h3><pre><code class="sh"># 运行脚本
$ ./start.sh</code></pre>
<h3 id="4-访问端口"><a href="#4-访问端口" class="headerlink" title="4. 访问端口"></a>4. 访问端口</h3><p><img src="https://i.loli.net/2019/09/24/ur4k3zwVv1AYeZX.png" alt="访问80端口"></p>
<h2 id="三、使用Nginx代理接口服务"><a href="#三、使用Nginx代理接口服务" class="headerlink" title="三、使用Nginx代理接口服务"></a>三、使用Nginx代理接口服务</h2><p>既然我们的接口使用的是容器服务，那么我可以把 <code>luokaiii-api</code> 的外部端口关闭，改为 nginx 的请求转发。</p>
<p>修改 nginx.conf：</p>
<pre><code class="sh">upstream apisupport {
        server api:8080;
}
server {
        listen 80;

        root /usr/www/luokaiii/cn/html;

        location / {
                try_files $uri $uri/ /index.html;
        }

        # 将 /api/ 请求转发至 `luokaiii-api` 服务
        location /api/ {
                proxy_pass http://apisupport/;
        }
}
</code></pre>
<p>请求测试：</p>
<p><img src="https://i.loli.net/2019/09/24/zx2qnsV7OCurgSH.png" alt="请求结果"></p>
<p>参考资料：</p>
<ol>
<li><a href="https://hub.docker.com/_/nginx" target="_blank" rel="noopener">Docker Hub</a></li>
</ol>
<h2 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h2><ul>
<li><p><a href="https://github.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Github</a></p>
</li>
<li><p><a href="https://gitee.com/luokaiii/luokaiii.docker-images" target="_blank" rel="noopener">Gitee</a></p>
</li>
</ul>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By koral</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>