<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="读书笔记," />





  <link rel="alternate" href="/atom.xml" title="罗凯的博客" type="application/atom+xml" />






<meta name="description" content="第十六章 解释器模式 - 自定义语言的实现一、什么是解释器模式解释器模式（Interpreter Pattern）：定义一个语言的文法，并且建立一个解释器来解释该语言中的句子，这里的“语言”是指使用规定格式和语法的代码。解释器模式是一种类行为型模式。 在某些情况下，为了更好地描述某一些特定类型的问题，我们可以创建一种新的语言，这种语言拥有自己的表达式和结构，即文法规则，这些问题的实例将对应为该语言">
<meta name="keywords" content="读书笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="《Java Design Patterns》第十六章 解释器模式 - 自定义语言的实现">
<meta property="og:url" content="http://luokaiii.github.io/2019/07/22/读书笔记/《JavaDesignPatterns》/18.解释器模式/index.html">
<meta property="og:site_name" content="罗凯的博客">
<meta property="og:description" content="第十六章 解释器模式 - 自定义语言的实现一、什么是解释器模式解释器模式（Interpreter Pattern）：定义一个语言的文法，并且建立一个解释器来解释该语言中的句子，这里的“语言”是指使用规定格式和语法的代码。解释器模式是一种类行为型模式。 在某些情况下，为了更好地描述某一些特定类型的问题，我们可以创建一种新的语言，这种语言拥有自己的表达式和结构，即文法规则，这些问题的实例将对应为该语言">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://i.loli.net/2019/07/20/5d32b544e08f875223.png">
<meta property="og:updated_time" content="2019-09-25T07:55:36.979Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="《Java Design Patterns》第十六章 解释器模式 - 自定义语言的实现">
<meta name="twitter:description" content="第十六章 解释器模式 - 自定义语言的实现一、什么是解释器模式解释器模式（Interpreter Pattern）：定义一个语言的文法，并且建立一个解释器来解释该语言中的句子，这里的“语言”是指使用规定格式和语法的代码。解释器模式是一种类行为型模式。 在某些情况下，为了更好地描述某一些特定类型的问题，我们可以创建一种新的语言，这种语言拥有自己的表达式和结构，即文法规则，这些问题的实例将对应为该语言">
<meta name="twitter:image" content="https://i.loli.net/2019/07/20/5d32b544e08f875223.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"right","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":5},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://luokaiii.github.io/2019/07/22/读书笔记/《JavaDesignPatterns》/18.解释器模式/"/>





  <title>《Java Design Patterns》第十六章 解释器模式 - 自定义语言的实现 | 罗凯的博客</title>
  








<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">罗凯的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">l u o k a i</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            日程表
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://luokaiii.github.io/2019/07/22/读书笔记/《JavaDesignPatterns》/18.解释器模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="koral">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://upload-images.jianshu.io/upload_images/13603359-6aa0d85db5eaa03e.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="罗凯的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">《Java Design Patterns》第十六章 解释器模式 - 自定义语言的实现</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-22T11:04:00+08:00">
                2019-07-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/设计模式/" itemprop="url" rel="index">
                    <span itemprop="name">设计模式</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="第十六章-解释器模式-自定义语言的实现"><a href="#第十六章-解释器模式-自定义语言的实现" class="headerlink" title="第十六章 解释器模式 - 自定义语言的实现"></a>第十六章 解释器模式 - 自定义语言的实现</h1><h2 id="一、什么是解释器模式"><a href="#一、什么是解释器模式" class="headerlink" title="一、什么是解释器模式"></a>一、什么是解释器模式</h2><p>解释器模式（Interpreter Pattern）：定义一个语言的文法，并且建立一个解释器来解释该语言中的句子，这里的“语言”是指使用规定格式和语法的代码。解释器模式是一种类行为型模式。</p>
<p>在某些情况下，为了更好地描述某一些特定类型的问题，我们可以创建一种新的语言，这种语言拥有自己的表达式和结构，即文法规则，这些问题的实例将对应为该语言中的句子。</p>
<h2 id="二、文法规则和抽象语法树"><a href="#二、文法规则和抽象语法树" class="headerlink" title="二、文法规则和抽象语法树"></a>二、文法规则和抽象语法树</h2><p>解释器模式描述了如何为简单的语言定义一个文法，如何在改语言中表示一个句子，以及如何解释这些句子。</p>
<p>在解释器模式中，我们可以使用一些符号来表示不同的含义，如“|”表示或，“{”与“}”表示组合等等。这些符号即代表着部分的文法规则</p>
<p>除了依靠文法规则来定义一个语言之外，还可以通过抽象语法树的图形方式来直观的表示语言的构成。</p>
<p><img src="https://i.loli.net/2019/07/20/5d32b544e08f875223.png" alt="抽象语法树示意图"></p>
<p>例如一个表达式语句 “1+2+3-4+1”，</p>
<h3 id="2-解释器模式中包含的几个角色："><a href="#2-解释器模式中包含的几个角色：" class="headerlink" title="2. 解释器模式中包含的几个角色："></a>2. 解释器模式中包含的几个角色：</h3><ol>
<li>AbstractExpression - 抽象表达式    <ol>
<li>在抽象表达式中声明了抽象的解释操作，他是所有终结符表达式和非终结符表达式的公共父类</li>
</ol>
</li>
<li>TerminalExpression - 终结符表达式<ol>
<li>是抽象表达式的子类，实现了与文法中的终结符相关联的解释操作</li>
<li>在句子中的每一个终结符都是该类的一个实例</li>
<li>通常在一个解释器模式中只有少数几个终结符表达式，他们的实例可以通过非终结符表达式组成较为复杂的句子</li>
</ol>
</li>
<li>NonterminalExpression - 非终结符表达式<ol>
<li>抽象表达式的子类，实现了文法中非终结符的解释操作</li>
<li>由于在非终结符表达式中可以包含终结符表达式，也可以包含非终结符表达式</li>
<li>因此其解释操作通常是递归的方式</li>
</ol>
</li>
<li>Context - 环境类<ol>
<li>环境类又称为上下文类，用于存储解释器之外的一些全局信息</li>
<li>通常临时存储了需要解释的语句</li>
</ol>
</li>
</ol>
<h3 id="3-核心类的设计"><a href="#3-核心类的设计" class="headerlink" title="3. 核心类的设计"></a>3. 核心类的设计</h3><h4 id="抽象表达式类"><a href="#抽象表达式类" class="headerlink" title="抽象表达式类"></a>抽象表达式类</h4><p>在解释器模式中，每一种终结符和非终结符都有一个具体类与之对应，正因为使用类来表示每一条文法规则，所以系统将具有较好的灵活性和可扩展性。</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractExpression</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">interpret</span><span class="token punctuation">(</span>Context ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="终结符表达式"><a href="#终结符表达式" class="headerlink" title="终结符表达式"></a>终结符表达式</h4><p>终结符表达式主要是对终结符元素的处理。</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">TerminalExpression</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractExpression</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">interpre</span><span class="token punctuation">(</span>Context ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 终结符表达式的解释操作</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="非终结符表达式"><a href="#非终结符表达式" class="headerlink" title="非终结符表达式"></a>非终结符表达式</h4><p>非终结符表达式将表达式组合成更加复杂的结构，对于包含两个操作元素的非终结符表达式类，其典型代码如下：</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">NonterminalExpression</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractExpression</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> AbstractExpression left<span class="token punctuation">;</span>
    <span class="token keyword">private</span> AbstractExpression right<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">NonterminalExpression</span><span class="token punctuation">(</span>AbstractExpression left<span class="token punctuation">,</span> AbstractExpression right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> left<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> right<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">interpret</span><span class="token punctuation">(</span>Context ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 递归调用每一个组成部分的 interpret() 方法</span>
        <span class="token comment" spellcheck="true">// 在递归调用时指定组成部分的连接方式，即非终结符的功能</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="上下文类"><a href="#上下文类" class="headerlink" title="上下文类"></a>上下文类</h4><p>环境类Context， 用于存储一些全局信息，通常在Context中包含了一个 HashMap 或者 ArrayList 等类型的集合对象。</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> HashMap map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">assign</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> String value<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 往环境中设值</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">lookup</span><span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 获取存储在环境中的值</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>系统可以根据西药来决定是否需要环境类</p>
</blockquote>
<h2 id="三、完整实现"><a href="#三、完整实现" class="headerlink" title="三、完整实现"></a>三、完整实现</h2><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 抽象表达式</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractNode</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> String <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// And解释 - 非终结符表达式</span>
<span class="token keyword">class</span> <span class="token class-name">AndNode</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractNode</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> AbstractNode left<span class="token punctuation">;</span>
    <span class="token keyword">private</span> AbstractNode right<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">AndNode</span><span class="token punctuation">(</span>AbstractNode left<span class="token punctuation">,</span> AbstractNode right<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> left<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> right<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// And 表达式的解释操作</span>
    <span class="token keyword">public</span> String <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> left<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"再"</span> <span class="token operator">+</span> right<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 简单句子解释 - 非终结符表达式</span>
<span class="token keyword">class</span> <span class="token class-name">SentenceNode</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractNode</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> AbstractNode direction<span class="token punctuation">;</span>
    <span class="token keyword">private</span> AbstractNode action<span class="token punctuation">;</span>
    <span class="token keyword">private</span> AbstractNode distance<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">SentenceNode</span><span class="token punctuation">(</span>AbstractNode direction<span class="token punctuation">,</span> AbstractNode action<span class="token punctuation">,</span> AbstractNode distance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">=</span> direction<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>action <span class="token operator">=</span> action<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>distance <span class="token operator">=</span> distance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> direction<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> distance<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 方向解释 - 终结符表达式</span>
<span class="token keyword">class</span> <span class="token class-name">DirectionNode</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractNode</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String direction<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">Direction</span><span class="token punctuation">(</span>String direction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">=</span> direction<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>direction<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">"up"</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token string">"向上"</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">"down"</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token string">"向下"</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">"left"</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token string">"向左"</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">"right"</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token string">"向右"</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token string">"无效指令"</span>'
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 动作解释 - 终结符表达式</span>
<span class="token keyword">class</span> <span class="token class-name">ActionNode</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractNode</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String action<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">ActionNode</span><span class="token punctuation">(</span>String action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>action <span class="token operator">=</span> action<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">"move"</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token string">"移动"</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">"run"</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token string">"快速移动"</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token string">"无效指令"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 距离解释 - 终结符表达式</span>
<span class="token keyword">class</span> <span class="token class-name">DistanceNode</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractNode</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String distance<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">DistanceNode</span><span class="token punctuation">(</span>String distance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>distance <span class="token operator">=</span> distance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> distance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 指令处理类 - 工具类</span>
<span class="token comment" spellcheck="true">/**
 * 工具类用于对输入指令进行处理，将指令分隔为字符串数组
 * 将第一二三个单词组成一个句子，并存入栈中
 * 如果发现单词 “and”，则将 “and” 后的第一二三个单词组成一个新的句子作为右表达式，并从栈中取出原先的句子作为左表达式，然后组合成一个And节点存入栈中
 * 依次类推，直到整个指令解析结束
 */</span>
<span class="token keyword">class</span> <span class="token class-name">InstructionHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String instruction<span class="token punctuation">;</span>
    <span class="token keyword">private</span> AbstractNode node<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span>String instruction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        AbstractNode left <span class="token operator">=</span> null<span class="token punctuation">;</span>
        AbstractNode right <span class="token operator">=</span> null<span class="token punctuation">;</span>

        AbstractNode direction <span class="token operator">=</span> null<span class="token punctuation">;</span>
        AbstractNode action <span class="token operator">=</span> null<span class="token punctuation">;</span>
        AbstractNode distance <span class="token operator">=</span> null<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 声明一个栈对象用于存储抽象语法树</span>
        Stack stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 以空格分隔指令字符串</span>
        String<span class="token punctuation">[</span><span class="token punctuation">]</span> words <span class="token operator">=</span> instruction<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> words<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 如果遇到 and，则将后三个单词作为三个终结符表达式连成一个简单句子，并作为右表达式</span>
            <span class="token comment" spellcheck="true">// 从栈顶弹出之前的表达式作为 and 的左表达式，最后将and压入栈中</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>words<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"and"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 弹出栈顶表达式作为左表达式</span>
                left <span class="token operator">=</span> <span class="token punctuation">(</span>AbstractNode<span class="token punctuation">)</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                direction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DirectionNode</span><span class="token punctuation">(</span>words<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                action <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActionNode</span><span class="token punctuation">(</span>words<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                distance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DistanceNode</span><span class="token punctuation">(</span>words<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">// 右表达式</span>
                right <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SentenceNode</span><span class="token punctuation">(</span>direction<span class="token punctuation">,</span> action<span class="token punctuation">,</span> distance<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token comment" spellcheck="true">// 将新表达式压入栈中</span>
                stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AndNode</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment" spellcheck="true">// 如果是从头开始解释，则将前三个单词组成一个简单句子并压入栈中</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                direction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DirectionNode</span><span class="token punctuation">(</span>words<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                action <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActionNode</span><span class="token punctuation">(</span>words<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                distance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DistanceNode</span><span class="token punctuation">(</span>words<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                left <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SentenceNode</span><span class="token punctuation">(</span>direction<span class="token punctuation">,</span> action<span class="token punctuation">,</span> distance<span class="token punctuation">)</span><span class="token punctuation">;</span>
                stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>node <span class="token operator">=</span> <span class="token punctuation">(</span>AbstractNode<span class="token punctuation">)</span>stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 解释表达式</span>
        String result <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 客户端 - 测试类</span>
<span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        String instruction <span class="token operator">=</span> <span class="token string">"up move 5 and down run 10 and left move 5"</span><span class="token punctuation">;</span>
        InstructionHandler handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InstructionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        handler<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>instruction<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String outString<span class="token punctuation">;</span>
        outString <span class="token operator">=</span> handler<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>outString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="四、Context的作用"><a href="#四、Context的作用" class="headerlink" title="四、Context的作用"></a>四、Context的作用</h3><p>在解释器模式中，环境类Context用于存储解释器之外的一些全局信息，它通常作为参数被传递到所有表达式的解释方法 interpret() 中，可以在 Context 对象中存储访问表达式解释器的状态，向表达式解释器提供一些全局的、公共的数据，此外还可以在 Context 中增加一些所有表达式解释器都共有的功能，减轻解释器的职责。</p>
<h2 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li>易于改变和扩展文法。由于在解释器模式中使用类来表示语言的文法规则，因此可以通过继承等机制来改变或扩展文法</li>
<li>每一条文法规则都可以表示为一个类，因此可以方便地实现一个简单的语言</li>
<li>实现文法较为容易，在抽象语法树中每一个表达式节点类的实现方式都是相似的，这些类的代码编写都不会特别复杂，还可以通过一些工具自动生成节点类代码</li>
<li>增加新的解释表达式较为方便。如果用户需要增加新的解释表达式只需要对应增加一个新的终结符表达式或非终结符表达式类，原有表达式类代码无需修改，符合“开闭原则”</li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>对于复杂文法难以维护，每一条规则至少对应一个类</li>
<li>执行效率较低，模式中使用了大量的循环和递归调用，因此在解释时速度很慢</li>
</ol>
<h3 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3><ol>
<li>讲一个需要解释执行的语言中的句子表示为一个丑行语法树</li>
<li>一些重复出现的问题可以用一种简单的语言来进行表达</li>
<li>一个语言的文法较为简单</li>
<li>执行效率不是关键问题</li>
</ol>
<h2 id="六、练习"><a href="#六、练习" class="headerlink" title="六、练习"></a>六、练习</h2><blockquote>
<p>Sunny软件公司欲为数据库备份和同步开发一套简单的数据库同步指令，通过指令可以对数据库中的数据和结构进行备份，例如，输入指令“COPY VIEW FROM srcDB TO desDB”表示将数据库srcDB中的所有视图(View)对象都拷贝至数据库desDB；输入指令“MOVE TABLE Student FROM srcDB TO esDB”表示将数据库srcDB中的Student表移动至数据库desDB。试使用解释器模式来设计并实现该数据库同步指令。</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Stack<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 解释器模式
 * Sunny软件公司欲为数据库备份和同步开发一套简单的数据库同步指令，
 * 通过指令可以对数据库中的数据和结构进行备份，
 * 例如，
 * 输入指令“COPY VIEW FROM srcDB TO desDB”
 * 表示将数据库srcDB中的所有视图(View)对象都拷贝至数据库desDB；
 * 输入指令“MOVE TABLE Student FROM srcDB TO esDB”
 * 表示将数据库srcDB中的Student表移动至数据库desDB。
 * 试使用解释器模式来设计并实现该数据库同步指令。
 */</span>
<span class="token comment" spellcheck="true">// 抽象指令</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractOrder</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 抽象公共方法，用于解释具体的指令</span>
    <span class="token keyword">abstract</span> String <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 从。。到。。 指令 - 非终结符表达式</span>
<span class="token keyword">class</span> <span class="token class-name">FromOrder</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractOrder</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> AbstractOrder first<span class="token punctuation">;</span>
    <span class="token keyword">private</span> AbstractOrder second<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">FromOrder</span><span class="token punctuation">(</span>AbstractOrder first<span class="token punctuation">,</span> AbstractOrder second<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>first <span class="token operator">=</span> first<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>second <span class="token operator">=</span> second<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    String <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"从"</span> <span class="token operator">+</span> first<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"到"</span> <span class="token operator">+</span> second<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 视图指令 - 终结符表达式</span>
<span class="token keyword">class</span> <span class="token class-name">ViewOrder</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractOrder</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String view<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">ViewOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">ViewOrder</span><span class="token punctuation">(</span>String view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>view <span class="token operator">=</span> view<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    String <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>view <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">"[所有视图]"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">"[视图:"</span> <span class="token operator">+</span> view <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 表格指令 - 终结符表达式</span>
<span class="token keyword">class</span> <span class="token class-name">TableOrder</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractOrder</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String table<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">TableOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">TableOrder</span><span class="token punctuation">(</span>String table<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>table <span class="token operator">=</span> table<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    String <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>table <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">"[所有表格]"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">"["</span> <span class="token operator">+</span> table <span class="token operator">+</span> <span class="token string">"表]"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 数据库名称指令 - 终结符表达式</span>
<span class="token keyword">class</span> <span class="token class-name">DBOrder</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractOrder</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">DBOrder</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    String <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"[数据库:"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 备份指令 - 终结符表达式</span>
<span class="token keyword">class</span> <span class="token class-name">CopyOrder</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractOrder</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    String <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"拷贝"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 移动指令 - 终结符表达式</span>
<span class="token keyword">class</span> <span class="token class-name">MoveOrder</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractOrder</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    String <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"移动"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 句子解释(Copy/Move FromOder) - 非终结符表达式</span>
<span class="token keyword">class</span> <span class="token class-name">SentenceOrder</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractOrder</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> AbstractOrder direction<span class="token punctuation">;</span>
    <span class="token keyword">private</span> AbstractOrder action<span class="token punctuation">;</span>
    <span class="token keyword">private</span> AbstractOrder distance<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">SentenceOrder</span><span class="token punctuation">(</span>AbstractOrder direction<span class="token punctuation">,</span> AbstractOrder action<span class="token punctuation">,</span> AbstractOrder distance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">=</span> direction<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>action <span class="token operator">=</span> action<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>distance <span class="token operator">=</span> distance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    String <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> direction<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> distance<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 指令工具类</span>
<span class="token keyword">class</span> <span class="token class-name">InstructionHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String instruction<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// 输入的指令字符串</span>
    <span class="token keyword">private</span> AbstractOrder order<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 字符串转换后的指令</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span>String instruction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        AbstractOrder direction<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// sentence 指令的 direction</span>
        AbstractOrder action<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// sentence 指令的 action</span>
        AbstractOrder distance<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// sentence 指令的 distance</span>

        <span class="token comment" spellcheck="true">// 使用栈来保存表达式</span>
        Stack<span class="token operator">&lt;</span>AbstractOrder<span class="token operator">></span> stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stack</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 将输入的指令字符串按照 空格 拆分</span>
        <span class="token keyword">final</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span> words <span class="token operator">=</span> instruction<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> words<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> String word <span class="token operator">=</span> words<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// 如果为 from 指令，则解析 From [DB] TO [DB]</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>word<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token string">"from"</span><span class="token operator">:</span>
                    String f <span class="token operator">=</span> words<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token operator">++</span>i<span class="token punctuation">;</span>
                    String s <span class="token operator">=</span> words<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FromOrder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DBOrder</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DBOrder</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">"copy"</span><span class="token operator">:</span>
                    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CopyOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">"move"</span><span class="token operator">:</span>
                    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MoveOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">"view"</span><span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>words<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"from"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ViewOrder</span><span class="token punctuation">(</span>words<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">else</span>
                        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ViewOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">"table"</span><span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>words<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"from"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TableOrder</span><span class="token punctuation">(</span>words<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">else</span>
                        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TableOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"无效指令"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        distance <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        action <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        direction <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// order 最终是一个解释类表达式</span>
        order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SentenceOrder</span><span class="token punctuation">(</span>direction<span class="token punctuation">,</span> action<span class="token punctuation">,</span> distance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> order<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterpretPattern</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        String order <span class="token operator">=</span> <span class="token string">"MOVE TABLE Student FROM srcDB TO esDB"</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> InstructionHandler handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InstructionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        handler<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> String output <span class="token operator">=</span> handler<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/读书笔记/" rel="tag"># 读书笔记</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/22/Linux/1.Ubuntu安全基线检查/" rel="next" title="">
                <i class="fa fa-chevron-left"></i> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/22/读书笔记/《JavaDesignPatterns》/19.迭代器模式/" rel="prev" title="《Java Design Patterns》第十七章 迭代器模式">
                《Java Design Patterns》第十七章 迭代器模式 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://upload-images.jianshu.io/upload_images/13603359-6aa0d85db5eaa03e.gif"
                alt="koral" />
            
              <p class="site-author-name" itemprop="name">koral</p>
              <p class="site-description motion-element" itemprop="description">如果我16岁，我可以悄悄的说我好喜欢你，如果我26岁，我可以大声告诉你我很爱你，可惜我6岁，我什么都给不了你，我还要上小学。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">224</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#第十六章-解释器模式-自定义语言的实现"><span class="nav-number">1.</span> <span class="nav-text">第十六章 解释器模式 - 自定义语言的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、什么是解释器模式"><span class="nav-number">1.1.</span> <span class="nav-text">一、什么是解释器模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、文法规则和抽象语法树"><span class="nav-number">1.2.</span> <span class="nav-text">二、文法规则和抽象语法树</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-解释器模式中包含的几个角色："><span class="nav-number">1.2.1.</span> <span class="nav-text">2. 解释器模式中包含的几个角色：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-核心类的设计"><span class="nav-number">1.2.2.</span> <span class="nav-text">3. 核心类的设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#抽象表达式类"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">抽象表达式类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#终结符表达式"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">终结符表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#非终结符表达式"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">非终结符表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#上下文类"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">上下文类</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、完整实现"><span class="nav-number">1.3.</span> <span class="nav-text">三、完整实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#四、Context的作用"><span class="nav-number">1.3.1.</span> <span class="nav-text">四、Context的作用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五、总结"><span class="nav-number">1.4.</span> <span class="nav-text">五、总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#优点"><span class="nav-number">1.4.1.</span> <span class="nav-text">优点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缺点"><span class="nav-number">1.4.2.</span> <span class="nav-text">缺点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#适用场景"><span class="nav-number">1.4.3.</span> <span class="nav-text">适用场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#六、练习"><span class="nav-number">1.5.</span> <span class="nav-text">六、练习</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">koral</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>





        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
