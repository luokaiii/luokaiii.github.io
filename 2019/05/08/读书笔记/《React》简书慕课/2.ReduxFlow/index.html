<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Redux入门"><meta name="keywords" content="hide,React慕课"><meta name="author" content="koral"><meta name="copyright" content="koral"><title>Redux入门 | 凯</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redux-入门"><span class="toc-number">1.</span> <span class="toc-text">Redux 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redux-Flow"><span class="toc-number">1.1.</span> <span class="toc-text">Redux Flow</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一、引入依赖"><span class="toc-number">1.2.</span> <span class="toc-text">一、引入依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、创建全局-Store"><span class="toc-number">1.3.</span> <span class="toc-text">二、创建全局 Store</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用与修改"><span class="toc-number">1.4.</span> <span class="toc-text">使用与修改</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#整体使用如下："><span class="toc-number">1.5.</span> <span class="toc-text">整体使用如下：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#src-TodoList-js"><span class="toc-number">1.5.1.</span> <span class="toc-text">src/TodoList.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#src-store-index-js"><span class="toc-number">1.5.2.</span> <span class="toc-text">src/store/index.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#src-store-reducer-js"><span class="toc-number">1.5.3.</span> <span class="toc-text">src/store/reducer.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#src-store-actionTypes-js"><span class="toc-number">1.5.4.</span> <span class="toc-text">src/store/actionTypes.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#src-store-actionCreator-js"><span class="toc-number">1.5.5.</span> <span class="toc-text">src/store/actionCreator.js</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">koral</div><div class="author-info__description text-center">回廊一寸相思地，落月成孤倚。背灯和月就花阴，已是十年踪迹十年心。</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">221</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">31</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">40</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/index.html">凯</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/about">关于我</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Redux入门</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-05-08</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/读书笔记/">读书笔记</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/读书笔记/React慕课/">React慕课</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="Redux-入门"><a href="#Redux-入门" class="headerlink" title="Redux 入门"></a>Redux 入门</h1><p>使用 Redux 重构之前的 TodoList，使用全局 state 来实现。</p>
<h2 id="Redux-Flow"><a href="#Redux-Flow" class="headerlink" title="Redux Flow"></a>Redux Flow</h2><p>Redux 的工作流：<br><img src="https://koral-home.oss-cn-beijing.aliyuncs.com/blog/ReduxFlow.jpg" alt="Redux Flow"></p>
<h2 id="一、引入依赖"><a href="#一、引入依赖" class="headerlink" title="一、引入依赖"></a>一、引入依赖</h2><p>需要先引入 Ant Design 和 Redux</p>
<blockquote>
<p>yarn add antd<br>yarn add redux</p>
</blockquote>
<h2 id="二、创建全局-Store"><a href="#二、创建全局-Store" class="headerlink" title="二、创建全局 Store"></a>二、创建全局 Store</h2><p>第一步：创建 store/reducer.js<br>reducer 必须返回一个函数，state 参数为存储的内容</p>
<pre><code class="javascript">const defaultState = {
  // state默认值
  inputValue: &quot;123&quot;,
  list: [1, 2, 3]
};

export default (state = defaultState, action) =&gt; {
  return state;
};</code></pre>
<p>第二步：创建 store/index.js<br>使用 redux 的 createStore 方法，使用之前创建的 reducer 作为参数，创建一个 store</p>
<pre><code class="javascript">import { createStore } from &quot;redux&quot;;
import reducer from &quot;./reducer&quot;;

const store = createStore(reducer);

export default store;</code></pre>
<h2 id="使用与修改"><a href="#使用与修改" class="headerlink" title="使用与修改"></a>使用与修改</h2><p>一：使用 redux 的公共存储</p>
<pre><code class="javascript">import store from &quot;./store/index.js&quot;;
// import store from &#39;./store&#39; // 可以缩写为这样

console.log(store.getState()); // 直接能打印出store中的内容</code></pre>
<p>二：修改 redux 中的内容</p>
<p>注意：redux 的 reducer 只支持读取 state，而不支持修改 state。如果需要修改，请深拷贝原有 state，修改新的 newState，并将 newState 返回。</p>
<pre><code class="js">const defaultState = {
  inputValue: &quot;Hello React !&quot;,
  list: [&quot;1111&quot;, &quot;2222&quot;]
};

export default (state = defaultState, action) =&gt; {
  if (action.type === &quot;change_input_value&quot;) {
    const newState = JSON.parse(JSON.stringify(state));
    newState.inputValue = action.value;
    return newState;
  } else if (action.type === &quot;add_list_item&quot;) {
    const newState = JSON.parse(JSON.stringify(state));
    newState.list.push(state.inputValue);
    newState.inputValue = &quot;&quot;;
    return newState;
  } else if (action.type === &quot;del_list_item&quot;) {
    const newState = JSON.parse(JSON.stringify(state));
    newState.list.splice(action.index, 1);
    return newState;
  }
  return state;
};</code></pre>
<p>三、监听 store 内容的修改</p>
<pre><code class="js">    constructor(props) {
        super(props);
        this.state = store.getState();
        this.handleStoreChange = this.handleStoreChange.bind(this);
        store.subscribe(this.handleStoreChange);
    }

    render () {
        ...
    }

    handleStoreChange() {
        this.setState(store.getState());
    }</code></pre>
<h2 id="整体使用如下："><a href="#整体使用如下：" class="headerlink" title="整体使用如下："></a>整体使用如下：</h2><h3 id="src-TodoList-js"><a href="#src-TodoList-js" class="headerlink" title="src/TodoList.js"></a>src/TodoList.js</h3><pre><code class="js">import React, { Component } from &quot;react&quot;;
import store from &quot;./store&quot;;
import &quot;antd/dist/antd.css&quot;;
import { Input, Button, List } from &quot;antd&quot;;
import {
  getInputChangeAction,
  getAddItemAction,
  getDeleteItemAction
} from &quot;./store/actionCreator&quot;;

class TodoList extends Component {
  constructor(props) {
    super(props);
    this.state = store.getState();
    this.handleInputChange = this.handleInputChange.bind(this);
    this.handleStoreChange = this.handleStoreChange.bind(this);
    this.handleBtnClick = this.handleBtnClick.bind(this);
    this.handleDeleteItem = this.handleDeleteItem.bind(this);
    store.subscribe(this.handleStoreChange);
  }

  render() {
    return (
      &lt;div style={{ marginTop: "10px", marginLeft: "10px" }}&gt;
        &lt;Input
          style={{ width: "300px", marginRight: "10px" }}
          value={this.state.inputValue}
          onChange={this.handleInputChange}
        /&gt;
        &lt;Button type=&quot;primary&quot; onClick={this.handleBtnClick}&gt;
          æ��äº¤
        &lt;/Button&gt;
        &lt;br /&gt;
        &lt;List
          style={{ width: "300px" }}
          bordered
          dataSource={this.state.list}
          renderItem={(item, index) =&gt; (
            &lt;List.Item onClick={() =&gt; this.handleDeleteItem(index)}&gt;
              {item}
            &lt;/List.Item&gt;
          )}
        /&gt;
      &lt;/div&gt;
    );
  }

  handleInputChange(e) {
    const value = e.target.value;
    const action = getInputChangeAction(value);
    store.dispatch(action);
  }

  handleStoreChange() {
    this.setState(store.getState());
  }

  handleBtnClick() {
    const action = getAddItemAction();
    store.dispatch(action);
  }

  handleDeleteItem(index) {
    const action = getDeleteItemAction(index);
    store.dispatch(action);
  }
}

export default TodoList;</code></pre>
<h3 id="src-store-index-js"><a href="#src-store-index-js" class="headerlink" title="src/store/index.js"></a>src/store/index.js</h3><pre><code class="js">import { createStore } from &quot;redux&quot;;
import reducer from &quot;./reducer&quot;;

const store = createStore(
  reducer,
  window.__REDUX_DEVTOOLS_EXTENSION__ &amp;&amp; window.__REDUX_DEVTOOLS_EXTENSION__()
);

export default store;</code></pre>
<h3 id="src-store-reducer-js"><a href="#src-store-reducer-js" class="headerlink" title="src/store/reducer.js"></a>src/store/reducer.js</h3><pre><code class="js">const defaultState = {
  inputValue: &quot;Hello React !&quot;,
  list: [&quot;1111&quot;, &quot;2222&quot;]
};

export default (state = defaultState, action) =&gt; {
  if (action.type === &quot;change_input_value&quot;) {
    const newState = JSON.parse(JSON.stringify(state));
    newState.inputValue = action.value;
    return newState;
  } else if (action.type === &quot;add_list_item&quot;) {
    const newState = JSON.parse(JSON.stringify(state));
    newState.list.push(state.inputValue);
    newState.inputValue = &quot;&quot;;
    return newState;
  } else if (action.type === &quot;del_list_item&quot;) {
    const newState = JSON.parse(JSON.stringify(state));
    newState.list.splice(action.index, 1);
    return newState;
  }
  return state;
};</code></pre>
<h3 id="src-store-actionTypes-js"><a href="#src-store-actionTypes-js" class="headerlink" title="src/store/actionTypes.js"></a>src/store/actionTypes.js</h3><p>将所有的 Action 类型提取为常量，统一管理。方便调试与代码定位。</p>
<pre><code class="js">export const CHANGE_INPUT_VALUE = &quot;change_input_value&quot;;
export const ADD_LIST_ITEM = &quot;add_list_item&quot;;
export const DEL_LIST_ITEM = &quot;del_list_item&quot;;</code></pre>
<h3 id="src-store-actionCreator-js"><a href="#src-store-actionCreator-js" class="headerlink" title="src/store/actionCreator.js"></a>src/store/actionCreator.js</h3><p>将 Action 的创建统一管理，使用 Creator 提供创建 Action 的方法。使流程更加清晰</p>
<pre><code class="js">import {
  CHANGE_INPUT_VALUE,
  ADD_LIST_ITEM,
  DEL_LIST_ITEM
} from &quot;./actionTypes&quot;;

export const getInputChangeAction = value =&gt; ({
  type: CHANGE_INPUT_VALUE,
  value: value
});

export const getAddItemAction = () =&gt; ({
  type: ADD_LIST_ITEM
});

export const getDeleteItemAction = index =&gt; ({
  type: DEL_LIST_ITEM,
  index: index
});</code></pre>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">koral</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://luokaiii.github.io/2019/05/08/读书笔记/《React》简书慕课/2.ReduxFlow/">http://luokaiii.github.io/2019/05/08/读书笔记/《React》简书慕课/2.ReduxFlow/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://luokaiii.github.io">凯</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/hide/">hide</a><a class="post-meta__tags" href="/tags/React慕课/">React慕课</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/05/09/读书笔记/《React》简书慕课/3.ReduxThunk/"><i class="fa fa-chevron-left">  </i><span>ReduxThunk</span></a></div><div class="next-post pull-right"><a href="/2019/05/07/读书笔记/《React》简书慕课/1.基础语法/"><span>React入门</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By koral</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>